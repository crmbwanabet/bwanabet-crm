<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BwanaBet CRM - Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .spinner { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800 p-4">
  
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
    <div class="bg-black p-6 text-center border-b-4 border-amber-400">
      <h1 class="text-amber-400 font-extrabold text-3xl tracking-tight">BWANABET</h1>
      <p class="text-slate-400 text-sm mt-1">CRM System</p>
    </div>
    <div class="p-6 sm:p-8">
      <h2 class="text-xl font-bold text-slate-800 mb-6 text-center">Sign In</h2>
      <div id="loginError" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Email</label>
          <input type="email" id="loginEmail" placeholder="you@example.com" class="w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-amber-400"/>
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
          <input type="password" id="loginPassword" placeholder="••••••••" class="w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-amber-400"/>
        </div>
        <button id="loginBtn" class="w-full py-3 bg-amber-500 text-black font-bold rounded-lg hover:bg-amber-400 transition-colors flex items-center justify-center gap-2">
          <i data-lucide="log-in" class="h-5 w-5"></i>
          Sign In
        </button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // YOUR SUPABASE CREDENTIALS
    // ============================================
    var SUPABASE_URL = 'https://blrrcnrhixckfudiojwe.supabase.co';
    var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJscnJjbnJoaXhja2Z1ZGlvandlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3Nzg0MzMsImV4cCI6MjA4MzM1NDQzM30.2DGACAZz-f_r0ieYz3hvtsOG1y-3fqTD_ENH2ZR2g1k';
    
    var db = null;

    document.addEventListener('DOMContentLoaded', function() {
      lucide.createIcons();
      db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      
      // Check if already logged in
      checkSession();
      
      // Setup login button
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('loginPassword').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') handleLogin();
      });
      document.getElementById('loginEmail').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('loginPassword').focus();
      });
    });

    async function checkSession() {
      var result = await db.auth.getSession();
      if (result.data.session) {
        // Already logged in - go to CRM
        window.location.href = 'index.html';
      }
    }

    async function handleLogin() {
      var email = document.getElementById('loginEmail').value.trim();
      var password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        showError('Please enter email and password');
        return;
      }
      
      // Disable button and show loading
      var btn = document.getElementById('loginBtn');
      btn.disabled = true;
      btn.innerHTML = '<svg class="spinner h-5 w-5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Signing in...';
      
      try {
        var result = await db.auth.signInWithPassword({ 
          email: email, 
          password: password 
        });
        
        if (result.error) throw result.error;
        
        // Success - redirect to CRM
        window.location.href = 'index.html';
        
      } catch (error) {
        showError(error.message || 'Login failed. Check your email and password.');
        btn.disabled = false;
        btn.innerHTML = '<i data-lucide="log-in" class="h-5 w-5"></i> Sign In';
        lucide.createIcons();
      }
    }

    function showError(message) {
      var errorEl = document.getElementById('loginError');
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    }
  </script>
</body>
</html>
