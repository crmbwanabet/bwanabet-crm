<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BwanaBet CRM System v1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .dark { background-color: #0f172a; color: #e2e8f0; }
    .dark .bg-white { background-color: #1e293b !important; }
    .dark .bg-slate-100 { background-color: #0f172a !important; }
    .dark .text-slate-800 { color: #f1f5f9 !important; }
    .dark .text-slate-600 { color: #cbd5e1 !important; }
    .dark .border-slate-200 { border-color: #334155 !important; }
    .tab-btn.active { background: #FDF104; color: #000; }
    .clickable-card { cursor: pointer; transition: all 0.2s; }
    .clickable-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .spinner { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .virtual-scroll { height: calc(100vh - 400px); min-height: 400px; overflow-y: auto; }
    .kbd { display: inline-block; padding: 2px 6px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 11px; font-family: monospace; }
    /* Bulk Selection */
    .bulk-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: #F59E0B; }
    .bulk-toolbar { position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 12px 16px; border-radius: 12px; margin-bottom: 12px; display: none; animation: slideUp 0.3s ease; }
    .bulk-toolbar.active { display: flex; }
    /* Quick Actions */
    .quick-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
    tr:hover .quick-actions { opacity: 1; }
    .quick-action { padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s; }
    .quick-action.view { background: #e0f2fe; color: #0284c7; }
    .quick-action.view:hover { background: #0284c7; color: white; }
    .quick-action.star { background: #fef3c7; color: #d97706; }
    .quick-action.star:hover { background: #f59e0b; color: white; }
    .quick-action.star.active { background: #f59e0b; color: white; }
    /* Saved Filters */
    .saved-filter { padding: 8px 12px; background: #f1f5f9; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; }
    .saved-filter:hover { background: #e2e8f0; }
    .saved-filter.active { background: #fef3c7; border: 1px solid #f59e0b; }
    /* Recently Viewed & Watchlist */
    .recent-item, .watch-item { padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
    .recent-item:hover, .watch-item:hover { background: #f1f5f9; }
    .watch-item .star { color: #f59e0b; }
    /* Column Toggle */
    .column-toggle { position: relative; }
    .column-menu { position: absolute; top: 100%; right: 0; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); padding: 12px; min-width: 180px; z-index: 100; display: none; }
    .column-menu.open { display: block; animation: slideUp 0.2s ease; }
    .column-option { display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px; cursor: pointer; }
    .column-option:hover { background: #f1f5f9; }
    /* Row highlight for watchlist */
    tr.watched { background: #fffbeb !important; }
    tr.watched:hover { background: #fef3c7 !important; }
    /* Auto-refresh indicator */
    .auto-refresh-indicator { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: #ecfdf5; border-radius: 20px; font-size: 11px; color: #059669; }
    .auto-refresh-indicator .dot { width: 6px; height: 6px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite; }
    .command-palette { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); width: 500px; max-width: 90vw; background: white; border-radius: 12px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); z-index: 1001; display: none; }
    .command-palette.open { display: block; animation: slideUp 0.2s ease; }
    .ai-widget-btn { position: fixed; bottom: 24px; right: 24px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4); z-index: 1000; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
    .ai-widget-btn:hover { transform: scale(1.1); }
    .notification-dot { position: absolute; top: 0; right: 0; width: 16px; height: 16px; background: #ef4444; border-radius: 50%; border: 2px solid white; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
    .ai-chat-panel { position: fixed; bottom: 100px; right: 24px; width: 420px; max-width: calc(100vw - 48px); height: 550px; max-height: calc(100vh - 150px); background: white; border-radius: 16px; box-shadow: 0 10px 50px rgba(0,0,0,0.2); z-index: 999; display: flex; flex-direction: column; overflow: hidden; opacity: 0; transform: translateY(20px) scale(0.95); pointer-events: none; transition: all 0.3s; }
    .ai-chat-panel.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }
    .ai-chat-header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid #F59E0B; }
    .ai-chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; background: #f8fafc; }
    .chat-message { max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; animation: slideUp 0.3s ease; }
    .chat-message.user { align-self: flex-end; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: #000; border-bottom-right-radius: 4px; }
    .chat-message.assistant { align-self: flex-start; background: white; color: #1e293b; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; }
    .chat-message.system { align-self: center; background: #fef3c7; color: #92400e; font-size: 12px; padding: 8px 16px; }
    .typing-indicator { display: flex; gap: 4px; padding: 12px 16px; background: white; border-radius: 16px; border: 1px solid #e2e8f0; align-self: flex-start; }
    .typing-indicator span { width: 8px; height: 8px; background: #94a3b8; border-radius: 50%; animation: bounce 1.4s infinite; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-8px); } }
    .quick-action-btn { padding: 6px 12px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 20px; font-size: 12px; color: #475569; cursor: pointer; transition: all 0.2s; }
    .quick-action-btn:hover { background: #fef3c7; border-color: #F59E0B; color: #92400e; }
    .notification-stack { position: fixed; top: 16px; right: 16px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
    .notification { animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .tutorial-btn { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; background: #e2e8f0; color: #64748b; font-size: 12px; font-weight: bold; cursor: pointer; margin-left: 6px; transition: all 0.2s; }
    .tutorial-btn:hover { background: #F59E0B; color: #000; }
    .tutorial-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1002; display: flex; align-items: center; justify-content: center; padding: 16px; }
    .tutorial-content { background: white; border-radius: 16px; max-width: 500px; width: 100%; padding: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); animation: slideUp 0.3s ease; }
    .dark .tutorial-content { background: #1e293b; color: #e2e8f0; }
    .comparison-card { transition: all 0.2s; }
    .comparison-card:hover { border-color: #6366F1; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15); }
  </style>
</head>
<body class="bg-slate-100 min-h-screen">
  <!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
      <div class="bg-black p-6 text-center border-b-4 border-yellow-400">
        <h1 class="text-yellow-400 font-extrabold text-3xl tracking-tight">BWANABET</h1>
        <p class="text-slate-400 text-sm mt-1">CRM System v1</p>
      </div>
      <div class="p-6 sm:p-8">
        <h2 class="text-xl font-bold text-slate-800 mb-6 text-center" data-translate="signIn">Sign In</h2>
        <div id="loginError" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Role</label>
            <select id="loginRole" class="w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-yellow-400 outline-none bg-white">
              <option value="admin">Administrator</option>
              <option value="developer">Developer</option>
              <option value="callcenter">Call Center</option>
            </select>
          </div>
          <div><label class="block text-sm font-medium text-slate-700 mb-1" data-translate="email">Email</label><input type="email" id="loginEmail" placeholder="you@example.com" class="w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-yellow-400 outline-none"/></div>
          <div><label class="block text-sm font-medium text-slate-700 mb-1" data-translate="password">Password</label><input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-yellow-400 outline-none"/></div>
          <button id="loginBtn" class="w-full py-3 bg-yellow-400 text-black font-bold rounded-lg hover:bg-yellow-300 flex items-center justify-center gap-2"><i data-lucide="log-in" class="h-5 w-5"></i> <span data-translate="signIn">Sign In</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="hidden">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100]">
      <div class="bg-white rounded-xl p-6 flex flex-col items-center gap-4 shadow-2xl">
        <svg class="spinner h-10 w-10 text-yellow-500" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
        <span class="text-lg font-medium text-slate-700" id="loadingText">Loading...</span>
      </div>
    </div>
    
    <!-- Notifications -->
    <div id="notificationStack" class="notification-stack"></div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="tutorial-modal hidden" onclick="if(event.target===this) closeTutorial()">
      <div class="tutorial-content">
        <div class="flex justify-between items-start mb-4">
          <h3 id="tutorialTitle" class="text-lg font-bold text-slate-800"></h3>
          <button onclick="closeTutorial()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x" class="h-5 w-5"></i></button>
        </div>
        <div id="tutorialBody" class="text-sm text-slate-600 leading-relaxed"></div>
      </div>
    </div>

    <!-- Parameters Modal -->
    <div id="paramsModal" class="fixed inset-0 bg-black/50 backdrop-filter backdrop-blur-sm z-50 hidden flex items-center justify-center p-4" onclick="if(event.target===this) closeParamsModal()">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
        <div class="bg-gradient-to-r from-slate-800 to-slate-900 p-5 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="p-2 bg-yellow-400 rounded-lg"><i data-lucide="sliders" class="h-5 w-5 text-black"></i></div>
            <div>
              <h2 class="text-lg font-bold text-white" data-translate="analysisParameters">Analysis Parameters</h2>
              <p class="text-slate-400 text-sm" data-translate="adjustThresholds">Adjust thresholds for data analysis</p>
            </div>
          </div>
          <button onclick="closeParamsModal()" class="text-slate-400 hover:text-white p-2"><i data-lucide="x" class="h-6 w-6"></i></button>
        </div>
        <div class="p-5 overflow-y-auto max-h-[calc(90vh-140px)]">
          <!-- Parameter Sections -->
          <div class="space-y-6">
            
            <!-- Profitability Parameters -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="trending-up" class="h-5 w-5 text-emerald-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="profitabilityParams">Profitability Parameters</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="profitabilityDesc">Win rate thresholds determine player profitability categories</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-emerald-700 mb-1" data-translate="mostProfitableMax">Most Profitable Max WR%</label>
                  <input type="number" id="param_winRate1" class="w-full px-3 py-2 border border-emerald-200 rounded-lg focus:ring-2 focus:ring-emerald-400 outline-none" min="0" max="100">
                  <p class="text-xs text-slate-400 mt-1">0% - <span id="wr1Preview">25</span>%</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-teal-700 mb-1" data-translate="profitableMax">Profitable Max WR%</label>
                  <input type="number" id="param_winRate2" class="w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-400 outline-none" min="0" max="100">
                  <p class="text-xs text-slate-400 mt-1"><span id="wr1bPreview">25</span>% - <span id="wr2Preview">40</span>%</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-red-700 mb-1" data-translate="negativeGgrMin">Negative GGR Min WR%</label>
                  <input type="number" id="param_winRate3" class="w-full px-3 py-2 border border-red-200 rounded-lg focus:ring-2 focus:ring-red-400 outline-none" min="0" max="100">
                  <p class="text-xs text-slate-400 mt-1">><span id="wr3Preview">50</span>%</p>
                </div>
              </div>
            </div>

            <!-- Value Segment Parameters -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="gem" class="h-5 w-5 text-purple-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="valueSegmentParams">Value Segment Parameters</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="valueSegmentDesc">Revenue thresholds for player value categorization (in K)</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-purple-700 mb-1">VIP Min (K)</label>
                  <input type="number" id="param_vipMin" class="w-full px-3 py-2 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-400 outline-none" min="0">
                  <p class="text-xs text-slate-400 mt-1">â‰¥K<span id="vipPreview">5000</span> = VIP</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-blue-700 mb-1" data-translate="highValueMin">High Value Min (K)</label>
                  <input type="number" id="param_highMin" class="w-full px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none" min="0">
                  <p class="text-xs text-slate-400 mt-1">K<span id="highPreview">1000</span>-K<span id="highMaxPreview">5000</span></p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-teal-700 mb-1" data-translate="mediumValueMin">Medium Value Min (K)</label>
                  <input type="number" id="param_mediumMin" class="w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-400 outline-none" min="0">
                  <p class="text-xs text-slate-400 mt-1">K<span id="medPreview">100</span>-K<span id="medMaxPreview">1000</span></p>
                </div>
              </div>
            </div>

            <!-- Betting Style Parameters -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="target" class="h-5 w-5 text-amber-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="bettingStyleParams">Betting Style Parameters</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="bettingStyleDesc">Average bet thresholds for player betting style (in K)</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-amber-700 mb-1" data-translate="highRollerMin">High Roller Min Avg Bet (K)</label>
                  <input type="number" id="param_highRollerMin" class="w-full px-3 py-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none" min="0">
                  <p class="text-xs text-slate-400 mt-1">â‰¥K<span id="hrPreview">100</span> = High Roller</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1" data-translate="casualMax">Casual Max Avg Bet (K)</label>
                  <input type="number" id="param_casualMax" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-slate-400 outline-none" min="0">
                  <p class="text-xs text-slate-400 mt-1">â‰¤K<span id="casualPreview">10</span> = Casual</p>
                </div>
              </div>
            </div>

            <!-- Lifecycle Parameters -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="calendar" class="h-5 w-5 text-cyan-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="lifecycleParams">Lifecycle Parameters</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="lifecycleDesc">Days threshold for new player classification</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-cyan-700 mb-1" data-translate="newPlayerDays">New Player Days</label>
                  <input type="number" id="param_newPlayerDays" class="w-full px-3 py-2 border border-cyan-200 rounded-lg focus:ring-2 focus:ring-cyan-400 outline-none" min="1">
                  <p class="text-xs text-slate-400 mt-1"><span id="newDaysPreview">30</span> days = New player</p>
                </div>
              </div>
            </div>

            <!-- Churn Risk Parameters -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="user-minus" class="h-5 w-5 text-red-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="churnParams">Churn Risk Parameters</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="churnDesc">Days since last activity thresholds for churn risk levels</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-emerald-700 mb-1" data-translate="lowRiskDays">Low Risk Days</label>
                  <input type="number" id="param_churnLowDays" class="w-full px-3 py-2 border border-emerald-200 rounded-lg focus:ring-2 focus:ring-emerald-400 outline-none" min="1">
                  <p class="text-xs text-slate-400 mt-1">â‰¤<span id="churnLowPreview">7</span> days</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-yellow-700 mb-1" data-translate="mediumRiskDays">Medium Risk Days</label>
                  <input type="number" id="param_churnMedDays" class="w-full px-3 py-2 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-400 outline-none" min="1">
                  <p class="text-xs text-slate-400 mt-1"><span id="churnLowPreview2">7</span>-<span id="churnMedPreview">14</span> days</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-orange-700 mb-1" data-translate="highRiskDays">High Risk Days</label>
                  <input type="number" id="param_churnHighDays" class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:ring-2 focus:ring-orange-400 outline-none" min="1">
                  <p class="text-xs text-slate-400 mt-1"><span id="churnMedPreview2">14</span>-<span id="churnHighPreview">30</span> days</p>
                </div>
              </div>
              <p class="text-xs text-red-600 mt-3"><i data-lucide="alert-circle" class="h-3 w-3 inline"></i> ><span id="churnCritPreview">30</span> <span data-translate="daysCritical">days = Critical risk</span></p>
            </div>

            <!-- Churn Score Weights -->
            <div class="border border-slate-200 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="scale" class="h-5 w-5 text-indigo-500"></i>
                <h3 class="font-bold text-slate-800" data-translate="churnWeights">Churn Score Weights</h3>
              </div>
              <p class="text-sm text-slate-500 mb-4" data-translate="churnWeightsDesc">Weights for calculating churn score (should sum to ~85)</p>
              <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
                <div>
                  <label class="block text-xs font-medium text-slate-700 mb-1" data-translate="inactivity">Inactivity</label>
                  <input type="number" id="param_churnWeightInactivity" class="w-full px-2 py-2 border rounded-lg text-sm" min="0" max="100">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-700 mb-1" data-translate="withdrawals">Withdrawals</label>
                  <input type="number" id="param_churnWeightWithdrawal" class="w-full px-2 py-2 border rounded-lg text-sm" min="0" max="100">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-700 mb-1" data-translate="frequency">Frequency</label>
                  <input type="number" id="param_churnWeightFrequency" class="w-full px-2 py-2 border rounded-lg text-sm" min="0" max="100">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-700 mb-1" data-translate="winRate">Win Rate</label>
                  <input type="number" id="param_churnWeightWinRate" class="w-full px-2 py-2 border rounded-lg text-sm" min="0" max="100">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-700 mb-1" data-translate="value">Value</label>
                  <input type="number" id="param_churnWeightValue" class="w-full px-2 py-2 border rounded-lg text-sm" min="0" max="100">
                </div>
              </div>
              <p class="text-xs text-slate-500 mt-2"><span data-translate="totalWeight">Total weight</span>: <span id="weightSum" class="font-bold">85</span>/100</p>
            </div>

          </div>
        </div>
        <!-- Footer -->
        <div class="p-4 bg-slate-50 border-t flex justify-between items-center">
          <button onclick="resetParamsToDefault()" class="flex items-center gap-2 px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg">
            <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
            <span data-translate="resetToDefault">Reset to Default</span>
          </button>
          <div class="flex gap-3">
            <button onclick="closeParamsModal()" class="px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg" data-translate="cancel">Cancel</button>
            <button onclick="saveParams()" class="flex items-center gap-2 px-6 py-2 bg-yellow-400 text-black font-bold rounded-lg hover:bg-yellow-300">
              <i data-lucide="check" class="h-4 w-4"></i>
              <span data-translate="saveAndApply">Save & Apply</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Command Palette -->
    <div id="commandPalette" class="command-palette">
      <div class="p-4 border-b"><div class="flex items-center gap-3"><i data-lucide="search" class="h-5 w-5 text-slate-400"></i><input type="text" id="commandInput" placeholder="Search players, run commands..." class="flex-1 text-lg outline-none" autocomplete="off"><span class="kbd">ESC</span></div></div>
      <div id="commandResults" class="max-h-80 overflow-y-auto p-2">
        <div class="text-xs text-slate-500 px-3 py-2" data-translate="quickActions">Quick Actions</div>
        <div class="px-3 py-2 rounded-lg hover:bg-slate-100 cursor-pointer flex items-center gap-3" onclick="switchTab('dashboard'); toggleCommandPalette(false)"><i data-lucide="layout-dashboard" class="h-4 w-4 text-slate-400"></i><span data-translate="dashboard">Dashboard</span><span class="ml-auto kbd">1</span></div>
        <div class="px-3 py-2 rounded-lg hover:bg-slate-100 cursor-pointer flex items-center gap-3" onclick="switchTab('players'); toggleCommandPalette(false)"><i data-lucide="users" class="h-4 w-4 text-slate-400"></i><span data-translate="players">Players</span><span class="ml-auto kbd">5</span></div>
        <div class="px-3 py-2 rounded-lg hover:bg-slate-100 cursor-pointer flex items-center gap-3" onclick="exportFiltered('all','all'); toggleCommandPalette(false)"><i data-lucide="download" class="h-4 w-4 text-slate-400"></i><span data-translate="exportAll">Export All</span><span class="ml-auto kbd">Ctrl+E</span></div>
        <div class="px-3 py-2 rounded-lg hover:bg-slate-100 cursor-pointer flex items-center gap-3" onclick="AIAgent.toggle(); toggleCommandPalette(false)"><i data-lucide="bot" class="h-4 w-4 text-slate-400"></i><span>AI Assistant</span><span class="ml-auto kbd">Ctrl+/</span></div>
      </div>
    </div>
    <div id="commandOverlay" class="fixed inset-0 bg-black/50 z-[1000] hidden" onclick="toggleCommandPalette(false)"></div>

    <!-- Header -->
    <header class="bg-black shadow-md border-b-4 border-yellow-400 sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <h1 id="headerTitle" class="text-yellow-400 font-extrabold text-xl sm:text-2xl">BWANABET</h1>
            <span id="headerVersion" class="hidden sm:inline text-slate-500 text-xs border border-slate-700 px-2 py-1 rounded">v1</span>
            <span id="headerRoleBadge" class="hidden text-xs px-2 py-1 rounded font-medium"></span>
          </div>
          <div class="flex items-center gap-2 sm:gap-4">
            <button id="headerSearchBtn" onclick="toggleCommandPalette(true)" class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-slate-800 rounded-lg text-slate-400 hover:text-white text-sm"><i data-lucide="search" class="h-4 w-4"></i><span data-translate="search">Search</span><span class="kbd text-xs">âŒ˜K</span></button>
            
            <!-- Parameters Button -->
            <button id="headerParamsBtn" onclick="openParamsModal()" class="flex items-center gap-1 px-2 py-1.5 bg-slate-800 rounded-lg text-slate-400 hover:text-yellow-400 text-sm" title="Analysis Parameters">
              <i data-lucide="sliders" class="h-4 w-4"></i>
              <span class="hidden sm:inline" data-translate="parameters">Parameters</span>
            </button>
            
            <!-- Language Selector -->
            <select id="languageSelect" class="px-2 py-1.5 bg-slate-700 text-slate-300 rounded-lg text-sm border-none cursor-pointer hover:bg-slate-600">
              <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
              <option value="ru">ðŸ‡·ðŸ‡º RU</option>
            </select>
            
            <button id="headerDarkBtn" onclick="toggleDarkMode()" class="p-2 text-slate-400 hover:text-white rounded-lg"><i data-lucide="moon" class="h-5 w-5"></i></button>
            <div class="flex items-center gap-2 text-emerald-400 text-xs"><span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span><span class="hidden sm:inline" data-translate="connected">Connected</span></div>
            <span id="userEmail" class="hidden sm:inline text-white text-sm truncate max-w-[150px]">user</span>
            <button id="logoutBtn" class="text-slate-400 hover:text-white p-2"><i data-lucide="log-out" class="h-5 w-5"></i></button>
          </div>
        </div>
        <nav id="mainNav" class="flex gap-1 mt-3 overflow-x-auto pb-1">
          <button id="tab-dashboard" class="tab-btn active px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="layout-dashboard" class="h-4 w-4"></i><span data-translate="dashboard">Dashboard</span></button>
          <button id="tab-profitability" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="trending-up" class="h-4 w-4"></i><span data-translate="profitability">Profitability</span></button>
          <button id="tab-behavior" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="activity" class="h-4 w-4"></i><span data-translate="behavior">Behavior</span></button>
          <button id="tab-churn" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="user-minus" class="h-4 w-4"></i><span data-translate="churn">Churn</span></button>
          <button id="tab-analytics" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="bar-chart-3" class="h-4 w-4"></i><span data-translate="analytics">Analytics</span></button>
          <button id="tab-players" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="users" class="h-4 w-4"></i><span data-translate="players">Players</span></button>
          <button id="tab-callcenter" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="phone" class="h-4 w-4"></i><span>Call Center</span></button>
          <button id="tab-settings" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white flex items-center gap-2"><i data-lucide="settings" class="h-4 w-4"></i><span data-translate="settings">Settings</span></button>
        </nav>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
      <!-- DASHBOARD -->
      <div id="content-dashboard" class="tab-content">
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-xl font-bold text-slate-800" data-translate="dashboard">Dashboard</h2>
          <button class="tutorial-btn" onclick="showTutorial('dashboard')">?</button>
        </div>
        
        <!-- AI Alerts -->
        <div id="aiAlertsBanner" class="mb-6 hidden">
          <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4">
            <div class="flex items-start gap-3">
              <div class="p-2 bg-amber-100 rounded-lg"><i data-lucide="bell-ring" class="h-5 w-5 text-amber-600"></i></div>
              <div class="flex-1"><h3 class="font-semibold text-amber-800" data-translate="aiInsights">AI Insights</h3><div id="aiAlertsContent" class="text-sm text-amber-700 mt-1"></div></div>
              <button onclick="document.getElementById('aiAlertsBanner').classList.add('hidden')" class="text-amber-400 hover:text-amber-600"><i data-lucide="x" class="h-5 w-5"></i></button>
            </div>
          </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div class="clickable-card bg-white rounded-xl p-5 shadow-sm" onclick="switchTab('players')">
            <div class="flex items-center justify-between">
              <div><p class="text-sm text-slate-500 flex items-center gap-1" data-translate="totalPlayers">Total Players <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('total_players')">?</button></p><p class="text-3xl font-bold text-slate-800 mt-1" id="metric-total">0</p></div>
              <div class="p-3 bg-slate-100 rounded-xl"><i data-lucide="users" class="h-6 w-6 text-slate-600"></i></div>
            </div>
          </div>
          <div class="clickable-card bg-white rounded-xl p-5 shadow-sm" onclick="showFilteredPlayers('profitable', 'Profitable')">
            <div class="flex items-center justify-between">
              <div><p class="text-sm text-slate-500 flex items-center gap-1" data-translate="profitablePlayers">Profitable <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('profitable_card')">?</button></p><p class="text-3xl font-bold text-emerald-600 mt-1" id="metric-profitable">0</p><p class="text-xs text-emerald-500" id="metric-profit-amount"></p></div>
              <div class="p-3 bg-emerald-100 rounded-xl"><i data-lucide="trending-up" class="h-6 w-6 text-emerald-600"></i></div>
            </div>
          </div>
          <div class="clickable-card bg-white rounded-xl p-5 shadow-sm" onclick="showFilteredPlayers('negative_ggr', 'Negative GGR')">
            <div class="flex items-center justify-between">
              <div><p class="text-sm text-slate-500 flex items-center gap-1" data-translate="negativeGgrPlayers">Negative GGR <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('negative_ggr_card')">?</button></p><p class="text-3xl font-bold text-red-600 mt-1" id="metric-negative-ggr">0</p><p class="text-xs text-red-500" id="metric-negative-amount"></p></div>
              <div class="p-3 bg-red-100 rounded-xl"><i data-lucide="trending-down" class="h-6 w-6 text-red-600"></i></div>
            </div>
          </div>
          <div class="clickable-card bg-white rounded-xl p-5 shadow-sm" onclick="showFilteredPlayers('atrisk', 'At Risk')">
            <div class="flex items-center justify-between">
              <div><p class="text-sm text-slate-500 flex items-center gap-1" data-translate="atRisk">At Risk <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('at_risk_card')">?</button></p><p class="text-3xl font-bold text-orange-600 mt-1" id="metric-atrisk">0</p><p class="text-xs text-orange-500" id="metric-atrisk-value"></p></div>
              <div class="p-3 bg-orange-100 rounded-xl"><i data-lucide="alert-triangle" class="h-6 w-6 text-orange-600"></i></div>
            </div>
          </div>
        </div>

        <!-- Financial -->
        <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
          <div class="flex items-center gap-2 mb-4">
            <h3 class="font-bold text-slate-800" data-translate="financialOverview">Financial Overview</h3>
            <button class="tutorial-btn" onclick="showTutorial('financial')">?</button>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="p-4 bg-emerald-50 rounded-xl"><p class="text-sm text-emerald-600"><i data-lucide="arrow-down-circle" class="h-4 w-4 inline"></i> <span data-translate="totalDeposits">Deposits</span></p><p class="text-2xl font-bold text-emerald-700" id="fin-deposits">K0</p></div>
            <div class="p-4 bg-red-50 rounded-xl"><p class="text-sm text-red-600"><i data-lucide="arrow-up-circle" class="h-4 w-4 inline"></i> <span data-translate="totalWithdrawals">Withdrawals</span></p><p class="text-2xl font-bold text-red-700" id="fin-withdrawals">K0</p></div>
            <div class="p-4 bg-blue-50 rounded-xl"><p class="text-sm text-blue-600"><i data-lucide="wallet" class="h-4 w-4 inline"></i> <span data-translate="netRevenue">Net GGR</span></p><p class="text-2xl font-bold text-blue-700" id="fin-net">K0</p></div>
          </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="profitabilityOverview">Profitability</h3>
              <button class="tutorial-btn" onclick="showTutorial('profitability_chart')">?</button>
            </div>
            <div class="h-64"><canvas id="dashProfitChart"></canvas></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="churnRiskOverview">Churn Risk</h3>
              <button class="tutorial-btn" onclick="showTutorial('churn_chart')">?</button>
            </div>
            <div class="h-64"><canvas id="dashChurnChart"></canvas></div>
          </div>
        </div>

        <!-- Quick Segments -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="bg-white rounded-xl shadow-sm p-4">
            <div class="flex items-center gap-2 mb-3">
              <h4 class="text-sm font-medium text-slate-500" data-translate="valueSegments">Value Segments</h4>
              <button class="tutorial-btn" onclick="showTutorial('value_segments')">?</button>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('value_vip','VIP')"><span class="text-xs text-purple-600">ðŸ‘‘ VIP</span><span class="font-bold" id="seg-vip">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('value_high','High')"><span class="text-xs text-blue-600" data-translate="highValue">High</span><span class="font-bold" id="seg-high">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('value_medium','Medium')"><span class="text-xs text-teal-600" data-translate="mediumValue">Medium</span><span class="font-bold" id="seg-medium">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('value_low','Low')"><span class="text-xs text-slate-600" data-translate="lowValue">Low</span><span class="font-bold" id="seg-low">0</span></div>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-4">
            <div class="flex items-center gap-2 mb-3">
              <h4 class="text-sm font-medium text-slate-500" data-translate="playerPreferences">Preferences</h4>
              <button class="tutorial-btn" onclick="showTutorial('preferences')">?</button>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('pref_sports','Sports')"><span class="text-xs text-green-600">âš½ <span data-translate="sportsBettors">Sports</span></span><span class="font-bold" id="pref-sports">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('pref_casino','Casino')"><span class="text-xs text-purple-600">ðŸŽ° <span data-translate="casinoPlayers">Casino</span></span><span class="font-bold" id="pref-casino">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('pref_mixed','Mixed')"><span class="text-xs text-blue-600">ðŸŽ¯ <span data-translate="mixedPlayers">Mixed</span></span><span class="font-bold" id="pref-mixed">0</span></div>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-4">
            <div class="flex items-center gap-2 mb-3">
              <h4 class="text-sm font-medium text-slate-500" data-translate="churnRisk">Churn Risk</h4>
              <button class="tutorial-btn" onclick="showTutorial('churn_risk')">?</button>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('churn_critical','Critical')"><span class="text-xs text-red-600">ðŸ”´ <span data-translate="critical">Critical</span></span><span class="font-bold text-red-700" id="churn-critical">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('churn_high','High')"><span class="text-xs text-orange-600">ðŸŸ  <span data-translate="highRisk">High</span></span><span class="font-bold text-orange-700" id="churn-high">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('churn_medium','Medium')"><span class="text-xs text-yellow-600">ðŸŸ¡ <span data-translate="mediumRisk">Medium</span></span><span class="font-bold text-yellow-700" id="churn-medium">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('churn_low','Low')"><span class="text-xs text-emerald-600">ðŸŸ¢ <span data-translate="lowRisk">Low</span></span><span class="font-bold text-emerald-700" id="churn-low">0</span></div>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-4">
            <div class="flex items-center gap-2 mb-3">
              <h4 class="text-sm font-medium text-slate-500" data-translate="alerts">Alerts</h4>
              <button class="tutorial-btn" onclick="showTutorial('alerts')">?</button>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('withdrawing','Withdrawing')"><span class="text-xs text-amber-600">ðŸ’¸ <span data-translate="withdrawingProfits">Withdrawing</span></span><span class="font-bold" id="alert-withdrawing">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('virtual','Virtual Phone')"><span class="text-xs text-red-600">ðŸ“± <span data-translate="virtualPhone">Virtual</span></span><span class="font-bold" id="alert-virtual">0</span></div>
              <div class="flex justify-between cursor-pointer hover:bg-slate-50 p-1 rounded" onclick="showFilteredPlayers('highwin','High WR')"><span class="text-xs text-blue-600">ðŸŽ¯ High WR</span><span class="font-bold" id="alert-highwin">0</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- PROFITABILITY -->
      <div id="content-profitability" class="tab-content hidden">
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-xl font-bold text-slate-800" data-translate="playerProfitabilityAnalysis">Profitability Analysis</h2>
          <button class="tutorial-btn" onclick="showTutorial('profitability')">?</button>
        </div>
        <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-lg mb-6">
          <p class="text-amber-700 text-sm"><strong data-translate="profitablePlayers">Profitable</strong> = <span data-translate="lostMoreThanWon">Lost more (company earns)</span> | <strong data-translate="negativeGgrPlayers">Negative GGR</strong> = <span data-translate="wonMoreThanLost">Won more (company loses)</span></p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="profitabilityDistribution">Distribution</h3>
              <button class="tutorial-btn" onclick="showTutorial('profit_distribution')">?</button>
            </div>
            <div class="h-64"><canvas id="profitDistChart"></canvas></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="winRateDistribution">Win Rate</h3>
              <button class="tutorial-btn" onclick="showTutorial('winrate')">?</button>
            </div>
            <div class="h-64"><canvas id="winRateDistChart"></canvas></div>
          </div>
        </div>
        <div class="flex items-center gap-2 mb-3">
          <h4 class="text-sm font-semibold text-slate-600">Summary Cards</h4>
          <button class="tutorial-btn" onclick="showTutorial('profit_summary')">?</button>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
          <div class="clickable-card bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl p-6 text-white" onclick="showFilteredPlayers('profitable','Profitable')">
            <h3 class="text-xl font-bold" data-translate="profitablePlayers">Profitable</h3><p class="text-5xl font-bold mt-2" id="profit-count">0</p><p class="text-emerald-100 mt-2"><span data-translate="companyProfit">Profit</span>: <span id="profit-amount">K0</span></p>
          </div>
          <div class="clickable-card bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-6 text-white" onclick="showFilteredPlayers('negative_ggr','Negative GGR')">
            <h3 class="text-xl font-bold" data-translate="negativeGgrPlayers">Negative GGR</h3><p class="text-5xl font-bold mt-2" id="negative-ggr-count">0</p><p class="text-red-100 mt-2"><span data-translate="companyLoss">Loss</span>: <span id="negative-ggr-amount">K0</span></p>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-5">
          <div class="flex items-center gap-2 mb-4">
            <h3 class="font-bold text-slate-800" data-translate="winRateDistribution">Win Rate Segments</h3>
            <button class="tutorial-btn" onclick="showTutorial('winrate_segments')">?</button>
          </div>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
            <div class="clickable-card p-4 bg-emerald-50 rounded-lg text-center" onclick="showFilteredPlayers('wr_0_25','WR 0-25%')"><p class="text-xs text-emerald-600">0-25% (<span data-translate="mostProfitable">Most Profitable</span>)</p><p class="text-2xl font-bold text-emerald-700" id="wr-0-25">0</p></div>
            <div class="clickable-card p-4 bg-teal-50 rounded-lg text-center" onclick="showFilteredPlayers('wr_25_40','WR 25-40%')"><p class="text-xs text-teal-600">25-40% (<span data-translate="profitable">Profitable</span>)</p><p class="text-2xl font-bold text-teal-700" id="wr-25-40">0</p></div>
            <div class="clickable-card p-4 bg-yellow-50 rounded-lg text-center" onclick="showFilteredPlayers('wr_40_50','WR 40-50%')"><p class="text-xs text-yellow-600">40-50% (<span data-translate="breakEven">Break Even</span>)</p><p class="text-2xl font-bold text-yellow-700" id="wr-40-50">0</p></div>
            <div class="clickable-card p-4 bg-red-50 rounded-lg text-center" onclick="showFilteredPlayers('wr_50_plus','WR 50%+')"><p class="text-xs text-red-600">50%+ (<span data-translate="negativeGgr">Negative GGR</span>)</p><p class="text-2xl font-bold text-red-700" id="wr-50-plus">0</p></div>
          </div>
        </div>
      </div>

      <!-- BEHAVIOR -->
      <div id="content-behavior" class="tab-content hidden">
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-xl font-bold text-slate-800" data-translate="playerBehavior">Behavior Analysis</h2>
          <button class="tutorial-btn" onclick="showTutorial('behavior')">?</button>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="bettingStyles">Betting Styles</h3>
              <button class="tutorial-btn" onclick="showTutorial('betting_styles')">?</button>
            </div>
            <div class="h-64"><canvas id="bettingStyleChart"></canvas></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="lifecycleStages">Lifecycle</h3>
              <button class="tutorial-btn" onclick="showTutorial('lifecycle')">?</button>
            </div>
            <div class="h-64"><canvas id="lifecycleChart"></canvas></div>
          </div>
        </div>
        <div class="flex items-center gap-2 mb-3">
          <h4 class="text-sm font-semibold text-slate-600">Betting Style Distribution</h4>
          <button class="tutorial-btn" onclick="showTutorial('style_cards')">?</button>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
          <div class="clickable-card bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('style_highroller','High Rollers')"><h3 class="font-bold" data-translate="highRollers">High Rollers</h3><p class="text-white/80 text-sm" data-translate="avgBetOver100">Avg bet >K100</p><p class="text-4xl font-bold mt-2" id="style-highroller">0</p></div>
          <div class="clickable-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('style_regular','Regular')"><h3 class="font-bold" data-translate="regularBettors">Regular</h3><p class="text-white/80 text-sm" data-translate="avgBet10to100">Avg bet K10-100</p><p class="text-4xl font-bold mt-2" id="style-regular">0</p></div>
          <div class="clickable-card bg-gradient-to-br from-slate-500 to-slate-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('style_casual','Casual')"><h3 class="font-bold" data-translate="casualPlayers">Casual</h3><p class="text-white/80 text-sm" data-translate="avgBetUnder10">Avg bet <K10</p><p class="text-4xl font-bold mt-2" id="style-casual">0</p></div>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-5">
          <div class="flex items-center gap-2 mb-4">
            <h3 class="font-bold text-slate-800" data-translate="lifecycleStages">Lifecycle Stages</h3>
            <button class="tutorial-btn" onclick="showTutorial('lifecycle_stages')">?</button>
          </div>
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
            <div class="clickable-card p-3 bg-cyan-50 rounded-lg text-center" onclick="showFilteredPlayers('life_new','New')"><p class="text-2xl font-bold text-cyan-600" id="life-new">0</p><p class="text-xs text-cyan-700" data-translate="new">New</p></div>
            <div class="clickable-card p-3 bg-emerald-50 rounded-lg text-center" onclick="showFilteredPlayers('life_growing','Growing')"><p class="text-2xl font-bold text-emerald-600" id="life-growing">0</p><p class="text-xs text-emerald-700" data-translate="growing">Growing</p></div>
            <div class="clickable-card p-3 bg-purple-50 rounded-lg text-center" onclick="showFilteredPlayers('life_mature','Mature')"><p class="text-2xl font-bold text-purple-600" id="life-mature">0</p><p class="text-xs text-purple-700" data-translate="mature">Mature</p></div>
            <div class="clickable-card p-3 bg-yellow-50 rounded-lg text-center" onclick="showFilteredPlayers('life_declining','Declining')"><p class="text-2xl font-bold text-yellow-600" id="life-declining">0</p><p class="text-xs text-yellow-700" data-translate="declining">Declining</p></div>
            <div class="clickable-card p-3 bg-orange-50 rounded-lg text-center" onclick="showFilteredPlayers('life_dormant','Dormant')"><p class="text-2xl font-bold text-orange-600" id="life-dormant">0</p><p class="text-xs text-orange-700" data-translate="dormant">Dormant</p></div>
            <div class="clickable-card p-3 bg-red-50 rounded-lg text-center" onclick="showFilteredPlayers('life_churned','Churned')"><p class="text-2xl font-bold text-red-600" id="life-churned">0</p><p class="text-xs text-red-700" data-translate="churned">Churned</p></div>
          </div>
        </div>
      </div>

      <!-- CHURN -->
      <div id="content-churn" class="tab-content hidden">
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-xl font-bold text-slate-800" data-translate="churnRiskAnalysis">Churn Risk Analysis</h2>
          <button class="tutorial-btn" onclick="showTutorial('churn')">?</button>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800" data-translate="churnDistribution">Risk Distribution</h3>
              <button class="tutorial-btn" onclick="showTutorial('churn_distribution')">?</button>
            </div>
            <div class="h-64"><canvas id="churnDistChart"></canvas></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800">Score Distribution</h3>
              <button class="tutorial-btn" onclick="showTutorial('churn_score')">?</button>
            </div>
            <div class="h-64"><canvas id="churnScoreChart"></canvas></div>
          </div>
        </div>
        <div class="flex items-center gap-2 mb-3">
          <h4 class="text-sm font-semibold text-slate-600">Risk Level Breakdown</h4>
          <button class="tutorial-btn" onclick="showTutorial('churn_factors')">?</button>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
          <div class="clickable-card bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('churn_critical','Critical')"><h3 class="font-bold" data-translate="critical">Critical</h3><p class="text-red-100 text-sm" data-translate="over30Days">30+ days</p><p class="text-4xl font-bold mt-2" id="churn-d-critical">0</p><p class="text-sm text-red-100"><span data-translate="atRisk">At risk</span>: <span id="churn-critical-value">K0</span></p></div>
          <div class="clickable-card bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('churn_high','High')"><h3 class="font-bold" data-translate="highRisk">High</h3><p class="text-orange-100 text-sm" data-translate="days14to30">14-30 days</p><p class="text-4xl font-bold mt-2" id="churn-d-high">0</p><p class="text-sm text-orange-100"><span data-translate="atRisk">At risk</span>: <span id="churn-high-value">K0</span></p></div>
          <div class="clickable-card bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('churn_medium','Medium')"><h3 class="font-bold" data-translate="mediumRisk">Medium</h3><p class="text-yellow-100 text-sm" data-translate="days7to14">7-14 days</p><p class="text-4xl font-bold mt-2" id="churn-d-medium">0</p></div>
          <div class="clickable-card bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl p-5 text-white" onclick="showFilteredPlayers('churn_low','Low')"><h3 class="font-bold" data-translate="lowRisk">Low</h3><p class="text-emerald-100 text-sm" data-translate="lessThan7Days"><7 days</p><p class="text-4xl font-bold mt-2" id="churn-d-low">0</p></div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div id="content-analytics" class="tab-content hidden">
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-xl font-bold text-slate-800" data-translate="analytics">Advanced Analytics</h2>
          <button class="tutorial-btn" onclick="showTutorial('analytics')">?</button>
        </div>
        
        <!-- Data Comparison Section -->
        <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
            <div class="flex items-center gap-2">
              <i data-lucide="git-compare" class="h-5 w-5 text-indigo-500"></i>
              <h3 class="font-bold text-slate-800" data-translate="dataComparison">Data Comparison</h3>
              <button class="tutorial-btn" onclick="showTutorial('data_comparison')">?</button>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <select id="comparisonPreset" class="px-3 py-2 border rounded-lg text-sm" onchange="applyComparisonPreset()">
                <option value="7d" data-translate="last7vs7">Last 7 days vs Previous 7</option>
                <option value="14d" data-translate="last14vs14">Last 14 days vs Previous 14</option>
                <option value="30d" data-translate="last30vs30">Last 30 days vs Previous 30</option>
                <option value="90d" data-translate="last90vs90">Last 90 days vs Previous 90</option>
                <option value="custom" data-translate="customRange">Custom Range</option>
              </select>
              <button onclick="runComparison()" class="px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 flex items-center gap-2">
                <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                <span data-translate="compare">Compare</span>
              </button>
            </div>
          </div>
          
          <!-- Custom Date Range (hidden by default) -->
          <div id="customDateRange" class="hidden mb-6 p-4 bg-slate-50 rounded-lg">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              <div>
                <label class="block text-xs text-slate-600 mb-1" data-translate="period1Start">Period 1 Start</label>
                <input type="date" id="period1Start" class="w-full px-3 py-2 border rounded-lg text-sm">
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1" data-translate="period1End">Period 1 End</label>
                <input type="date" id="period1End" class="w-full px-3 py-2 border rounded-lg text-sm">
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1" data-translate="period2Start">Period 2 Start</label>
                <input type="date" id="period2Start" class="w-full px-3 py-2 border rounded-lg text-sm">
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1" data-translate="period2End">Period 2 End</label>
                <input type="date" id="period2End" class="w-full px-3 py-2 border rounded-lg text-sm">
              </div>
            </div>
          </div>
          
          <!-- Period Labels -->
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="text-center p-2 bg-indigo-50 rounded-lg">
              <span class="text-sm font-medium text-indigo-700" id="period1Label">Current Period</span>
            </div>
            <div class="text-center p-2 bg-slate-100 rounded-lg">
              <span class="text-sm font-medium text-slate-700" id="period2Label">Previous Period</span>
            </div>
          </div>
          
          <!-- Comparison Metrics Grid -->
          <div class="flex items-center gap-2 mb-3">
            <h4 class="text-sm font-semibold text-slate-600">Quick Metrics</h4>
            <button class="tutorial-btn" onclick="showTutorial('comparison_cards')">?</button>
          </div>
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-6" id="comparisonMetrics">
            <!-- New Players -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="newPlayers">New Players</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-slate-800" id="comp-newPlayers-p1">0</p>
                  <p class="text-sm text-slate-500" id="comp-newPlayers-p2">vs 0</p>
                </div>
                <div id="comp-newPlayers-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- Total Deposits -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="totalDeposits">Total Deposits</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-emerald-600" id="comp-deposits-p1">K0</p>
                  <p class="text-sm text-slate-500" id="comp-deposits-p2">vs K0</p>
                </div>
                <div id="comp-deposits-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- Total Withdrawals -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="totalWithdrawals">Total Withdrawals</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-red-600" id="comp-withdrawals-p1">K0</p>
                  <p class="text-sm text-slate-500" id="comp-withdrawals-p2">vs K0</p>
                </div>
                <div id="comp-withdrawals-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- Net GGR -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="netGgr">Net GGR</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-blue-600" id="comp-ggr-p1">K0</p>
                  <p class="text-sm text-slate-500" id="comp-ggr-p2">vs K0</p>
                </div>
                <div id="comp-ggr-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- Avg Deposit -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="avgDeposit">Avg Deposit</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-slate-800" id="comp-avgDeposit-p1">K0</p>
                  <p class="text-sm text-slate-500" id="comp-avgDeposit-p2">vs K0</p>
                </div>
                <div id="comp-avgDeposit-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- Avg Win Rate -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="avgWinRate">Avg Win Rate</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-slate-800" id="comp-avgWinRate-p1">0%</p>
                  <p class="text-sm text-slate-500" id="comp-avgWinRate-p2">vs 0%</p>
                </div>
                <div id="comp-avgWinRate-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- VIP Players -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1">VIP Players</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-purple-600" id="comp-vip-p1">0</p>
                  <p class="text-sm text-slate-500" id="comp-vip-p2">vs 0</p>
                </div>
                <div id="comp-vip-change" class="text-sm font-medium"></div>
              </div>
            </div>
            
            <!-- At Risk Players -->
            <div class="comparison-card p-4 border rounded-xl">
              <p class="text-xs text-slate-500 mb-1" data-translate="atRiskPlayers">At Risk Players</p>
              <div class="flex items-end justify-between">
                <div>
                  <p class="text-xl font-bold text-orange-600" id="comp-atRisk-p1">0</p>
                  <p class="text-sm text-slate-500" id="comp-atRisk-p2">vs 0</p>
                </div>
                <div id="comp-atRisk-change" class="text-sm font-medium"></div>
              </div>
            </div>
          </div>
          
          <!-- Comparison Charts -->
          <div class="flex items-center gap-2 mb-3 mt-6">
            <h4 class="text-sm font-semibold text-slate-600">Visual Comparison</h4>
            <button class="tutorial-btn" onclick="showTutorial('comparison_charts')">?</button>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="border rounded-xl p-4">
              <h4 class="font-medium text-slate-700 mb-3" data-translate="revenueComparison">Revenue Comparison</h4>
              <div class="h-64"><canvas id="comparisonRevenueChart"></canvas></div>
            </div>
            <div class="border rounded-xl p-4">
              <h4 class="font-medium text-slate-700 mb-3" data-translate="segmentComparison">Segment Comparison</h4>
              <div class="h-64"><canvas id="comparisonSegmentChart"></canvas></div>
            </div>
          </div>
          
          <!-- Detailed Breakdown Table -->
          <div class="mt-6">
            <h4 class="font-medium text-slate-700 mb-3 flex items-center gap-2">
              <i data-lucide="table" class="h-4 w-4"></i>
              <span data-translate="detailedBreakdown">Detailed Breakdown</span>
              <button class="tutorial-btn" onclick="showTutorial('comparison_table')">?</button>
            </h4>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-slate-50">
                  <tr>
                    <th class="px-4 py-3 text-left font-semibold text-slate-600" data-translate="metric">Metric</th>
                    <th class="px-4 py-3 text-right font-semibold text-indigo-600" id="tableP1Header">Period 1</th>
                    <th class="px-4 py-3 text-right font-semibold text-slate-600" id="tableP2Header">Period 2</th>
                    <th class="px-4 py-3 text-right font-semibold text-slate-600" data-translate="change">Change</th>
                    <th class="px-4 py-3 text-center font-semibold text-slate-600" data-translate="trend">Trend</th>
                  </tr>
                </thead>
                <tbody id="comparisonTableBody">
                  <!-- Populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800">LTV Distribution</h3>
              <button class="tutorial-btn" onclick="showTutorial('ltv')">?</button>
            </div>
            <div class="h-64"><canvas id="ltvDistChart"></canvas></div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <div class="flex items-center gap-2 mb-4">
              <h3 class="font-bold text-slate-800">Segment Comparison</h3>
              <button class="tutorial-btn" onclick="showTutorial('comparison')">?</button>
            </div>
            <div class="flex gap-2 mb-4">
              <select id="compare1" class="text-sm border rounded px-2 py-1" onchange="updateComparison()"><option value="vip">VIP</option><option value="high">High</option><option value="medium">Medium</option><option value="low">Low</option></select>
              <span class="text-slate-400">vs</span>
              <select id="compare2" class="text-sm border rounded px-2 py-1" onchange="updateComparison()"><option value="vip">VIP</option><option value="high" selected>High</option><option value="medium">Medium</option><option value="low">Low</option></select>
            </div>
            <div id="comparisonResult" class="grid grid-cols-2 gap-4 text-sm"></div>
          </div>
        </div>
      </div>

      <!-- PLAYERS -->
      <div id="content-players" class="tab-content hidden">
        <div class="flex flex-col lg:flex-row gap-4">
          <!-- Filters Sidebar -->
          <div class="lg:w-64 flex-shrink-0">
            <div class="bg-white rounded-xl shadow-sm p-4 sticky top-24 space-y-4">
              <!-- Filters Section -->
              <div>
                <div class="flex justify-between items-center mb-4">
                  <div class="flex items-center gap-2">
                    <h3 class="font-bold text-slate-800">Filters</h3>
                    <button class="tutorial-btn" onclick="showTutorial('filters')">?</button>
                  </div>
                  <button onclick="clearAllFilters()" class="text-xs text-slate-500" data-translate="clear">Clear</button>
                </div>
                <div class="space-y-3">
                  <div><label class="block text-xs text-slate-600 mb-1" data-translate="search">Search</label><input type="text" id="searchInput" placeholder="ID or phone..." class="w-full px-3 py-2 border rounded-lg text-sm"></div>
                  <div><label class="block text-xs text-slate-600 mb-1" data-translate="profitability">Profitability</label><select id="profitFilter" class="w-full px-3 py-2 border rounded-lg text-sm"><option value="">All</option><option value="profitable" data-translate="profitable">Profitable</option><option value="negative" data-translate="negativeGgr">Negative GGR</option></select></div>
                  <div><label class="block text-xs text-slate-600 mb-1" data-translate="preference">Preference</label><select id="prefFilter" class="w-full px-3 py-2 border rounded-lg text-sm"><option value="">All</option><option value="sports" data-translate="sports">Sports</option><option value="casino" data-translate="casino">Casino</option><option value="mixed" data-translate="mixed">Mixed</option></select></div>
                  <div><label class="block text-xs text-slate-600 mb-1" data-translate="churnRisk">Churn Risk</label><select id="churnFilter" class="w-full px-3 py-2 border rounded-lg text-sm"><option value="">All</option><option value="critical" data-translate="critical">Critical</option><option value="high" data-translate="high">High</option><option value="medium" data-translate="medium">Medium</option><option value="low" data-translate="low">Low</option></select></div>
                  <div><label class="block text-xs text-slate-600 mb-1" data-translate="value">Value</label><select id="valueFilter" class="w-full px-3 py-2 border rounded-lg text-sm"><option value="">All</option><option value="vip">VIP</option><option value="high" data-translate="high">High</option><option value="medium" data-translate="medium">Medium</option><option value="low" data-translate="low">Low</option></select></div>
                  <div class="flex gap-2">
                    <button onclick="filterTable()" class="flex-1 py-2 bg-yellow-400 text-black font-medium rounded-lg" data-translate="apply">Apply</button>
                    <button onclick="saveCurrentFilter()" class="p-2 bg-slate-100 hover:bg-slate-200 rounded-lg" title="Save Filter"><i data-lucide="save" class="h-4 w-4"></i></button>
                  </div>
                </div>
              </div>
              
              <!-- Saved Filters -->
              <div class="border-t pt-4">
                <h4 class="text-xs font-semibold text-slate-500 uppercase mb-2 flex items-center gap-2">
                  <i data-lucide="bookmark" class="h-3 w-3"></i>
                  <span data-translate="savedFilters">Saved Filters</span>
                  <button class="tutorial-btn ml-auto" onclick="showTutorial('saved_filters')">?</button>
                </h4>
                <div id="savedFiltersList" class="space-y-2 max-h-32 overflow-y-auto">
                  <p class="text-xs text-slate-400 italic" data-translate="noSavedFilters">No saved filters</p>
                </div>
              </div>
              
              <!-- Watchlist -->
              <div class="border-t pt-4">
                <h4 class="text-xs font-semibold text-slate-500 uppercase mb-2 flex items-center gap-2">
                  <i data-lucide="star" class="h-3 w-3 text-yellow-500"></i>
                  <span data-translate="watchlist">Watchlist</span>
                  <button class="tutorial-btn" onclick="showTutorial('watchlist')">?</button>
                  <span class="ml-auto text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full" id="watchlistCount">0</span>
                </h4>
                <div id="watchlistPanel" class="space-y-1 max-h-40 overflow-y-auto">
                  <p class="text-xs text-slate-400 italic" data-translate="noWatchedPlayers">No watched players</p>
                </div>
              </div>
              
              <!-- Recently Viewed -->
              <div class="border-t pt-4">
                <h4 class="text-xs font-semibold text-slate-500 uppercase mb-2 flex items-center gap-2">
                  <i data-lucide="clock" class="h-3 w-3"></i>
                  <span data-translate="recentlyViewed">Recently Viewed</span>
                  <button class="tutorial-btn ml-auto" onclick="showTutorial('recently_viewed')">?</button>
                </h4>
                <div id="recentlyViewedPanel" class="space-y-1 max-h-32 overflow-y-auto">
                  <p class="text-xs text-slate-400 italic" data-translate="noRecentPlayers">No recent players</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Table Section -->
          <div class="flex-1 min-w-0">
            <!-- Bulk Actions Toolbar -->
            <div id="bulkToolbar" class="bulk-toolbar items-center justify-between text-white">
              <div class="flex items-center gap-4">
                <span class="flex items-center gap-2">
                  <i data-lucide="check-square" class="h-5 w-5"></i>
                  <span id="selectedCount">0</span> <span data-translate="selected">selected</span>
                  <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('bulk_actions')">?</button>
                </span>
                <button onclick="selectAllVisible()" class="text-sm hover:text-yellow-400" data-translate="selectAll">Select All</button>
                <button onclick="clearSelection()" class="text-sm hover:text-yellow-400" data-translate="clearSelection">Clear</button>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="bulkAddToWatchlist()" class="flex items-center gap-1 px-3 py-1.5 bg-yellow-500 text-black rounded-lg text-sm font-medium hover:bg-yellow-400">
                  <i data-lucide="star" class="h-4 w-4"></i> <span data-translate="addToWatchlist">Watchlist</span>
                </button>
                <button onclick="bulkExport()" class="flex items-center gap-1 px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-400">
                  <i data-lucide="download" class="h-4 w-4"></i> <span data-translate="export">Export</span>
                </button>
                <button onclick="clearSelection()" class="p-1.5 hover:bg-white/20 rounded-lg">
                  <i data-lucide="x" class="h-5 w-5"></i>
                </button>
              </div>
            </div>
            
            <!-- Table Header -->
            <div class="bg-white rounded-t-xl shadow-sm p-4 flex items-center justify-between border-b">
              <div class="flex items-center gap-3">
                <h3 class="font-bold text-slate-800"><span id="currentFilterName" data-translate="allPlayers">All Players</span> <span class="text-sm font-normal text-slate-500" id="tableCount">(0)</span></h3>
                <button class="tutorial-btn" onclick="showTutorial('players')">?</button>
                <div id="autoRefreshIndicator" class="auto-refresh-indicator hidden">
                  <span class="dot"></span>
                  <span data-translate="autoRefresh">Auto-refresh</span>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <!-- Auto-refresh toggle -->
                <label class="flex items-center gap-2 text-sm text-slate-600 cursor-pointer" title="Auto-refresh every 5 min">
                  <input type="checkbox" id="autoRefreshToggle" class="bulk-checkbox" onchange="toggleAutoRefresh()">
                  <span class="hidden sm:inline" data-translate="autoRefreshLabel">Auto</span>
                  <button class="tutorial-btn" onclick="event.preventDefault();showTutorial('auto_refresh')">?</button>
                </label>
                
                <!-- Column Toggle -->
                <div class="column-toggle">
                  <button onclick="toggleColumnMenu()" class="p-2 hover:bg-slate-100 rounded-lg" title="Toggle Columns">
                    <i data-lucide="columns" class="h-4 w-4"></i>
                  </button>
                  <div id="columnMenu" class="column-menu">
                    <p class="text-xs font-semibold text-slate-500 mb-2 flex items-center gap-2" data-translate="showColumns">Show Columns <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('column_toggle')">?</button></p>
                    <div class="space-y-1">
                      <label class="column-option"><input type="checkbox" checked data-column="id" onchange="toggleColumn('id')"> ID</label>
                      <label class="column-option"><input type="checkbox" checked data-column="type" onchange="toggleColumn('type')"> <span data-translate="type">Type</span></label>
                      <label class="column-option"><input type="checkbox" checked data-column="pref" onchange="toggleColumn('pref')"> <span data-translate="preference">Pref</span></label>
                      <label class="column-option"><input type="checkbox" checked data-column="revenue" onchange="toggleColumn('revenue')"> <span data-translate="netRevenue">Net Rev</span></label>
                      <label class="column-option"><input type="checkbox" checked data-column="winrate" onchange="toggleColumn('winrate')"> WR%</label>
                      <label class="column-option"><input type="checkbox" checked data-column="value" onchange="toggleColumn('value')"> <span data-translate="value">Value</span></label>
                      <label class="column-option"><input type="checkbox" checked data-column="churn" onchange="toggleColumn('churn')"> <span data-translate="churn">Churn</span></label>
                      <label class="column-option"><input type="checkbox" checked data-column="ltv" onchange="toggleColumn('ltv')"> LTV</label>
                    </div>
                  </div>
                </div>
                
                <button onclick="loadPlayers(true)" class="p-2 hover:bg-slate-100 rounded-lg" title="Refresh"><i data-lucide="refresh-cw" class="h-4 w-4"></i></button>
                <button onclick="exportFiltered('current','export')" class="flex items-center gap-2 px-3 py-2 bg-emerald-500 text-white rounded-lg text-sm" title="Export filtered players"><i data-lucide="download" class="h-4 w-4"></i><span class="hidden sm:inline" data-translate="export">Export</span></button>
                <button class="tutorial-btn" onclick="showTutorial('export')">?</button>
              </div>
            </div>
            
            <!-- Table -->
            <div class="bg-white rounded-b-xl shadow-sm overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-slate-50"><tr>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 w-10">
                      <input type="checkbox" id="selectAllCheckbox" class="bulk-checkbox" onchange="toggleSelectAll()">
                    </th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 cursor-pointer col-id" onclick="sortTable('id')">ID <i data-lucide="chevrons-up-down" class="h-3 w-3 inline"></i></th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 col-type" data-translate="type">Type</th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 col-pref" data-translate="preference">Pref</th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 cursor-pointer col-revenue" onclick="sortTable('netRevenue')" data-translate="netRevenue">Net Rev <i data-lucide="chevrons-up-down" class="h-3 w-3 inline"></i></th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 cursor-pointer col-winrate" onclick="sortTable('winRate')" data-translate="winRate">WR% <i data-lucide="chevrons-up-down" class="h-3 w-3 inline"></i></th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 col-value" data-translate="value">Value</th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 cursor-pointer col-churn" onclick="sortTable('churnScore')" data-translate="churn">Churn <i data-lucide="chevrons-up-down" class="h-3 w-3 inline"></i></th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 col-ltv">LTV</th>
                    <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600 flex items-center gap-1" data-translate="actions">Actions <button class="tutorial-btn" onclick="event.stopPropagation();showTutorial('quick_actions')">?</button></th>
                  </tr></thead>
                </table>
              </div>
              <div class="flex items-center gap-2 px-4 py-2 bg-slate-100 border-t text-xs text-slate-500">
                <i data-lucide="info" class="h-3 w-3"></i>
                <span>Click column headers to sort</span>
                <button class="tutorial-btn" onclick="showTutorial('table_sorting')">?</button>
              </div>
              <div id="tableContainer" class="virtual-scroll">
                <table class="w-full"><tbody id="tableBody"></tbody></table>
              </div>
              <div class="px-4 py-3 bg-slate-50 text-sm text-slate-600 flex justify-between items-center">
                <span id="tableFooter">0 players</span>
                <div class="flex gap-2 items-center">
                  <button onclick="changePage(-1)" id="prevPage" class="px-3 py-1 border rounded hover:bg-slate-100" disabled>Prev</button>
                  <span id="pageInfo" class="px-3 py-1">Page 1</span>
                  <button onclick="changePage(1)" id="nextPage" class="px-3 py-1 border rounded hover:bg-slate-100">Next</button>
                  <button class="tutorial-btn" onclick="showTutorial('pagination')">?</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="content-settings" class="tab-content hidden">
        <div class="flex items-center gap-2 mb-6">
          <h2 class="text-xl font-bold text-slate-800" data-translate="settings">Settings</h2>
          <button class="tutorial-btn" onclick="showTutorial('settings')">?</button>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-sm p-5">
            <h3 class="font-bold text-slate-800 mb-4" data-translate="currentUser">Account</h3>
            <div class="flex items-center gap-4">
              <div class="h-16 w-16 rounded-full bg-yellow-400 flex items-center justify-center"><i data-lucide="user" class="h-8 w-8"></i></div>
              <div><p class="font-medium" id="settingsUserEmail">user</p><p class="text-sm text-slate-500">Administrator</p></div>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-sm p-5">
            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2" data-translate="importCsv">Import Data <button class="tutorial-btn" onclick="showTutorial('csv_import')">?</button></h3>
            <label class="block cursor-pointer">
              <div class="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center hover:border-yellow-400">
                <i data-lucide="upload-cloud" class="h-10 w-10 text-slate-400 mx-auto mb-2"></i>
                <p class="text-sm text-slate-600" data-translate="clickToUploadCsv">Upload CSV</p>
              </div>
              <input type="file" id="csvFileInput" accept=".csv" class="hidden">
            </label>
          </div>
          
          <!-- Analysis Parameters Card -->
          <div class="bg-white rounded-xl shadow-sm p-5">
            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2" data-translate="analysisParameters">Analysis Parameters <button class="tutorial-btn" onclick="showTutorial('parameters')">?</button></h3>
            <p class="text-sm text-slate-500 mb-4" data-translate="parametersDesc">Configure thresholds for player analysis and segmentation</p>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-2"><i data-lucide="trending-up" class="h-4 w-4 text-emerald-500"></i><span class="text-sm" data-translate="profitability">Profitability</span><button class="tutorial-btn" onclick="showTutorial('param_profitability')">?</button></div>
                <span class="text-xs text-slate-500">WR: <span id="settingsWR1">25</span>/<span id="settingsWR2">40</span>/<span id="settingsWR3">50</span>%</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-2"><i data-lucide="gem" class="h-4 w-4 text-purple-500"></i><span class="text-sm" data-translate="valueSegments">Value Segments</span><button class="tutorial-btn" onclick="showTutorial('param_value')">?</button></div>
                <span class="text-xs text-slate-500">K<span id="settingsVip">5000</span>/K<span id="settingsHigh">1000</span>/K<span id="settingsMed">100</span></span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-2"><i data-lucide="user-minus" class="h-4 w-4 text-red-500"></i><span class="text-sm" data-translate="churnRisk">Churn Risk</span><button class="tutorial-btn" onclick="showTutorial('param_churn')">?</button></div>
                <span class="text-xs text-slate-500"><span id="settingsChurnL">7</span>/<span id="settingsChurnM">14</span>/<span id="settingsChurnH">30</span> <span data-translate="days">days</span></span>
              </div>
            </div>
            <button onclick="openParamsModal()" class="w-full mt-4 py-2 bg-yellow-400 text-black font-medium rounded-lg hover:bg-yellow-300 flex items-center justify-center gap-2">
              <i data-lucide="sliders" class="h-4 w-4"></i>
              <span data-translate="editParameters">Edit Parameters</span>
            </button>
          </div>
          
          <div class="bg-white rounded-xl shadow-sm p-5">
            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">Keyboard Shortcuts <button class="tutorial-btn" onclick="showTutorial('command_palette')">?</button></h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span data-translate="search">Search</span><span class="kbd">Ctrl+K</span></div>
              <div class="flex justify-between"><span>AI Assistant</span><span class="kbd">Ctrl+/</span></div>
              <div class="flex justify-between"><span data-translate="export">Export</span><span class="kbd">Ctrl+E</span></div>
              <div class="flex justify-between"><span>Dark Mode</span><span class="kbd">Ctrl+D</span></div>
              <div class="flex justify-between"><span>Tabs 1-6</span><span class="kbd">1-6</span></div>
            </div>
          </div>
          
          <!-- Telegram Integration -->
          <div class="bg-white rounded-xl shadow-sm p-5 lg:col-span-2">
            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
              <svg class="h-5 w-5 text-blue-500" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
              Telegram Alerts
            </h3>
            <p class="text-sm text-slate-500 mb-4">Receive CRM reports on Telegram. Get your Chat ID from @userinfobot then start @BwanaBetCRMBot</p>
            
            <div class="mb-4">
              <label class="block text-sm font-medium text-slate-700 mb-1">Your Chat ID</label>
              <input type="text" id="telegramChatId" placeholder="e.g. 1428650929" class="w-full max-w-xs px-3 py-2 border rounded-lg text-sm" />
              <p class="text-xs text-slate-400 mt-1">Message @userinfobot on Telegram to get your ID</p>
            </div>
            
            <div class="flex flex-wrap gap-2">
              <button onclick="saveTelegramSettings()" class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm hover:bg-slate-200 flex items-center gap-2">
                <i data-lucide="save" class="h-4 w-4"></i> Save
              </button>
              <button onclick="testTelegramConnection()" class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 flex items-center gap-2">
                <i data-lucide="send" class="h-4 w-4"></i> Test
              </button>
              <button onclick="sendTelegramReport()" class="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm hover:bg-emerald-600 flex items-center gap-2">
                <i data-lucide="file-text" class="h-4 w-4"></i> Send Report
              </button>
            </div>
            <p id="telegramStatus" class="text-sm mt-3 hidden"></p>
          </div>
        </div>
      </div>

      <!-- CALL CENTER -->
      <div id="content-callcenter" class="tab-content hidden">
        <!-- Sub-tab Navigation (Admin only sees both, Call Center only sees Calls) -->
        <div id="ccSubTabs" class="bg-white rounded-xl shadow-sm p-2 mb-4 flex gap-2">
          <button id="ccSubTab-calls" onclick="CallCenter.switchSubTab('calls')" class="cc-subtab active flex-1 px-4 py-2 rounded-lg text-sm font-medium bg-slate-800 text-white">
            <i data-lucide="phone" class="h-4 w-4 inline mr-2"></i>Calls
          </button>
          <button id="ccSubTab-admin" onclick="CallCenter.switchSubTab('admin')" class="cc-subtab flex-1 px-4 py-2 rounded-lg text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200">
            <i data-lucide="settings" class="h-4 w-4 inline mr-2"></i>Admin Panel
          </button>
        </div>

        <!-- CALLS SUB-TAB -->
        <div id="ccContent-calls">
          <!-- Employee Selection Bar -->
          <div class="bg-white rounded-xl shadow-sm p-4 mb-4">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                  <i data-lucide="user-circle" class="h-5 w-5 text-slate-400"></i>
                  <select id="ccEmployeeSelect" onchange="CallCenter.switchEmployee()" class="px-3 py-2 border rounded-lg text-sm font-medium">
                    <option value="">-- Select Employee --</option>
                  </select>
                </div>
              </div>
              <div class="flex items-center gap-3 text-sm">
                <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full">Critical: <span id="cc-critical-count">0</span></span>
                <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full">High: <span id="cc-high-count">0</span></span>
                <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full">Callback: <span id="cc-callback-count">0</span></span>
              </div>
            </div>
          </div>

          <!-- Employee Not Selected Warning -->
          <div id="ccNoEmployeeWarning" class="bg-amber-50 border border-amber-200 rounded-xl p-6 mb-4 text-center">
            <i data-lucide="alert-triangle" class="h-10 w-10 text-amber-500 mx-auto mb-3"></i>
            <h3 class="font-bold text-amber-800 mb-2">Select Your Name to Start</h3>
            <p class="text-amber-700 text-sm">Choose your name from the dropdown above to begin making calls. All your activity will be tracked.</p>
          </div>

          <!-- Main Call Center Content (hidden until employee selected) -->
          <div id="ccMainContent" class="hidden">
            <!-- Employee Stats Bar -->
            <div class="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-4">
              <div class="bg-white rounded-xl shadow-sm p-3 text-center">
                <p class="text-2xl font-bold text-slate-800" id="cc-emp-total">0</p>
                <p class="text-xs text-slate-500">Total Calls</p>
              </div>
              <div class="bg-white rounded-xl shadow-sm p-3 text-center">
                <p class="text-2xl font-bold text-emerald-600" id="cc-emp-success">0</p>
                <p class="text-xs text-slate-500">Successful</p>
              </div>
              <div class="bg-white rounded-xl shadow-sm p-3 text-center">
                <p class="text-2xl font-bold text-red-600" id="cc-emp-failed">0</p>
                <p class="text-xs text-slate-500">Failed</p>
              </div>
              <div class="bg-white rounded-xl shadow-sm p-3 text-center">
                <p class="text-2xl font-bold text-blue-600" id="cc-emp-callbacks">0</p>
                <p class="text-xs text-slate-500">Callbacks</p>
              </div>
              <div class="bg-white rounded-xl shadow-sm p-3 text-center">
                <p class="text-2xl font-bold text-purple-600" id="cc-emp-rate">0%</p>
                <p class="text-xs text-slate-500">Success Rate</p>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Call Queue -->
              <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                  <div class="bg-slate-800 text-white p-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="list" class="h-4 w-4"></i> Call Queue</h3>
                    <p class="text-slate-400 text-xs mt-1">Sorted by priority</p>
                  </div>
                  
                  <!-- Queue Filters -->
                  <div class="p-3 border-b bg-slate-50">
                    <select id="ccQueueFilter" onchange="CallCenter.filterQueue()" class="w-full px-3 py-2 border rounded-lg text-sm">
                      <option value="all">All Pending</option>
                      <option value="critical">Critical Risk Only</option>
                      <option value="high">High Risk Only</option>
                      <option value="callback">Callbacks Due</option>
                      <option value="new">Never Called</option>
                    </select>
                  </div>
                  
                  <!-- Queue List -->
                  <div id="ccQueueList" class="max-h-[500px] overflow-y-auto">
                    <div class="p-8 text-center text-slate-400">
                      <i data-lucide="phone-off" class="h-8 w-8 mx-auto mb-2 opacity-50"></i>
                      <p>Load data to see call queue</p>
                    </div>
                  </div>
                  
                  <!-- Queue Stats -->
                  <div class="p-3 border-t bg-slate-50 text-xs text-slate-500">
                    <div class="flex justify-between">
                      <span>In Queue: <strong id="cc-queue-total">0</strong></span>
                      <span>No Contact: <strong id="cc-no-contact">0</strong></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Active Call Panel -->
              <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                  <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white p-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="phone-call" class="h-4 w-4"></i> Active Call</h3>
                  </div>
                  
                  <div id="ccActiveCall" class="p-6">
                    <div class="text-center text-slate-400 py-8">
                      <i data-lucide="phone" class="h-12 w-12 mx-auto mb-3 opacity-50"></i>
                      <p class="text-lg">Select a client from the queue</p>
                      <p class="text-sm">Click on a client to start a call</p>
                    </div>
                  </div>
                </div>
                
                <!-- My Call History -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden mt-6">
                  <div class="bg-slate-100 p-4 border-b flex items-center justify-between">
                    <h3 class="font-bold text-slate-800 flex items-center gap-2"><i data-lucide="history" class="h-4 w-4"></i> My Recent Calls</h3>
                    <button onclick="CallCenter.showMyFullHistory()" class="text-xs text-blue-600 hover:underline">View All</button>
                  </div>
                  <div id="ccCallHistory" class="max-h-[250px] overflow-y-auto">
                    <div class="p-6 text-center text-slate-400">
                      <p class="text-sm">Your call history will appear here</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ADMIN PANEL SUB-TAB -->
        <div id="ccContent-admin" class="hidden">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- User Management -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
              <div class="bg-purple-800 text-white p-4">
                <h3 class="font-bold flex items-center gap-2"><i data-lucide="users" class="h-4 w-4"></i> User Management</h3>
              </div>
              
              <!-- Add User Form -->
              <div class="p-4 border-b bg-slate-50">
                <h4 class="font-medium text-slate-700 mb-3">Add New User</h4>
                <div class="space-y-3">
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="ccNewUserName" placeholder="Full Name *" class="px-3 py-2 border rounded-lg text-sm">
                    <input type="email" id="ccNewUserEmail" placeholder="Email Address *" class="px-3 py-2 border rounded-lg text-sm">
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="password" id="ccNewUserPassword" placeholder="Password *" class="px-3 py-2 border rounded-lg text-sm">
                    <select id="ccNewUserRole" class="px-3 py-2 border rounded-lg text-sm bg-white">
                      <option value="callcenter">Call Center</option>
                      <option value="admin">Administrator</option>
                      <option value="developer">Developer</option>
                    </select>
                  </div>
                  <button onclick="CallCenter.addUser()" id="ccAddUserBtn" class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 flex items-center justify-center gap-2">
                    <i data-lucide="user-plus" class="h-4 w-4"></i> Create User Account
                  </button>
                </div>
                <p class="text-xs text-slate-500 mt-2">* Required fields. User will receive login credentials.</p>
              </div>
              
              <!-- User List -->
              <div class="max-h-[400px] overflow-y-auto">
                <table class="w-full">
                  <thead class="bg-slate-50 sticky top-0">
                    <tr>
                      <th class="px-4 py-2 text-left text-xs font-semibold text-slate-600">Name</th>
                      <th class="px-4 py-2 text-left text-xs font-semibold text-slate-600">Email</th>
                      <th class="px-4 py-2 text-left text-xs font-semibold text-slate-600">Role</th>
                      <th class="px-4 py-2 text-center text-xs font-semibold text-slate-600">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="ccUserTableBody">
                    <tr><td colspan="4" class="px-4 py-8 text-center text-slate-400">Loading users...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Performance Overview -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
              <div class="bg-slate-800 text-white p-4 flex items-center justify-between">
                <h3 class="font-bold flex items-center gap-2"><i data-lucide="bar-chart-3" class="h-4 w-4"></i> Performance Overview</h3>
                <select id="ccAdminDateFilter" onchange="CallCenter.renderAdminStats()" class="px-2 py-1 bg-slate-700 text-white rounded text-xs border-none">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                  <option value="all" selected>All Time</option>
                </select>
              </div>
              
              <!-- Summary Stats -->
              <div class="grid grid-cols-2 gap-3 p-4 border-b">
                <div class="bg-slate-100 rounded-lg p-3 text-center">
                  <p class="text-2xl font-bold text-slate-800" id="admin-total-calls">0</p>
                  <p class="text-xs text-slate-500">Total Calls</p>
                </div>
                <div class="bg-emerald-100 rounded-lg p-3 text-center">
                  <p class="text-2xl font-bold text-emerald-700" id="admin-total-success">0</p>
                  <p class="text-xs text-emerald-600">Successful</p>
                </div>
                <div class="bg-red-100 rounded-lg p-3 text-center">
                  <p class="text-2xl font-bold text-red-700" id="admin-total-failed">0</p>
                  <p class="text-xs text-red-600">Failed</p>
                </div>
                <div class="bg-purple-100 rounded-lg p-3 text-center">
                  <p class="text-2xl font-bold text-purple-700" id="admin-avg-rate">0%</p>
                  <p class="text-xs text-purple-600">Avg Success Rate</p>
                </div>
              </div>
              
              <!-- Employee Performance Table -->
              <div class="max-h-[300px] overflow-y-auto">
                <table class="w-full">
                  <thead class="bg-slate-50 sticky top-0">
                    <tr>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600">Employee</th>
                      <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600">Calls</th>
                      <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600">Success</th>
                      <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600">Rate</th>
                      <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600">Rating</th>
                    </tr>
                  </thead>
                  <tbody id="ccAdminTableBody">
                    <tr><td colspan="5" class="px-4 py-8 text-center text-slate-400">No data</td></tr>
                  </tbody>
                </table>
              </div>
              
              <div class="p-3 border-t bg-slate-50">
                <button onclick="CallCenter.exportAdminReport()" class="w-full px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm hover:bg-emerald-600 flex items-center justify-center gap-2">
                  <i data-lucide="download" class="h-4 w-4"></i> Export Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit User Modal -->
      <div id="ccEditUserModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
          <div class="bg-slate-800 text-white p-4 rounded-t-2xl flex items-center justify-between">
            <h3 class="font-bold">Edit User</h3>
            <button onclick="document.getElementById('ccEditUserModal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i data-lucide="x" class="h-5 w-5"></i></button>
          </div>
          <div class="p-5">
            <input type="hidden" id="ccEditUserId">
            <input type="hidden" id="ccEditUserAuthId">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Name</label>
                <input type="text" id="ccEditUserName" class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Email</label>
                <input type="email" id="ccEditUserEmail" class="w-full px-3 py-2 border rounded-lg bg-slate-100" readonly>
                <p class="text-xs text-slate-500 mt-1">Email cannot be changed</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Role</label>
                <select id="ccEditUserRole" class="w-full px-3 py-2 border rounded-lg bg-white">
                  <option value="callcenter">Call Center</option>
                  <option value="admin">Administrator</option>
                  <option value="developer">Developer</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Reset Password</label>
                <input type="password" id="ccEditUserNewPassword" placeholder="Enter new password (leave blank to keep current)" class="w-full px-3 py-2 border rounded-lg">
              </div>
            </div>
            <div class="flex gap-3 mt-6">
              <button onclick="document.getElementById('ccEditUserModal').classList.add('hidden')" class="flex-1 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg">Cancel</button>
              <button onclick="CallCenter.saveUserEdit()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Save Changes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Employee History Modal -->
      <div id="ccHistoryModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
          <div class="bg-slate-800 text-white p-4 flex items-center justify-between">
            <h3 class="font-bold" id="ccHistoryModalTitle">Call History</h3>
            <button onclick="document.getElementById('ccHistoryModal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i data-lucide="x" class="h-5 w-5"></i></button>
          </div>
          <div id="ccHistoryModalContent" class="p-5 overflow-y-auto max-h-[calc(90vh-80px)]">
          </div>
        </div>
      </div>
    </main>

    <!-- Player Modal -->
    <div id="playerModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="if(event.target===this)this.classList.add('hidden')">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
        <div class="bg-gradient-to-r from-slate-800 to-slate-900 p-5 flex items-center justify-between">
          <div><h2 class="text-xl font-bold text-white" data-translate="playerDetails">Player Details</h2><p class="text-slate-400 text-sm" id="modalPlayerId"></p></div>
          <button onclick="document.getElementById('playerModal').classList.add('hidden')" class="text-slate-400 hover:text-white p-2"><i data-lucide="x" class="h-6 w-6"></i></button>
        </div>
        <div class="p-5 overflow-y-auto max-h-[calc(90vh-80px)]" id="modalContent"></div>
      </div>
    </div>

    <!-- AI Widget -->
    <button id="aiWidgetBtn" class="ai-widget-btn" onclick="AIAgent.toggle()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2M20 14h2M15 13v2M9 13v2"/></svg>
      <span id="aiNotificationDot" class="notification-dot" style="display:none"></span>
    </button>

    <!-- AI Chat Panel -->
    <div id="aiChatPanel" class="ai-chat-panel">
      <div class="ai-chat-header">
        <h3 class="text-amber-400 font-bold flex items-center gap-2"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/></svg>AI Assistant <button class="tutorial-btn" style="background:#fef3c7;color:#92400e;" onclick="event.stopPropagation();showTutorial('ai_assistant')">?</button></h3>
        <div class="flex gap-2">
          <button onclick="AIAgent.clearConversation()" class="text-slate-400 hover:text-white p-1"><i data-lucide="trash-2" class="h-4 w-4"></i></button>
          <button onclick="AIAgent.toggle()" class="text-slate-400 hover:text-white p-1"><i data-lucide="x" class="h-5 w-5"></i></button>
        </div>
      </div>
      <div id="aiChatMessages" class="ai-chat-messages"></div>
      <div class="p-4 border-t bg-white">
        <div id="quickActions" class="flex gap-2 mb-3 flex-wrap">
          <button class="quick-action-btn" onclick="AIAgent.quickAction('Show VIP players at risk')">ðŸ‘‘ VIP Risk</button>
          <button class="quick-action-btn" onclick="AIAgent.quickAction('Show top 5 churn risks')">âš ï¸ Top Churn</button>
          <button class="quick-action-btn" onclick="AIAgent.quickAction('Compare VIP vs High')">ðŸ“Š Compare</button>
          <button class="quick-action-btn" onclick="AIAgent.quickAction('Export critical churn')">ðŸ“¥ Export</button>
        </div>
        <div class="flex gap-2">
          <textarea id="aiChatInput" class="flex-1 border-2 border-slate-200 rounded-xl px-4 py-3 text-sm resize-none outline-none focus:border-amber-400" placeholder="Ask anything..." rows="1" onkeydown="AIAgent.handleKeydown(event)"></textarea>
          <button id="aiSendBtn" onclick="AIAgent.send()" class="w-11 h-11 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center"><i data-lucide="send" class="h-5 w-5 text-black"></i></button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // CONFIGURATION & STATE
    // ============================================================
    const SUPABASE_URL = 'https://blrrcnrhixckfudiojwe.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJscnJjbnJoaXhja2Z1ZGlvandlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3Nzg0MzMsImV4cCI6MjA4MzM1NDQzM30.2DGACAZz-f_r0ieYz3hvtsOG1y-3fqTD_ENH2ZR2g1k';
    
    // Default parameters - used for reset functionality
    const DEFAULT_PARAMS = {
      // Profitability - Win Rate Thresholds
      winRate1: 25,   // Below this = Most Profitable
      winRate2: 40,   // Below this = Profitable
      winRate3: 50,   // Above this = Negative GGR
      
      // Value Segments - Revenue Thresholds (K)
      vipMin: 5000,      // VIP threshold
      highMin: 1000,     // High value threshold
      mediumMin: 100,    // Medium value threshold
      
      // Betting Styles - Avg Bet Thresholds (K)
      highRollerMin: 100,  // High roller minimum avg bet
      casualMax: 10,       // Casual player max avg bet
      
      // Lifecycle - Days
      newPlayerDays: 30,   // Days to be considered "new"
      
      // Churn Risk - Days Since Activity
      churnLowDays: 7,     // Low risk threshold
      churnMedDays: 14,    // Medium risk threshold
      churnHighDays: 30,   // High risk threshold (above = critical)
      
      // Churn Scoring Weights (must sum to ~100)
      churnWeightInactivity: 35,
      churnWeightWithdrawal: 20,
      churnWeightFrequency: 15,
      churnWeightWinRate: 10,
      churnWeightValue: 5
    };

    const App = {
      db: null, user: null, players: [], processedPlayers: [], filteredPlayers: [],
      currentFilter: null, currentPage: 1, pageSize: 100,
      sortField: 'churnScore', sortDirection: 'desc', darkMode: false, charts: {},
      statsCache: null, statsCacheTime: 0, currentLang: 'en',
      dataLoaded: false, // Flag to prevent reloading data
      isLoading: false, // Prevent concurrent loads
      role: 'admin', // User role: admin, developer, callcenter
      // Efficiency features state
      selectedPlayers: new Set(), // Bulk selection
      watchlist: new Set(), // Favorited players
      recentlyViewed: [], // Last 10 viewed players
      savedFilters: [], // Saved filter presets
      visibleColumns: { id: true, type: true, pref: true, revenue: true, winrate: true, value: true, churn: true, ltv: true },
      autoRefreshEnabled: false,
      autoRefreshInterval: null,
      autoRefreshSeconds: 300, // 5 minutes
      params: { ...DEFAULT_PARAMS } // Copy defaults
    };

    const FIELD_MAP = { 'id': 'id', 'virtual/real phone': 'phone_number', 'referral': 'referral', 'status': 'status', 'registration_date': 'registration_date', 'sport_bet_amount': 'sport_bet_amount', 'sport_bet_count': 'sport_bet_count', 'sport_win_amount': 'sport_win_amount', 'sport_win_count': 'sport_win_count', 'casino_bet_amount': 'casino_bet_amount', 'casino_bet_count': 'casino_bet_count', 'casino_win_amount': 'casino_win_amount', 'casino_win_count': 'casino_win_count', 'total_deposit_amount': 'total_deposit_amount', 'total_withdraw_amount': 'total_withdraw_amount', 'sport_bet_avg': 'sport_bet_avg', 'casino_bet_avg': 'casino_bet_avg' };

    // ============================================================
    // TRANSLATIONS
    // ============================================================
    const TRANSLATIONS = {
      en: {
        dashboard: 'Dashboard', profitability: 'Profitability', behavior: 'Behavior', churn: 'Churn', analytics: 'Analytics', players: 'Players', settings: 'Settings', logout: 'Logout',
        signIn: 'Sign In', email: 'Email', password: 'Password', connected: 'Connected', search: 'Search',
        totalPlayers: 'Total Players', profitablePlayers: 'Profitable Players', negativeGgrPlayers: 'Negative GGR Players', atRisk: 'At Risk', clickToView: 'Click to view â†’',
        financialOverview: 'Financial Overview', totalDeposits: 'Total Deposits', totalWithdrawals: 'Total Withdrawals', netRevenue: 'Net Revenue (GGR)',
        playerPreferences: 'Player Preferences', sportsBettors: 'Sports Bettors', casinoPlayers: 'Casino Players', mixedPlayers: 'Mixed Players',
        valueSegments: 'Value Segments', vip: 'VIP (K5k+)', highValue: 'High (K1k-K5k)', mediumValue: 'Medium (K100-K1k)', lowValue: 'Low (<K100)',
        churnRisk: 'Churn Risk', lowRisk: 'Low Risk', mediumRisk: 'Medium', highRisk: 'High Risk', critical: 'Critical',
        playerProfitabilityAnalysis: 'Player Profitability Analysis', lostMoreThanWon: 'Lost more than won', wonMoreThanLost: 'Won more than lost',
        companyProfit: 'Company profit', companyLoss: 'Company loss', winRateDistribution: 'Win Rate Distribution',
        profitable: 'Profitable', negativeGgr: 'Negative GGR', breakEven: 'Break Even', mostProfitable: 'Most Profitable',
        playerBehavior: 'Player Behavior', highRollers: 'High Rollers', regularBettors: 'Regular Bettors', casualPlayers: 'Casual Players',
        avgBetOver100: 'Avg bet >K100', avgBet10to100: 'Avg bet K10-K100', avgBetUnder10: 'Avg bet <K10',
        lifecycleStages: 'Lifecycle Stages', new: 'New (<30d)', growing: 'Growing', mature: 'Mature', declining: 'Declining', dormant: 'Dormant', churned: 'Churned',
        churnRiskAnalysis: 'Churn Risk Analysis', lessThan7Days: '<7 days', days7to14: '7-14 days', days14to30: '14-30 days', over30Days: '30+ days',
        withdrawingProfits: 'Withdrawing Profits', virtualPhone: 'Virtual Phone', alerts: 'Alerts',
        allPlayers: 'All Players', clear: 'Clear', refresh: 'Refresh', export: 'Export', exportAll: 'Export All',
        type: 'Type', preference: 'Preference', winRate: 'Win Rate', value: 'Value', actions: 'Actions', apply: 'Apply',
        currentUser: 'Current User', importCsv: 'Import CSV', clickToUploadCsv: 'Click to upload CSV',
        playerDetails: 'Player Details', aiInsights: 'AI Insights', quickActions: 'Quick Actions',
        profitabilityOverview: 'Profitability Overview', churnRiskOverview: 'Churn Risk Overview',
        profitabilityDistribution: 'Profitability Distribution', churnDistribution: 'Churn Distribution',
        bettingStyles: 'Betting Styles', sports: 'Sports', casino: 'Casino', mixed: 'Mixed',
        high: 'High', medium: 'Medium', low: 'Low',
        // Parameters
        parameters: 'Parameters', analysisParameters: 'Analysis Parameters', adjustThresholds: 'Adjust thresholds for data analysis',
        profitabilityParams: 'Profitability Parameters', profitabilityDesc: 'Win rate thresholds determine player profitability categories',
        mostProfitableMax: 'Most Profitable Max WR%', profitableMax: 'Profitable Max WR%', negativeGgrMin: 'Negative GGR Min WR%',
        valueSegmentParams: 'Value Segment Parameters', valueSegmentDesc: 'Revenue thresholds for player value categorization (in K)',
        highValueMin: 'High Value Min', mediumValueMin: 'Medium Value Min',
        bettingStyleParams: 'Betting Style Parameters', bettingStyleDesc: 'Average bet thresholds for player betting style (in K)',
        highRollerMin: 'High Roller Min Avg Bet', casualMax: 'Casual Max Avg Bet',
        lifecycleParams: 'Lifecycle Parameters', lifecycleDesc: 'Days threshold for new player classification',
        newPlayerDays: 'New Player Days', churnParams: 'Churn Risk Parameters', churnDesc: 'Days since last activity thresholds for churn risk levels',
        lowRiskDays: 'Low Risk Days', mediumRiskDays: 'Medium Risk Days', highRiskDays: 'High Risk Days', daysCritical: 'days = Critical risk',
        churnWeights: 'Churn Score Weights', churnWeightsDesc: 'Weights for calculating churn score (should sum to ~85)',
        inactivity: 'Inactivity', withdrawals: 'Withdrawals', frequency: 'Frequency', totalWeight: 'Total weight',
        resetToDefault: 'Reset to Default', saveAndApply: 'Save & Apply', cancel: 'Cancel',
        editParameters: 'Edit Parameters', parametersDesc: 'Configure thresholds for player analysis and segmentation', days: 'days',
        // Data Comparison
        dataComparison: 'Data Comparison', compare: 'Compare', last7vs7: 'Last 7 days vs Previous 7',
        last14vs14: 'Last 14 days vs Previous 14', last30vs30: 'Last 30 days vs Previous 30',
        last90vs90: 'Last 90 days vs Previous 90', customRange: 'Custom Range',
        period1Start: 'Period 1 Start', period1End: 'Period 1 End', period2Start: 'Period 2 Start', period2End: 'Period 2 End',
        newPlayers: 'New Players', avgDeposit: 'Avg Deposit', avgWinRate: 'Avg Win Rate', atRiskPlayers: 'At Risk Players',
        netGgr: 'Net GGR', revenueComparison: 'Revenue Comparison', segmentComparison: 'Segment Comparison',
        detailedBreakdown: 'Detailed Breakdown', metric: 'Metric', change: 'Change', trend: 'Trend',
        // Efficiency Features
        savedFilters: 'Saved Filters', noSavedFilters: 'No saved filters', watchlist: 'Watchlist', noWatchedPlayers: 'No watched players',
        recentlyViewed: 'Recently Viewed', noRecentPlayers: 'No recent players', selected: 'selected', selectAll: 'Select All',
        clearSelection: 'Clear', addToWatchlist: 'Watchlist', showColumns: 'Show Columns', autoRefresh: 'Auto-refresh',
        autoRefreshLabel: 'Auto'
      },
      ru: {
        dashboard: 'ÐŸÐ°Ð½ÐµÐ»ÑŒ', profitability: 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ', behavior: 'ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ', churn: 'ÐžÑ‚Ñ‚Ð¾Ðº', analytics: 'ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°', players: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸', settings: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸', logout: 'Ð’Ñ‹Ð¹Ñ‚Ð¸',
        signIn: 'Ð’Ð¾Ð¹Ñ‚Ð¸', email: 'Ð­Ð». Ð¿Ð¾Ñ‡Ñ‚Ð°', password: 'ÐŸÐ°Ñ€Ð¾Ð»ÑŒ', connected: 'ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾', search: 'ÐŸÐ¾Ð¸ÑÐº',
        totalPlayers: 'Ð’ÑÐµÐ³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', profitablePlayers: 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', negativeGgrPlayers: 'Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', atRisk: 'Ð’ Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°', clickToView: 'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ â†’',
        financialOverview: 'Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ð¹ Ð¾Ð±Ð·Ð¾Ñ€', totalDeposits: 'Ð’ÑÐµÐ³Ð¾ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ð²', totalWithdrawals: 'Ð’ÑÐµÐ³Ð¾ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð²', netRevenue: 'Ð§Ð¸ÑÑ‚Ñ‹Ð¹ Ð´Ð¾Ñ…Ð¾Ð´ (GGR)',
        playerPreferences: 'ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', sportsBettors: 'Ð¡Ñ‚Ð°Ð²ÐºÐ¸ Ð½Ð° ÑÐ¿Ð¾Ñ€Ñ‚', casinoPlayers: 'ÐšÐ°Ð·Ð¸Ð½Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', mixedPlayers: 'Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ðµ',
        valueSegments: 'Ð¡ÐµÐ³Ð¼ÐµÐ½Ñ‚Ñ‹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸', vip: 'VIP (K5k+)', highValue: 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ (K1k-K5k)', mediumValue: 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ (K100-K1k)', lowValue: 'ÐÐ¸Ð·ÐºÐ¸Ð¹ (<K100)',
        churnRisk: 'Ð Ð¸ÑÐº Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', lowRisk: 'ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº', mediumRisk: 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹', highRisk: 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº', critical: 'ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',
        playerProfitabilityAnalysis: 'ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', lostMoreThanWon: 'ÐŸÑ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ', wonMoreThanLost: 'Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ',
        companyProfit: 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸', companyLoss: 'Ð£Ð±Ñ‹Ñ‚Ð¾Ðº ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸', winRateDistribution: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð°',
        profitable: 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ð¹', negativeGgr: 'Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¹', breakEven: 'Ð‘ÐµÐ·ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¹', mostProfitable: 'Ð¡Ð°Ð¼Ñ‹Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ',
        playerBehavior: 'ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', highRollers: 'Ð¥Ð°Ð¹Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹', regularBettors: 'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', casualPlayers: 'ÐšÐ°Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ',
        avgBetOver100: 'Ð¡Ñ€. ÑÑ‚Ð°Ð²ÐºÐ° >K100', avgBet10to100: 'Ð¡Ñ€. ÑÑ‚Ð°Ð²ÐºÐ° K10-K100', avgBetUnder10: 'Ð¡Ñ€. ÑÑ‚Ð°Ð²ÐºÐ° <K10',
        lifecycleStages: 'Ð¡Ñ‚Ð°Ð´Ð¸Ð¸ Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð°', new: 'ÐÐ¾Ð²Ñ‹Ðµ (<30Ð´)', growing: 'Ð Ð°ÑÑ‚ÑƒÑ‰Ð¸Ðµ', mature: 'Ð—Ñ€ÐµÐ»Ñ‹Ðµ', declining: 'Ð¡Ð½Ð¸Ð¶Ð°ÑŽÑ‰Ð¸ÐµÑÑ', dormant: 'Ð¡Ð¿ÑÑ‰Ð¸Ðµ', churned: 'Ð£ÑˆÐµÐ´ÑˆÐ¸Ðµ',
        churnRiskAnalysis: 'ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', lessThan7Days: '<7 Ð´Ð½ÐµÐ¹', days7to14: '7-14 Ð´Ð½ÐµÐ¹', days14to30: '14-30 Ð´Ð½ÐµÐ¹', over30Days: '30+ Ð´Ð½ÐµÐ¹',
        withdrawingProfits: 'Ð’Ñ‹Ð²Ð¾Ð´ÑÑ‚ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ', virtualPhone: 'Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½', alerts: 'ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ñ',
        allPlayers: 'Ð’ÑÐµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', clear: 'ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ', refresh: 'ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ', export: 'Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚', exportAll: 'Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð²ÑÐµÑ…',
        type: 'Ð¢Ð¸Ð¿', preference: 'ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ', winRate: 'Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚', value: 'Ð¦ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ', actions: 'Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ', apply: 'ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ',
        currentUser: 'Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ', importCsv: 'Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ CSV', clickToUploadCsv: 'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ CSV',
        playerDetails: 'Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°', aiInsights: 'AI ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°', quickActions: 'Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ',
        profitabilityOverview: 'ÐžÐ±Ð·Ð¾Ñ€ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', churnRiskOverview: 'ÐžÐ±Ð·Ð¾Ñ€ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°',
        profitabilityDistribution: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', churnDistribution: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°',
        bettingStyles: 'Ð¡Ñ‚Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð²Ð¾Ðº', sports: 'Ð¡Ð¿Ð¾Ñ€Ñ‚', casino: 'ÐšÐ°Ð·Ð¸Ð½Ð¾', mixed: 'Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ð¹',
        high: 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹', medium: 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹', low: 'ÐÐ¸Ð·ÐºÐ¸Ð¹',
        // Parameters
        parameters: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹', analysisParameters: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°', adjustThresholds: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð¾Ñ€Ð¾Ð³Ð¾Ð² Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…',
        profitabilityParams: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', profitabilityDesc: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸',
        mostProfitableMax: 'ÐœÐ°ÐºÑ. WR% ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ñ…', profitableMax: 'ÐœÐ°ÐºÑ. WR% Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ñ…', negativeGgrMin: 'ÐœÐ¸Ð½. WR% ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ñ…',
        valueSegmentParams: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸', valueSegmentDesc: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð´Ð¾Ñ…Ð¾Ð´Ð° Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² (Ð² K)',
        highValueMin: 'ÐœÐ¸Ð½. Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸', mediumValueMin: 'ÐœÐ¸Ð½. ÑÑ€ÐµÐ´Ð½ÐµÐ¹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸',
        bettingStyleParams: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÑ‚Ð¸Ð»Ñ ÑÑ‚Ð°Ð²Ð¾Ðº', bettingStyleDesc: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ ÑÑ€ÐµÐ´Ð½ÐµÐ¹ ÑÑ‚Ð°Ð²ÐºÐ¸ Ð´Ð»Ñ ÑÑ‚Ð¸Ð»Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ° (Ð² K)',
        highRollerMin: 'ÐœÐ¸Ð½. ÑÑ€. ÑÑ‚Ð°Ð²ÐºÐ° Ñ…Ð°Ð¹Ñ€Ð¾Ð»Ð»ÐµÑ€Ð°', casualMax: 'ÐœÐ°ÐºÑ. ÑÑ€. ÑÑ‚Ð°Ð²ÐºÐ° ÐºÐ°Ð·ÑƒÐ°Ð»Ð°',
        lifecycleParams: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð°', lifecycleDesc: 'ÐŸÐ¾Ñ€Ð¾Ð³ Ð´Ð½ÐµÐ¹ Ð´Ð»Ñ ÐºÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ°',
        newPlayerDays: 'Ð”Ð½ÐµÐ¹ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ°', churnParams: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', churnDesc: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð´Ð½ÐµÐ¹ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ñ€Ð¸ÑÐºÐ°',
        lowRiskDays: 'Ð”Ð½ÐµÐ¹ Ð½Ð¸Ð·ÐºÐ¾Ð³Ð¾ Ñ€Ð¸ÑÐºÐ°', mediumRiskDays: 'Ð”Ð½ÐµÐ¹ ÑÑ€ÐµÐ´Ð½ÐµÐ³Ð¾ Ñ€Ð¸ÑÐºÐ°', highRiskDays: 'Ð”Ð½ÐµÐ¹ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð³Ð¾ Ñ€Ð¸ÑÐºÐ°', daysCritical: 'Ð´Ð½ÐµÐ¹ = ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº',
        churnWeights: 'Ð’ÐµÑÐ° Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', churnWeightsDesc: 'Ð’ÐµÑÐ° Ð´Ð»Ñ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ° (ÑÑƒÐ¼Ð¼Ð° ~85)',
        inactivity: 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ', withdrawals: 'Ð’Ñ‹Ð²Ð¾Ð´Ñ‹', frequency: 'Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð°', totalWeight: 'ÐžÐ±Ñ‰Ð¸Ð¹ Ð²ÐµÑ',
        resetToDefault: 'Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ', saveAndApply: 'Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ', cancel: 'ÐžÑ‚Ð¼ÐµÐ½Ð°',
        editParameters: 'Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹', parametersDesc: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', days: 'Ð´Ð½ÐµÐ¹',
        // Data Comparison
        dataComparison: 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…', compare: 'Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ', last7vs7: 'ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹ vs ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ 7',
        last14vs14: 'ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 14 Ð´Ð½ÐµÐ¹ vs ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ 14', last30vs30: 'ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 30 Ð´Ð½ÐµÐ¹ vs ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ 30',
        last90vs90: 'ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 90 Ð´Ð½ÐµÐ¹ vs ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ 90', customRange: 'Ð¡Ð²Ð¾Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½',
        period1Start: 'ÐŸÐµÑ€Ð¸Ð¾Ð´ 1 Ð½Ð°Ñ‡Ð°Ð»Ð¾', period1End: 'ÐŸÐµÑ€Ð¸Ð¾Ð´ 1 ÐºÐ¾Ð½ÐµÑ†', period2Start: 'ÐŸÐµÑ€Ð¸Ð¾Ð´ 2 Ð½Ð°Ñ‡Ð°Ð»Ð¾', period2End: 'ÐŸÐµÑ€Ð¸Ð¾Ð´ 2 ÐºÐ¾Ð½ÐµÑ†',
        newPlayers: 'ÐÐ¾Ð²Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', avgDeposit: 'Ð¡Ñ€. Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚', avgWinRate: 'Ð¡Ñ€. Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚', atRiskPlayers: 'Ð’ Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°',
        netGgr: 'Ð§Ð¸ÑÑ‚Ñ‹Ð¹ GGR', revenueComparison: 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð¾Ñ…Ð¾Ð´Ð¾Ð²', segmentComparison: 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð²',
        detailedBreakdown: 'Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ñ€Ð°Ð·Ð±Ð¸Ð²ÐºÐ°', metric: 'ÐœÐµÑ‚Ñ€Ð¸ÐºÐ°', change: 'Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ', trend: 'Ð¢Ñ€ÐµÐ½Ð´',
        // Efficiency Features
        savedFilters: 'Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹', noSavedFilters: 'ÐÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²', watchlist: 'ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ', noWatchedPlayers: 'ÐÐµÑ‚ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²',
        recentlyViewed: 'ÐÐµÐ´Ð°Ð²Ð½Ð¾ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð½Ñ‹Ðµ', noRecentPlayers: 'ÐÐµÑ‚ Ð½ÐµÐ´Ð°Ð²Ð½Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', selected: 'Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð¾', selectAll: 'Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ',
        clearSelection: 'ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ', addToWatchlist: 'Ð’ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ', showColumns: 'ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð»Ð±Ñ†Ñ‹', autoRefresh: 'ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ',
        autoRefreshLabel: 'ÐÐ²Ñ‚Ð¾'
      }
    };

    function applyTranslations() {
      const lang = App.currentLang;
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) {
          el.textContent = TRANSLATIONS[lang][key];
        }
      });
    }

    function setLanguage(lang) {
      App.currentLang = lang;
      localStorage.setItem('crmLang', lang);
      applyTranslations();
    }

    // ============================================================
    // ============================================================
    // TUTORIALS
    // ============================================================
    const TUTORIALS = {
      en: {
        // Dashboard Tab
        dashboard: { title: 'Dashboard Overview', body: 'The Dashboard provides a comprehensive overview of your player base. Here you can see key metrics at a glance: total players, profitable players (who lose money to the company), negative GGR players (who win money from the company), and at-risk players who might leave soon. Click any card to see detailed player lists.' },
        financial: { title: 'Financial Overview', body: 'This section shows the financial health of your operations. <strong>Deposits</strong> = money players put in. <strong>Withdrawals</strong> = money players take out. <strong>Net GGR (Gross Gaming Revenue)</strong> = your actual revenue from player activity. A positive GGR means the company is profitable.' },
        profitability_chart: { title: 'Profitability Chart', body: 'This chart shows the distribution between profitable players (green) and negative GGR players (red). Profitable players lose more than they win, generating revenue for the company. Negative GGR players win more than they lose, costing the company money.' },
        churn_chart: { title: 'Churn Risk Chart', body: 'This chart displays how many players are at each churn risk level. Churn means players leaving your platform. Green = active players, Yellow = showing signs of leaving, Orange = high risk of leaving, Red = critical - likely to leave very soon.' },
        value_segments: { title: 'Value Segments', body: 'Players are categorized by their total activity value: <strong>VIP (K5k+)</strong> = highest value players requiring special attention. <strong>High (K1k-5k)</strong> = significant contributors. <strong>Medium (K100-1k)</strong> = regular players. <strong>Low (less than K100)</strong> = casual or new players.' },
        preferences: { title: 'Player Preferences', body: 'Shows what types of games players prefer: <strong>Sports</strong> = primarily bet on sports events. <strong>Casino</strong> = mainly play casino games. <strong>Mixed</strong> = engage with both sports and casino offerings.' },
        churn_risk: { title: 'Churn Risk Levels', body: 'Based on days since last activity: <strong>Low</strong> = active within 7 days. <strong>Medium</strong> = 7-14 days inactive. <strong>High</strong> = 14-30 days inactive. <strong>Critical</strong> = 30+ days inactive. Higher risk means more likely to permanently leave.' },
        alerts: { title: 'Alerts', body: '<strong>Withdrawing</strong> = players taking out more than they deposit (cashing out). <strong>Virtual Phone</strong> = players using virtual/fake phone numbers (potential fraud risk). <strong>High WR</strong> = unusually high win rates that may indicate advantage play or fraud.' },
        total_players: { title: 'Total Players', body: 'The total count of all registered players in your database. Click this card to view the complete player list. This includes active players, dormant players, and those who may have churned.' },
        profitable_card: { title: 'Profitable Players', body: 'Players who have lost more money than they have won, generating positive GGR (Gross Gaming Revenue) for your company. These are the backbone of your business. The amount shown is the total profit generated from these players.' },
        negative_ggr_card: { title: 'Negative GGR Players', body: 'Players who have won more than they lost, resulting in a net loss for the company. Monitor these players for unusual patterns. Some negative GGR is normal, but high concentrations may indicate issues.' },
        at_risk_card: { title: 'At-Risk Players', body: 'Players with HIGH or CRITICAL churn risk scores who are likely to stop playing soon. These require immediate retention attention, especially if they are high-value players. Consider targeted bonuses or outreach.' },
        // Profitability Tab
        profitability: { title: 'Profitability Analysis', body: 'This tab analyzes player profitability. <strong>Profitable Players</strong> have lost more than won - they generate revenue. <strong>Negative GGR Players</strong> have won more than lost - they cost the company money. Win Rate shows what percentage of bets a player wins.' },
        profit_distribution: { title: 'Profit Distribution', body: 'Visual breakdown of profitable vs unprofitable players. A healthy business should have more profitable players (green) than negative GGR players (red). Hover over the chart sections to see exact counts.' },
        winrate: { title: 'Win Rate Analysis', body: 'Win Rate = percentage of bets won by players. Lower win rates (0-40%) are better for the company as players are losing. Higher win rates (50%+) mean players are beating the house and should be monitored for potential advantage play.' },
        winrate_segments: { title: 'Win Rate Segments', body: '<strong>0-25%</strong> = Most profitable players - they lose 75%+ of bets. <strong>25-40%</strong> = Still profitable - normal casual players. <strong>40-50%</strong> = Break even zone - watch closely. <strong>50%+</strong> = Negative GGR - winning players that cost you money.' },
        profit_summary: { title: 'Profit Summary Cards', body: 'The green card shows total profit from losing players. The red card shows total losses from winning players. Click either card to see the individual players in that category.' },
        // Behavior Tab
        behavior: { title: 'Behavior Analysis', body: 'This tab shows player behavioral patterns including betting styles and where players are in their lifecycle with your platform. Understanding behavior helps create targeted marketing and retention strategies.' },
        betting_styles: { title: 'Betting Styles', body: '<strong>High Rollers</strong> = average bet over K100, valuable but risky - require VIP treatment. <strong>Regular</strong> = average bet K10-100, your core sustainable players. <strong>Casual</strong> = average bet under K10, occasional players who may grow with nurturing.' },
        lifecycle: { title: 'Player Lifecycle', body: 'Shows where players are in their journey: <strong>New</strong> = joined less than 30 days ago. <strong>Growing</strong> = increasing activity. <strong>Mature</strong> = established players. <strong>Declining</strong> = reducing activity. <strong>Dormant</strong> = very inactive. <strong>Churned</strong> = effectively gone.' },
        lifecycle_stages: { title: 'Lifecycle Details', body: '<strong>New players</strong> need onboarding and welcome bonuses. <strong>Growing players</strong> should be nurtured with rewards. <strong>Mature players</strong> need loyalty programs. <strong>Declining/Dormant</strong> need re-engagement campaigns. <strong>Churned</strong> may need win-back offers.' },
        style_cards: { title: 'Betting Style Cards', body: 'Click any card to see players in that betting category. High Rollers are most valuable but riskiest. Regular bettors form your stable revenue base. Casual players may be converted to regular with the right incentives.' },
        // Churn Tab
        churn: { title: 'Churn Risk Analysis', body: 'Churn analysis helps identify players likely to leave. Focus retention efforts on high-value players with elevated churn risk. The churn score (0-100) combines multiple factors including inactivity, withdrawal patterns, and engagement decline.' },
        churn_distribution: { title: 'Churn Distribution', body: 'Shows how many players fall into each risk category. Ideally, most players should be in the Low/Medium categories. High numbers in High/Critical indicate retention problems that need immediate attention.' },
        churn_score: { title: 'Churn Score Breakdown', body: 'A 0-100 score predicting likelihood of leaving. Weighted factors: <strong>Inactivity</strong> (35%) - days since last activity. <strong>Withdrawal ratio</strong> (20%) - cashing out behavior. <strong>Frequency decline</strong> (15%) - betting less often. <strong>Win rate</strong> (10%) - winners may leave. <strong>Value</strong> (5%) - segment impact.' },
        churn_factors: { title: 'Churn Risk Factors', body: 'Key factors that contribute to churn risk: <strong>High Withdrawal Ratio</strong> - taking money out suggests leaving. <strong>Decreasing Activity</strong> - betting less frequently. <strong>Long Inactivity</strong> - not playing for extended periods. <strong>Virtual Phone</strong> - may indicate fake accounts.' },
        inactivity_chart: { title: 'Activity Timeline', body: 'This shows when players were last active: <strong>Less than 7 days</strong> = Recently active (healthy). <strong>7-14 days</strong> = Starting to disengage. <strong>14-30 days</strong> = Concerning inactivity. <strong>30+ days</strong> = Likely churned.' },
        // Analytics Tab
        analytics: { title: 'Advanced Analytics', body: 'Deep-dive analytics including LTV (Lifetime Value) predictions, segment comparisons, and period-over-period data comparison. Use these tools to make data-driven decisions about player management and marketing spend.' },
        ltv: { title: 'LTV Distribution', body: 'LTV (Lifetime Value) predicts how much revenue a player will generate over their entire relationship with you. Calculated as: daily value multiplied by expected retention period. Higher LTV players deserve more retention investment and better bonuses.' },
        comparison: { title: 'Segment Comparison', body: 'Compare key metrics between different player segments to understand differences and optimize strategies. Select two segments to compare their average deposits, win rates, churn risk, and other metrics.' },
        data_comparison: { title: 'Data Comparison', body: 'Compare metrics between two time periods to identify trends and changes. <strong>Preset Periods</strong>: Choose common comparisons like last 7 days vs previous 7 days. <strong>Custom Range</strong>: Select specific dates for each period. <strong>Metrics Tracked</strong>: New players, deposits, withdrawals, GGR, average values, segment distribution, and risk levels. <strong>Change Indicators</strong>: Green arrows show improvement, red arrows show decline. Some metrics like withdrawals and churn use inverted colors (lower is better).' },
        comparison_cards: { title: 'Quick Comparison Cards', body: 'These cards show key metrics for both periods with percentage change indicators. <strong>Green up arrow</strong> = improvement (more revenue, more players). <strong>Red down arrow</strong> = decline. Note: For some metrics like withdrawals or churn, lower numbers are better, so colors are inverted.' },
        comparison_charts: { title: 'Comparison Charts', body: '<strong>Revenue Comparison</strong>: Bar chart showing deposits, withdrawals, and GGR for both periods side by side. <strong>Segment Comparison</strong>: Shows how player segment distribution changed between periods (VIP, High, Medium, Low).' },
        comparison_table: { title: 'Detailed Breakdown Table', body: 'Complete metrics comparison in table format with: <strong>Metric name</strong>, <strong>Period 1 value</strong>, <strong>Period 2 value</strong>, <strong>Absolute change</strong>, and <strong>Percentage trend</strong>. Export this data for reports.' },
        // Players Tab
        players: { title: 'Players Management', body: 'The Players tab is your main workspace for viewing and managing individual players. Use filters to find specific players, bulk select for batch operations, and click any player to view detailed information.' },
        filters: { title: 'Player Filters', body: 'Use filters to find specific player groups: <strong>Search</strong> = find by ID or phone. <strong>Profitability</strong> = profitable or negative GGR. <strong>Preference</strong> = sports/casino/mixed. <strong>Churn Risk</strong> = low to critical. <strong>Value</strong> = VIP to low. Combine filters and click Apply.' },
        saved_filters: { title: 'Saved Filters', body: 'Save frequently used filter combinations for quick access. Click the save icon after setting your filters, give it a name, and access it anytime from this panel. Click a saved filter to apply it instantly. Delete with the X button.' },
        watchlist: { title: 'Watchlist', body: 'Your personal list of players to monitor closely. Add players by clicking the star icon on any player row or in the player detail modal. Watched players are highlighted in the table. Use this for VIP management, suspicious accounts, or players requiring follow-up.' },
        recently_viewed: { title: 'Recently Viewed', body: 'Quick access to the last 10 players you viewed. Helpful for returning to players you were analyzing without searching again. Shows player ID and current churn risk level.' },
        bulk_actions: { title: 'Bulk Actions', body: 'Select multiple players using checkboxes, then perform batch operations: <strong>Add to Watchlist</strong> = star all selected players for monitoring. <strong>Export</strong> = download selected players as CSV file. Use Select All to select all visible players, or check individual rows.' },
        column_toggle: { title: 'Column Visibility', body: 'Customize which columns appear in the player table. Click the columns icon to show/hide: ID, Type, Preference, Net Revenue, Win Rate, Value Segment, Churn Risk, and LTV. Your preferences are saved automatically.' },
        auto_refresh: { title: 'Auto-Refresh', body: 'When enabled, player data automatically refreshes every 5 minutes to show the latest information from the database. The green indicator shows when auto-refresh is active. Disable for stability when doing detailed analysis.' },
        table_sorting: { title: 'Table Sorting', body: 'Click column headers to sort the table: <strong>ID</strong> = alphabetical/numerical order. <strong>Net Rev</strong> = by revenue (find highest/lowest earners). <strong>WR%</strong> = by win rate. <strong>Churn</strong> = by churn score. Click again to reverse order.' },
        quick_actions: { title: 'Quick Actions', body: 'Hover over any player row to see quick action buttons: <strong>Eye icon</strong> = view full player details. <strong>Star icon</strong> = add/remove from watchlist. These appear on hover for quick access without checkbox selection.' },
        pagination: { title: 'Pagination', body: 'The table shows 100 players per page. Use Prev/Next buttons to navigate. The counter shows which players you are viewing (e.g., 1-100 of 5,432) and current page number.' },
        export: { title: 'Export Data', body: 'Export player data as CSV files for external analysis or reporting. <strong>Export button</strong> = exports currently filtered players. <strong>Bulk Export</strong> = exports only selected players. Files include all key metrics.' },
        // Player Modal
        player_details: { title: 'Player Details Modal', body: 'Comprehensive view of a single player including financial summary, AI insights, risk analysis, and similar player recommendations. Use the Watch button to add to your watchlist.' },
        player_financials: { title: 'Player Financial Summary', body: '<strong>Net Revenue</strong> = total money the company made/lost from this player. <strong>Win Rate</strong> = percentage of bets won. <strong>Churn Score</strong> = risk of leaving (0-100). <strong>LTV</strong> = predicted lifetime value.' },
        player_ai_insights: { title: 'AI Insights', body: 'Automatically generated insights about this player: risk factors contributing to churn, profitability status, VIP indicators, and recommended bonus amounts based on their value and behavior patterns.' },
        similar_players: { title: 'Similar Players', body: 'Players with similar profiles based on betting patterns, value, and behavior. Useful for: understanding player segments, finding comparison points, and applying successful retention strategies from similar players.' },
        // Settings Tab
        settings: { title: 'Settings', body: 'Manage your account, import player data via CSV, configure analysis parameters, and view keyboard shortcuts for faster navigation.' },
        csv_import: { title: 'CSV Import', body: 'Upload player data from CSV files. The CSV should include: id, phone_number, total_deposit_amount, total_withdraw_amount, total_bet_amount, total_win_amount, and optionally registration_date. Data will be merged with existing records.' },
        parameters: { title: 'Analysis Parameters', body: 'Configure thresholds used for player analysis. Adjust win rate boundaries for profitability classification, value segment thresholds (VIP, High, Medium, Low), churn risk day thresholds, and score component weights. Reset to defaults if needed.' },
        param_profitability: { title: 'Profitability Parameters', body: 'Win rate thresholds that determine profitability categories: <strong>Most Profitable</strong> = WR below first threshold. <strong>Profitable</strong> = WR below second threshold. <strong>Break Even</strong> = WR around 50%. <strong>Negative GGR</strong> = WR above third threshold.' },
        param_value: { title: 'Value Segment Parameters', body: 'Revenue thresholds for categorizing player value: <strong>VIP</strong> = above VIP threshold (default K5000). <strong>High</strong> = between High and VIP. <strong>Medium</strong> = between Medium and High. <strong>Low</strong> = below Medium threshold.' },
        param_churn: { title: 'Churn Parameters', body: 'Days of inactivity thresholds for risk levels: <strong>Low</strong> = within first threshold. <strong>Medium</strong> = between first and second. <strong>High</strong> = between second and third. <strong>Critical</strong> = beyond third threshold. Also set weights for churn score calculation.' },
        // AI Assistant
        ai_assistant: { title: 'AI Assistant', body: 'Your intelligent CRM companion. Ask questions in natural language about your player data, get insights, find specific players, or request analysis. Try: Show me high-value players at risk of churning or What is the average LTV of VIP players?' },
        ai_commands: { title: 'AI Commands', body: 'Example queries: <strong>churn summary</strong> = overview of at-risk players. <strong>find player [ID]</strong> = look up specific player. <strong>show vip players</strong> = list VIP segment. <strong>compare sports vs casino</strong> = segment comparison. <strong>export critical churn</strong> = download at-risk players.' },
        // Command Palette
        command_palette: { title: 'Command Palette', body: 'Quick navigation tool (press Cmd+K or Ctrl+K). Type to search and jump to any section of the CRM instantly. Access tabs, run common actions, or launch the AI assistant without using the mouse.' },
        // Call Center
        callcenter: { title: 'Call Center', body: 'Manage outbound calls to at-risk players. The queue prioritizes clients by: <strong>Callbacks</strong> (scheduled follow-ups), <strong>Critical risk</strong> (30+ days inactive), <strong>High risk</strong> (14-30 days). After 5 failed call attempts, clients are moved to No Contact status. Staff only see limited info: phone number, registration date, and last deposit date.' }
      },
      ru: {
        // Dashboard Tab
        dashboard: { title: 'ÐžÐ±Ð·Ð¾Ñ€ Ð¿Ð°Ð½ÐµÐ»Ð¸', body: 'ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¾Ð±Ð·Ð¾Ñ€ Ð²Ð°ÑˆÐµÐ¹ Ð±Ð°Ð·Ñ‹ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². Ð—Ð´ÐµÑÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸: Ð¾Ð±Ñ‰ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² (ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸), ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² (ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚ Ñƒ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸) Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð² Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹.' },
        financial: { title: 'Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ð¹ Ð¾Ð±Ð·Ð¾Ñ€', body: 'Ð­Ñ‚Ð¾Ñ‚ Ñ€Ð°Ð·Ð´ÐµÐ» Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ. <strong>Ð”ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹</strong> = Ð´ÐµÐ½ÑŒÐ³Ð¸, Ð²Ð½ÐµÑÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸. <strong>Ð’Ñ‹Ð²Ð¾Ð´Ñ‹</strong> = Ð´ÐµÐ½ÑŒÐ³Ð¸, Ð²Ñ‹Ð²ÐµÐ´ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸. <strong>Ð§Ð¸ÑÑ‚Ñ‹Ð¹ GGR</strong> = Ð²Ð°Ñˆ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´Ð¾Ñ…Ð¾Ð´ Ð¾Ñ‚ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸.' },
        profitability_chart: { title: 'Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', body: 'Ð­Ñ‚Ð¾Ñ‚ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ (Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¹) Ð¸ ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¼Ð¸ (ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹) Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸. ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚, Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑ Ð´Ð¾Ñ…Ð¾Ð´ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸.' },
        churn_chart: { title: 'Ð“Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'Ð­Ñ‚Ð¾Ñ‚ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð½Ð° ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°. Ð—ÐµÐ»ÐµÐ½Ñ‹Ð¹ = Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸, Ð–ÐµÐ»Ñ‚Ñ‹Ð¹ = Ð¿Ñ€Ð¸Ð·Ð½Ð°ÐºÐ¸ ÑƒÑ…Ð¾Ð´Ð°, ÐžÑ€Ð°Ð½Ð¶ÐµÐ²Ñ‹Ð¹ = Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº, ÐšÑ€Ð°ÑÐ½Ñ‹Ð¹ = ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº.' },
        value_segments: { title: 'Ð¡ÐµÐ³Ð¼ÐµÐ½Ñ‚Ñ‹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸', body: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð·Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð¿Ð¾ Ð¸Ñ… Ð¾Ð±Ñ‰ÐµÐ¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸: <strong>VIP (K5k+)</strong> = Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð²Ñ‹ÑÑˆÐµÐ¹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸. <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</strong> = Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð²ÐºÐ»Ð°Ð´Ñ‡Ð¸ÐºÐ¸. <strong>Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</strong> = Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸. <strong>ÐÐ¸Ð·ÐºÐ¸Ð¹</strong> = ÐºÐ°Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸.' },
        preferences: { title: 'ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', body: 'ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚Ð¸Ð¿Ñ‹ Ð¸Ð³Ñ€, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ð¸Ñ‚Ð°ÑŽÑ‚ Ð¸Ð³Ñ€Ð¾ÐºÐ¸: <strong>Ð¡Ð¿Ð¾Ñ€Ñ‚</strong> = Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ ÑÑ‚Ð°Ð²ÐºÐ¸ Ð½Ð° ÑÐ¿Ð¾Ñ€Ñ‚. <strong>ÐšÐ°Ð·Ð¸Ð½Ð¾</strong> = Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ ÐºÐ°Ð·Ð¸Ð½Ð¾ Ð¸Ð³Ñ€Ñ‹. <strong>Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ðµ</strong> = Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¾Ð±Ð° Ñ‚Ð¸Ð¿Ð°.' },
        churn_risk: { title: 'Ð£Ñ€Ð¾Ð²Ð½Ð¸ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐÐ° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð´Ð½ÐµÐ¹ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸: <strong>ÐÐ¸Ð·ÐºÐ¸Ð¹</strong> = Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹. <strong>Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</strong> = 7-14 Ð´Ð½ÐµÐ¹ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½. <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</strong> = 14-30 Ð´Ð½ÐµÐ¹ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½. <strong>ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹</strong> = 30+ Ð´Ð½ÐµÐ¹ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½.' },
        alerts: { title: 'ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ñ', body: '<strong>Ð’Ñ‹Ð²Ð¾Ð´ÑÑ‚</strong> = Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð²Ñ‹Ð²Ð¾Ð´ÑÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð²Ð½Ð¾ÑÑÑ‚. <strong>Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½</strong> = Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½Ð¾Ð¼ÐµÑ€Ð°Ð¼Ð¸ (Ñ€Ð¸ÑÐº Ð¼Ð¾ÑˆÐµÐ½Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°). <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ WR</strong> = Ð½ÐµÐ¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚.' },
        total_players: { title: 'Ð’ÑÐµÐ³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²', body: 'ÐžÐ±Ñ‰ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÐ°. Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…, Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¸ ÑƒÑˆÐµÐ´ÑˆÐ¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².' },
        profitable_card: { title: 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', body: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸, Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ GGR Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸. Ð­Ñ‚Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð° Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ°. ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ð½Ð°Ñ ÑÑƒÐ¼Ð¼Ð° - Ð¾Ð±Ñ‰Ð°Ñ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ Ð¾Ñ‚ ÑÑ‚Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².' },
        negative_ggr_card: { title: 'Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', body: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸, ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ Ñ‡Ð¸ÑÑ‚Ñ‹Ð¹ ÑƒÐ±Ñ‹Ñ‚Ð¾Ðº Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€ÑŒÑ‚Ðµ ÑÑ‚Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð½Ð° Ð½ÐµÐ¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹.' },
        at_risk_card: { title: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ð² Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°', body: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ñ Ð’Ð«Ð¡ÐžÐšÐ˜Ðœ Ð¸Ð»Ð¸ ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ðœ Ñ€Ð¸ÑÐºÐ¾Ð¼ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐºÐ¾Ñ€ÐµÐµ Ð²ÑÐµÐ³Ð¾ ÑÐºÐ¾Ñ€Ð¾ Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ð½ÑƒÑ‚ Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ. Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ Ð¿Ð¾ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸ÑŽ.' },
        // Profitability Tab
        profitability: { title: 'ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', body: 'Ð­Ñ‚Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². <strong>ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ</strong> = Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸. <strong>Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ</strong> = Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸ - Ð¾Ð½Ð¸ ÑÑ‚Ð¾ÑÑ‚ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ð´ÐµÐ½ÐµÐ³.' },
        profit_distribution: { title: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»Ð¸', body: 'Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ñ€Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ñ… Ð¸ ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². Ð—Ð´Ð¾Ñ€Ð¾Ð²Ñ‹Ð¹ Ð±Ð¸Ð·Ð½ÐµÑ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð¼ÐµÑ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². ÐÐ°Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð° ÑÐµÐºÑ†Ð¸Ð¸ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð´Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ñ†Ð¸Ñ„Ñ€.' },
        winrate: { title: 'ÐÐ½Ð°Ð»Ð¸Ð· Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð°', body: 'Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚ = Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð½Ð½Ñ‹Ñ… ÑÑ‚Ð°Ð²Ð¾Ðº Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸. ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚ (0-40%) Ð»ÑƒÑ‡ÑˆÐµ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸. Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚ (50%+) Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð¾Ð±Ñ‹Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚ ÐºÐ°Ð·Ð¸Ð½Ð¾.' },
        winrate_segments: { title: 'Ð¡ÐµÐ³Ð¼ÐµÐ½Ñ‚Ñ‹ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð°', body: '<strong>0-25%</strong> = Ð¡Ð°Ð¼Ñ‹Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ - Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‚ 75%+ ÑÑ‚Ð°Ð²Ð¾Ðº. <strong>25-40%</strong> = ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ - Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸. <strong>40-50%</strong> = Ð‘ÐµÐ·ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ð°Ñ Ð·Ð¾Ð½Ð°. <strong>50%+</strong> = Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ GGR - Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸.' },
        profit_summary: { title: 'ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»Ð¸', body: 'Ð—ÐµÐ»ÐµÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¾Ð±Ñ‰ÑƒÑŽ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ Ð¾Ñ‚ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². ÐšÑ€Ð°ÑÐ½Ð°Ñ - ÑƒÐ±Ñ‹Ñ‚ÐºÐ¸ Ð¾Ñ‚ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ñ…. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².' },
        // Behavior Tab
        behavior: { title: 'ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ', body: 'Ð­Ñ‚Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ ÑÑ‚Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð²Ð¾Ðº Ð¸ ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð°. ÐŸÐ¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ñ†ÐµÐ»ÐµÐ²Ñ‹Ðµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸.' },
        betting_styles: { title: 'Ð¡Ñ‚Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð²Ð¾Ðº', body: '<strong>Ð¥Ð°Ð¹Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹</strong> = ÑÑ€ÐµÐ´Ð½ÑÑ ÑÑ‚Ð°Ð²ÐºÐ° Ð±Ð¾Ð»ÐµÐµ K100, Ñ†ÐµÐ½Ð½Ñ‹Ðµ Ð½Ð¾ Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ. <strong>ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ</strong> = ÑÑ€ÐµÐ´Ð½ÑÑ ÑÑ‚Ð°Ð²ÐºÐ° K10-100, Ð²Ð°ÑˆÐ° Ð¾ÑÐ½Ð¾Ð²Ð°. <strong>ÐšÐ°Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ</strong> = ÑÑ€ÐµÐ´Ð½ÑÑ ÑÑ‚Ð°Ð²ÐºÐ° Ð¼ÐµÐ½ÐµÐµ K10.' },
        lifecycle: { title: 'Ð–Ð¸Ð·Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ»', body: 'ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð³Ð´Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² Ð¸Ñ… Ð¿ÑƒÑ‚Ð¸: <strong>ÐÐ¾Ð²Ñ‹Ðµ</strong> = Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð»Ð¸ÑÑŒ Ð¼ÐµÐ½ÐµÐµ 30 Ð´Ð½ÐµÐ¹ Ð½Ð°Ð·Ð°Ð´. <strong>Ð Ð°ÑÑ‚ÑƒÑ‰Ð¸Ðµ</strong> = ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ. <strong>Ð—Ñ€ÐµÐ»Ñ‹Ðµ</strong> = ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð²ÑˆÐ¸ÐµÑÑ Ð¸Ð³Ñ€Ð¾ÐºÐ¸.' },
        lifecycle_stages: { title: 'Ð¡Ñ‚Ð°Ð´Ð¸Ð¸ Ñ†Ð¸ÐºÐ»Ð°', body: '<strong>ÐÐ¾Ð²Ñ‹Ð¼</strong> Ð½ÑƒÐ¶ÐµÐ½ Ð¾Ð½Ð±Ð¾Ñ€Ð´Ð¸Ð½Ð³ Ð¸ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð±Ð¾Ð½ÑƒÑÑ‹. <strong>Ð Ð°ÑÑ‚ÑƒÑ‰Ð¸Ñ…</strong> Ð½ÑƒÐ¶Ð½Ð¾ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°Ñ‚ÑŒ. <strong>Ð—Ñ€ÐµÐ»Ñ‹Ð¼</strong> Ð½ÑƒÐ¶Ð½Ñ‹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸. <strong>Ð¡Ð½Ð¸Ð¶Ð°ÑŽÑ‰Ð¸Ð¼ÑÑ/Ð¡Ð¿ÑÑ‰Ð¸Ð¼</strong> Ð½ÑƒÐ¶Ð½Ñ‹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ñ€ÐµÐ°ÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ð¸.' },
        style_cards: { title: 'ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ ÑÑ‚Ð¸Ð»ÐµÐ¹', body: 'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² ÑÑ‚Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸. Ð¥Ð°Ð¹Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹ ÑÐ°Ð¼Ñ‹Ðµ Ñ†ÐµÐ½Ð½Ñ‹Ðµ Ð½Ð¾ Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ. ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ - ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð°Ñ Ð±Ð°Ð·Ð° Ð´Ð¾Ñ…Ð¾Ð´Ð°.' },
        // Churn Tab
        churn: { title: 'ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐÐ½Ð°Ð»Ð¸Ð· Ð¾Ñ‚Ñ‚Ð¾ÐºÐ° Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ð¾Ð³ÑƒÑ‚ ÑƒÐ¹Ñ‚Ð¸. Ð¡Ð¾ÑÑ€ÐµÐ´Ð¾Ñ‚Ð¾Ñ‡ÑŒÑ‚Ðµ ÑƒÑÐ¸Ð»Ð¸Ñ Ð½Ð° Ð²Ñ‹ÑÐ¾ÐºÐ¾Ñ†ÐµÐ½Ð½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ°Ñ… Ñ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð½Ñ‹Ð¼ Ñ€Ð¸ÑÐºÐ¾Ð¼ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°.' },
        churn_distribution: { title: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñ€Ð¸ÑÐºÐ°. Ð’ Ð¸Ð´ÐµÐ°Ð»Ðµ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ð¾ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÑ… ÐÐ¸Ð·ÐºÐ¸Ð¹/Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹. Ð’Ñ‹ÑÐ¾ÐºÐ¸Ðµ Ñ‡Ð¸ÑÐ»Ð° Ð² Ð’Ñ‹ÑÐ¾ÐºÐ¾Ð¼/ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹.' },
        churn_score: { title: 'Ð Ð°Ð·Ð±Ð¸Ð²ÐºÐ° Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐžÑ†ÐµÐ½ÐºÐ° 0-100 Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ ÑƒÑ…Ð¾Ð´Ð°. Ð’Ð·Ð²ÐµÑˆÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ñ‹: <strong>ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ</strong> (35%) - Ð´Ð½Ð¸ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸. <strong>ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð²</strong> (20%). <strong>Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñ‹</strong> (15%). <strong>Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚</strong> (10%). <strong>Ð¦ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ</strong> (5%).' },
        churn_factors: { title: 'Ð¤Ð°ÐºÑ‚Ð¾Ñ€Ñ‹ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ñ‹: <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð²</strong> - Ð·Ð°Ð±Ð¸Ñ€Ð°ÑŽÑ‚ Ð´ÐµÐ½ÑŒÐ³Ð¸. <strong>Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸</strong> - Ñ€ÐµÐ¶Ðµ ÑÑ‚Ð°Ð²ÑÑ‚. <strong>Ð”Ð¾Ð»Ð³Ð°Ñ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ</strong> - Ð½Ðµ Ð¸Ð³Ñ€Ð°ÑŽÑ‚ Ð´Ð¾Ð»Ð³Ð¾. <strong>Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½</strong> - Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ñ„ÐµÐ¹ÐºÐ¾Ð²Ñ‹Ðµ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ñ‹.' },
        inactivity_chart: { title: 'Ð¢Ð°Ð¹Ð¼Ð»Ð°Ð¹Ð½ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸', body: 'ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ¾Ð³Ð´Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð±Ñ‹Ð»Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹: <strong>ÐœÐµÐ½ÐµÐµ 7 Ð´Ð½ÐµÐ¹</strong> = ÐÐµÐ´Ð°Ð²Ð½Ð¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ. <strong>7-14 Ð´Ð½ÐµÐ¹</strong> = ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‚ Ð¾Ñ‚Ð´Ð°Ð»ÑÑ‚ÑŒÑÑ. <strong>14-30 Ð´Ð½ÐµÐ¹</strong> = Ð‘ÐµÑÐ¿Ð¾ÐºÐ¾ÑÑ‰Ð°Ñ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ. <strong>30+ Ð´Ð½ÐµÐ¹</strong> = Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ ÑƒÑˆÐ»Ð¸.' },
        // Analytics Tab
        analytics: { title: 'ÐŸÑ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°', body: 'Ð“Ð»ÑƒÐ±Ð¾ÐºÐ°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ñ‹ LTV, ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð¸ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°Ð¼. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð¸Ñ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ….' },
        ltv: { title: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ LTV', body: 'LTV (ÐŸÐ¾Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ) Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð¾Ñ…Ð¾Ð´Ð° Ð¿Ñ€Ð¸Ð½ÐµÑÐµÑ‚ Ð¸Ð³Ñ€Ð¾Ðº Ð·Ð° Ð²ÑÑ‘ Ð²Ñ€ÐµÐ¼Ñ. Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÐºÐ°Ðº: Ð´Ð½ÐµÐ²Ð½Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ ÑƒÐ¼Ð½Ð¾Ð¶ÐµÐ½Ð½Ð°Ñ Ð½Ð° Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼Ð¾Ðµ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ. Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ñ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¼ LTV Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°ÑŽÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¹ Ð² ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ.' },
        comparison: { title: 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð²', body: 'Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°Ð¹Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð´Ð»Ñ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð¸Ð¹ Ð¸ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹.' },
        data_comparison: { title: 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…', body: 'Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð´Ð²ÑƒÐ¼Ñ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°Ð¼Ð¸ Ð´Ð»Ñ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð². <strong>ÐŸÑ€ÐµÐ´ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ñ‹</strong>: Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ. <strong>Ð¡Ð²Ð¾Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½</strong>: Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð°Ñ‚Ñ‹. <strong>Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹</strong>: Ð—ÐµÐ»ÐµÐ½Ñ‹Ðµ ÑÑ‚Ñ€ÐµÐ»ÐºÐ¸ - ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ, ÐºÑ€Ð°ÑÐ½Ñ‹Ðµ - ÑƒÑ…ÑƒÐ´ÑˆÐµÐ½Ð¸Ðµ.' },
        comparison_cards: { title: 'ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ', body: 'ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð¾Ð±Ð¾Ð¸Ñ… Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð¾Ð² Ñ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð°Ð¼Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹. <strong>Ð—ÐµÐ»ÐµÐ½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° Ð²Ð²ÐµÑ€Ñ…</strong> = ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ. <strong>ÐšÑ€Ð°ÑÐ½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° Ð²Ð½Ð¸Ð·</strong> = ÑƒÑ…ÑƒÐ´ÑˆÐµÐ½Ð¸Ðµ. Ð”Ð»Ñ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¼ÐµÑ‚Ñ€Ð¸Ðº Ñ†Ð²ÐµÑ‚Ð° Ð¸Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹.' },
        comparison_charts: { title: 'Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ', body: '<strong>Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð¾Ñ…Ð¾Ð´Ð¾Ð²</strong>: Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ð°Ñ Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ð², Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð² Ð¸ GGR. <strong>Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð²</strong>: Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°Ð¼ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°Ð¼Ð¸.' },
        comparison_table: { title: 'Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸', body: 'ÐŸÐ¾Ð»Ð½Ð¾Ðµ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¼ÐµÑ‚Ñ€Ð¸Ðº Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ‡Ð½Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ: Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸, Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° 1, Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° 2, Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð½Ñ‹Ð¹ Ñ‚Ñ€ÐµÐ½Ð´.' },
        // Players Tab
        players: { title: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸', body: 'Ð’ÐºÐ»Ð°Ð´ÐºÐ° Ð˜Ð³Ñ€Ð¾ÐºÐ¸ - Ð²Ð°ÑˆÐµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐµ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹, Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ Ð´Ð»Ñ Ð¿Ð°ÐºÐµÑ‚Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹.' },
        filters: { title: 'Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹', body: 'Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð³Ñ€ÑƒÐ¿Ð¿ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²: <strong>ÐŸÐ¾Ð¸ÑÐº</strong> = Ð¿Ð¾ ID Ð¸Ð»Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ. <strong>ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ</strong> = Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ/ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ. <strong>ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ</strong> = ÑÐ¿Ð¾Ñ€Ñ‚/ÐºÐ°Ð·Ð¸Ð½Ð¾/ÑÐ¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ðµ. <strong>Ð Ð¸ÑÐº Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°</strong>. <strong>Ð¦ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ</strong>. ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ.' },
        saved_filters: { title: 'Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹', body: 'Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐ¹Ñ‚Ðµ Ñ‡Ð°ÑÑ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ðµ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð². ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð², Ð´Ð°Ð¹Ñ‚Ðµ Ð¸Ð¼Ñ. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ. Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ X.' },
        watchlist: { title: 'ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ', body: 'Ð’Ð°Ñˆ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°. Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð½Ð°Ð¶Ð°Ñ‚Ð¸ÐµÐ¼ Ð·Ð²ÐµÐ·Ð´Ñ‹ Ð² ÑÑ‚Ñ€Ð¾ÐºÐµ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð¸Ð»Ð¸ Ð² Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ð¾ÐºÐ½Ðµ. ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸ Ð¿Ð¾Ð´ÑÐ²ÐµÑ‡ÐµÐ½Ñ‹ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ.' },
        recently_viewed: { title: 'ÐÐµÐ´Ð°Ð²Ð½Ð¾ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð½Ñ‹Ðµ', body: 'Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¼ 10 Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð½Ñ‹Ð¼ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼. ÐŸÐ¾Ð»ÐµÐ·Ð½Ð¾ Ð´Ð»Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° Ðº Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¼ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼ Ð±ÐµÐ· Ð¿Ð¾Ð¸ÑÐºÐ°.' },
        bulk_actions: { title: 'ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ', body: 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°Ð¼Ð¸, Ð·Ð°Ñ‚ÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¿Ð°ÐºÐµÑ‚Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸: <strong>Ð’ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ</strong> = Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµÑ… Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ…. <strong>Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚</strong> = ÑÐºÐ°Ñ‡Ð°Ñ‚ÑŒ ÐºÐ°Ðº CSV. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð²Ð¸Ð´Ð¸Ð¼Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².' },
        column_toggle: { title: 'Ð’Ð¸Ð´Ð¸Ð¼Ð¾ÑÑ‚ÑŒ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð¾Ð²', body: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ°ÐºÐ¸Ðµ ÑÑ‚Ð¾Ð»Ð±Ñ†Ñ‹ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð¾Ð² Ð´Ð»Ñ Ð¿Ð¾ÐºÐ°Ð·Ð°/ÑÐºÑ€Ñ‹Ñ‚Ð¸Ñ: ID, Ð¢Ð¸Ð¿, ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ, Ð”Ð¾Ñ…Ð¾Ð´, Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚, Ð¦ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ, Ð Ð¸ÑÐº Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°, LTV. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ.' },
        auto_refresh: { title: 'ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ', body: 'ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð¼Ð¸Ð½ÑƒÑ‚. Ð—ÐµÐ»ÐµÐ½Ñ‹Ð¹ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ. ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð´Ð»Ñ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¸ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ð°Ð½Ð°Ð»Ð¸Ð·Ðµ.' },
        table_sorting: { title: 'Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹', body: 'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð¾Ð² Ð´Ð»Ñ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ¸: <strong>ID</strong> = Ð°Ð»Ñ„Ð°Ð²Ð¸Ñ‚Ð½Ð¾. <strong>Ð”Ð¾Ñ…Ð¾Ð´</strong> = Ð¿Ð¾ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐµ. <strong>WR%</strong> = Ð¿Ð¾ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ñƒ. <strong>ÐžÑ‚Ñ‚Ð¾Ðº</strong> = Ð¿Ð¾ Ð¾Ñ†ÐµÐ½ÐºÐµ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ðµ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ðµ Ð¼ÐµÐ½ÑÐµÑ‚ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº.' },
        quick_actions: { title: 'Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ', body: 'ÐÐ°Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð° ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹: <strong>Ð“Ð»Ð°Ð·</strong> = Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹. <strong>Ð—Ð²ÐµÐ·Ð´Ð°</strong> = Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ/ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ….' },
        pagination: { title: 'ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ', body: 'Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ 100 Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐŸÑ€ÐµÐ´/Ð¡Ð»ÐµÐ´ Ð´Ð»Ñ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸. Ð¡Ñ‡ÐµÑ‚Ñ‡Ð¸Ðº Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð¸ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ.' },
        export: { title: 'Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…', body: 'Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² ÐºÐ°Ðº CSV Ð´Ð»Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°. <strong>Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚</strong> = Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸. <strong>ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚</strong> = Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ.' },
        // Player Modal
        player_details: { title: 'Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°', body: 'ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð¾Ð±Ð·Ð¾Ñ€ Ð¸Ð³Ñ€Ð¾ÐºÐ°: Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ ÑÐ²Ð¾Ð´ÐºÐ°, AI Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°, Ð°Ð½Ð°Ð»Ð¸Ð· Ñ€Ð¸ÑÐºÐ¾Ð² Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ñ…Ð¾Ð¶Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº.' },
        player_financials: { title: 'Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹ Ð¸Ð³Ñ€Ð¾ÐºÐ°', body: '<strong>Ð§Ð¸ÑÑ‚Ñ‹Ð¹ Ð´Ð¾Ñ…Ð¾Ð´</strong> = ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð°/Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»Ð°. <strong>Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚</strong> = Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð½Ð½Ñ‹Ñ… ÑÑ‚Ð°Ð²Ð¾Ðº. <strong>ÐžÑ†ÐµÐ½ÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°</strong> = Ñ€Ð¸ÑÐº ÑƒÑ…Ð¾Ð´Ð° (0-100). <strong>LTV</strong> = Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð¸Ñ€ÑƒÐµÐ¼Ð°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ.' },
        player_ai_insights: { title: 'AI ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°', body: 'ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¸Ð½ÑÐ°Ð¹Ñ‚Ñ‹: Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ñ‹ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°, ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸, Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹ VIP Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ðµ Ð±Ð¾Ð½ÑƒÑÑ‹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ.' },
        similar_players: { title: 'ÐŸÐ¾Ñ…Ð¾Ð¶Ð¸Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸', body: 'Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ñ Ð¿Ð¾Ñ…Ð¾Ð¶Ð¸Ð¼Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑÐ¼Ð¸ Ð¿Ð¾ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð°Ð¼ ÑÑ‚Ð°Ð²Ð¾Ðº, Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸ÑŽ. ÐŸÐ¾Ð»ÐµÐ·Ð½Ð¾ Ð´Ð»Ñ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ.' },
        // Settings Tab
        settings: { title: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸', body: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð¾Ð¼, Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‡ÐµÑ€ÐµÐ· CSV, Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸ Ð¿Ñ€Ð¾ÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð³Ð¾Ñ€ÑÑ‡Ð¸Ðµ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸.' },
        csv_import: { title: 'Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ CSV', body: 'Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð¸Ð· CSV Ñ„Ð°Ð¹Ð»Ð¾Ð². CSV Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ: id, phone_number, total_deposit_amount, total_withdraw_amount, total_bet_amount, total_win_amount Ð¸ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ registration_date.' },
        parameters: { title: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°', body: 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². Ð ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð° Ð´Ð»Ñ ÐºÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸, Ð¿Ð¾Ñ€Ð¾Ð³Ð¸ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸, Ð¿Ð¾Ñ€Ð¾Ð³Ð¸ Ð´Ð½ÐµÐ¹ Ð´Ð»Ñ Ñ€Ð¸ÑÐºÐ° Ð¾Ñ‚Ñ‚Ð¾ÐºÐ° Ð¸ Ð²ÐµÑÐ° ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð² Ð¾Ñ†ÐµÐ½ÐºÐ¸.' },
        param_profitability: { title: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸', body: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚Ð° Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸: <strong>Ð¡Ð°Ð¼Ñ‹Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ</strong> = WR Ð½Ð¸Ð¶Ðµ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ñ€Ð¾Ð³Ð°. <strong>ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ</strong> = WR Ð½Ð¸Ð¶Ðµ Ð²Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾. <strong>Ð‘ÐµÐ·ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ</strong> = WR Ð¾ÐºÐ¾Ð»Ð¾ 50%. <strong>Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ</strong> = WR Ð²Ñ‹ÑˆÐµ Ñ‚Ñ€ÐµÑ‚ÑŒÐµÐ³Ð¾.' },
        param_value: { title: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸', body: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð´Ð¾Ñ…Ð¾Ð´Ð° Ð´Ð»Ñ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð²: <strong>VIP</strong> = Ð²Ñ‹ÑˆÐµ Ð¿Ð¾Ñ€Ð¾Ð³Ð° VIP (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ K5000). <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</strong> = Ð¼ÐµÐ¶Ð´Ñƒ Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¼ Ð¸ VIP. <strong>Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</strong> = Ð¼ÐµÐ¶Ð´Ñƒ Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¼ Ð¸ Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¼. <strong>ÐÐ¸Ð·ÐºÐ¸Ð¹</strong> = Ð½Ð¸Ð¶Ðµ Ð¿Ð¾Ñ€Ð¾Ð³Ð° Ð¡Ñ€ÐµÐ´Ð½ÐµÐ³Ð¾.' },
        param_churn: { title: 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°', body: 'ÐŸÐ¾Ñ€Ð¾Ð³Ð¸ Ð´Ð½ÐµÐ¹ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸: <strong>ÐÐ¸Ð·ÐºÐ¸Ð¹</strong> = Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ñ€Ð¾Ð³Ð°. <strong>Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</strong> = Ð¼ÐµÐ¶Ð´Ñƒ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ Ð¸ Ð²Ñ‚Ð¾Ñ€Ñ‹Ð¼. <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</strong> = Ð¼ÐµÐ¶Ð´Ñƒ Ð²Ñ‚Ð¾Ñ€Ñ‹Ð¼ Ð¸ Ñ‚Ñ€ÐµÑ‚ÑŒÐ¸Ð¼. <strong>ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹</strong> = Ð·Ð° Ñ‚Ñ€ÐµÑ‚ÑŒÐ¸Ð¼ Ð¿Ð¾Ñ€Ð¾Ð³Ð¾Ð¼.' },
        // AI Assistant
        ai_assistant: { title: 'AI ÐÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚', body: 'Ð’Ð°Ñˆ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº CRM. Ð—Ð°Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¼ ÑÐ·Ñ‹ÐºÐµ Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ Ð¸Ð½ÑÐ°Ð¹Ñ‚Ñ‹, Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð¸Ð»Ð¸ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°Ð¹Ñ‚Ðµ Ð°Ð½Ð°Ð»Ð¸Ð·.' },
        ai_commands: { title: 'AI ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹', body: 'ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²: <strong>churn summary</strong> = Ð¾Ð±Ð·Ð¾Ñ€ Ñ€Ð¸ÑÐºÐ¾Ð²Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð². <strong>find player [ID]</strong> = Ð½Ð°Ð¹Ñ‚Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°. <strong>show vip players</strong> = ÑÐ¿Ð¸ÑÐ¾Ðº VIP. <strong>compare sports vs casino</strong> = ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð².' },
        // Command Palette
        command_palette: { title: 'ÐŸÐ°Ð»Ð¸Ñ‚Ñ€Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´', body: 'Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸ (Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Cmd+K Ð¸Ð»Ð¸ Ctrl+K). Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ðº Ð»ÑŽÐ±Ð¾Ð¼Ñƒ Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ CRM Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾. Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð²ÐºÐ»Ð°Ð´ÐºÐ°Ð¼, Ð·Ð°Ð¿ÑƒÑÐº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð¸Ð»Ð¸ AI Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð° Ð±ÐµÐ· Ð¼Ñ‹ÑˆÐ¸.' },
        // Call Center
        callcenter: { title: 'ÐšÐ¾Ð»Ð»-Ñ†ÐµÐ½Ñ‚Ñ€', body: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ð¼Ð¸ Ð·Ð²Ð¾Ð½ÐºÐ°Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼ Ð² Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°. ÐžÑ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÐ·Ð¸Ñ€ÑƒÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¿Ð¾: <strong>ÐžÐ±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ Ð·Ð²Ð¾Ð½ÐºÐ¸</strong> (Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ), <strong>ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº</strong> (30+ Ð´Ð½ÐµÐ¹ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½), <strong>Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº</strong> (14-30 Ð´Ð½ÐµÐ¹). ÐŸÐ¾ÑÐ»Ðµ 5 Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ñ‹Ñ… Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð¾Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² ÑÑ‚Ð°Ñ‚ÑƒÑ ÐÐµÑ‚ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°. ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð» Ð²Ð¸Ð´Ð¸Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾: Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½, Ð´Ð°Ñ‚Ñƒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸ Ð´Ð°Ñ‚Ñƒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð°.' }
      }
    };

    function showTutorial(key) {
      const lang = App.currentLang;
      const tutorial = TUTORIALS[lang]?.[key] || TUTORIALS.en[key];
      if (!tutorial) return;
      
      document.getElementById('tutorialTitle').textContent = tutorial.title;
      document.getElementById('tutorialBody').innerHTML = tutorial.body;
      document.getElementById('tutorialModal').classList.remove('hidden');
      lucide.createIcons();
    }

    function closeTutorial() {
      document.getElementById('tutorialModal').classList.add('hidden');
    }

    // ============================================================
    // PARAMETERS MODAL
    // ============================================================
    function openParamsModal() {
      // Populate all fields with current values
      document.getElementById('param_winRate1').value = App.params.winRate1;
      document.getElementById('param_winRate2').value = App.params.winRate2;
      document.getElementById('param_winRate3').value = App.params.winRate3;
      document.getElementById('param_vipMin').value = App.params.vipMin;
      document.getElementById('param_highMin').value = App.params.highMin;
      document.getElementById('param_mediumMin').value = App.params.mediumMin;
      document.getElementById('param_highRollerMin').value = App.params.highRollerMin;
      document.getElementById('param_casualMax').value = App.params.casualMax;
      document.getElementById('param_newPlayerDays').value = App.params.newPlayerDays;
      document.getElementById('param_churnLowDays').value = App.params.churnLowDays;
      document.getElementById('param_churnMedDays').value = App.params.churnMedDays;
      document.getElementById('param_churnHighDays').value = App.params.churnHighDays;
      document.getElementById('param_churnWeightInactivity').value = App.params.churnWeightInactivity;
      document.getElementById('param_churnWeightWithdrawal').value = App.params.churnWeightWithdrawal;
      document.getElementById('param_churnWeightFrequency').value = App.params.churnWeightFrequency;
      document.getElementById('param_churnWeightWinRate').value = App.params.churnWeightWinRate;
      document.getElementById('param_churnWeightValue').value = App.params.churnWeightValue;
      
      // Update previews
      updateParamPreviews();
      
      // Add input listeners for live preview
      const inputs = document.querySelectorAll('#paramsModal input');
      inputs.forEach(input => {
        input.addEventListener('input', updateParamPreviews);
      });
      
      document.getElementById('paramsModal').classList.remove('hidden');
      lucide.createIcons();
    }

    function closeParamsModal() {
      document.getElementById('paramsModal').classList.add('hidden');
    }

    function updateParamPreviews() {
      // Win rate previews
      const wr1 = document.getElementById('param_winRate1').value || 25;
      const wr2 = document.getElementById('param_winRate2').value || 40;
      const wr3 = document.getElementById('param_winRate3').value || 50;
      setText('wr1Preview', wr1);
      setText('wr1bPreview', wr1);
      setText('wr2Preview', wr2);
      setText('wr3Preview', wr3);
      
      // Value segment previews
      const vip = document.getElementById('param_vipMin').value || 5000;
      const high = document.getElementById('param_highMin').value || 1000;
      const med = document.getElementById('param_mediumMin').value || 100;
      setText('vipPreview', vip);
      setText('highPreview', high);
      setText('highMaxPreview', vip);
      setText('medPreview', med);
      setText('medMaxPreview', high);
      
      // Betting style previews
      setText('hrPreview', document.getElementById('param_highRollerMin').value || 100);
      setText('casualPreview', document.getElementById('param_casualMax').value || 10);
      
      // Lifecycle preview
      setText('newDaysPreview', document.getElementById('param_newPlayerDays').value || 30);
      
      // Churn previews
      const churnLow = document.getElementById('param_churnLowDays').value || 7;
      const churnMed = document.getElementById('param_churnMedDays').value || 14;
      const churnHigh = document.getElementById('param_churnHighDays').value || 30;
      setText('churnLowPreview', churnLow);
      setText('churnLowPreview2', churnLow);
      setText('churnMedPreview', churnMed);
      setText('churnMedPreview2', churnMed);
      setText('churnHighPreview', churnHigh);
      setText('churnCritPreview', churnHigh);
      
      // Weight sum
      const weightSum = (parseInt(document.getElementById('param_churnWeightInactivity').value) || 0) +
                       (parseInt(document.getElementById('param_churnWeightWithdrawal').value) || 0) +
                       (parseInt(document.getElementById('param_churnWeightFrequency').value) || 0) +
                       (parseInt(document.getElementById('param_churnWeightWinRate').value) || 0) +
                       (parseInt(document.getElementById('param_churnWeightValue').value) || 0);
      const sumEl = document.getElementById('weightSum');
      if (sumEl) {
        sumEl.textContent = weightSum;
        sumEl.className = weightSum >= 80 && weightSum <= 100 ? 'font-bold text-emerald-600' : 'font-bold text-red-600';
      }
    }

    function saveParams() {
      // Read all values from inputs
      App.params.winRate1 = parseInt(document.getElementById('param_winRate1').value) || DEFAULT_PARAMS.winRate1;
      App.params.winRate2 = parseInt(document.getElementById('param_winRate2').value) || DEFAULT_PARAMS.winRate2;
      App.params.winRate3 = parseInt(document.getElementById('param_winRate3').value) || DEFAULT_PARAMS.winRate3;
      App.params.vipMin = parseInt(document.getElementById('param_vipMin').value) || DEFAULT_PARAMS.vipMin;
      App.params.highMin = parseInt(document.getElementById('param_highMin').value) || DEFAULT_PARAMS.highMin;
      App.params.mediumMin = parseInt(document.getElementById('param_mediumMin').value) || DEFAULT_PARAMS.mediumMin;
      App.params.highRollerMin = parseInt(document.getElementById('param_highRollerMin').value) || DEFAULT_PARAMS.highRollerMin;
      App.params.casualMax = parseInt(document.getElementById('param_casualMax').value) || DEFAULT_PARAMS.casualMax;
      App.params.newPlayerDays = parseInt(document.getElementById('param_newPlayerDays').value) || DEFAULT_PARAMS.newPlayerDays;
      App.params.churnLowDays = parseInt(document.getElementById('param_churnLowDays').value) || DEFAULT_PARAMS.churnLowDays;
      App.params.churnMedDays = parseInt(document.getElementById('param_churnMedDays').value) || DEFAULT_PARAMS.churnMedDays;
      App.params.churnHighDays = parseInt(document.getElementById('param_churnHighDays').value) || DEFAULT_PARAMS.churnHighDays;
      App.params.churnWeightInactivity = parseInt(document.getElementById('param_churnWeightInactivity').value) || DEFAULT_PARAMS.churnWeightInactivity;
      App.params.churnWeightWithdrawal = parseInt(document.getElementById('param_churnWeightWithdrawal').value) || DEFAULT_PARAMS.churnWeightWithdrawal;
      App.params.churnWeightFrequency = parseInt(document.getElementById('param_churnWeightFrequency').value) || DEFAULT_PARAMS.churnWeightFrequency;
      App.params.churnWeightWinRate = parseInt(document.getElementById('param_churnWeightWinRate').value) || DEFAULT_PARAMS.churnWeightWinRate;
      App.params.churnWeightValue = parseInt(document.getElementById('param_churnWeightValue').value) || DEFAULT_PARAMS.churnWeightValue;
      
      // Save to localStorage
      localStorage.setItem('crmParams', JSON.stringify(App.params));
      
      // Reprocess all players with new parameters
      reprocessPlayersWithNewParams();
      
      // Update settings display
      updateSettingsDisplay();
      
      closeParamsModal();
      showNotification(App.currentLang === 'ru' ? 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ñ‹' : 'Parameters saved and applied', 'success');
    }

    function resetParamsToDefault() {
      const isRu = App.currentLang === 'ru';
      if (!confirm(isRu ? 'Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ðº Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÐ¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ?' : 'Reset all parameters to default values?')) return;
      
      // Reset App.params to defaults
      App.params = { ...DEFAULT_PARAMS };
      
      // Save to localStorage
      localStorage.setItem('crmParams', JSON.stringify(App.params));
      
      // Reprocess players
      reprocessPlayersWithNewParams();
      
      // Update settings display
      updateSettingsDisplay();
      
      // Re-populate the modal fields
      openParamsModal();
      
      showNotification(isRu ? 'ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ñ‹ Ðº Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÐ¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ' : 'Parameters reset to defaults', 'success');
    }

    function reprocessPlayersWithNewParams() {
      if (!App.players.length) return;
      
      showLoading(true, App.currentLang === 'ru' ? 'ÐŸÐµÑ€ÐµÑÑ‡ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…...' : 'Recalculating...');
      
      // Reprocess all players with new parameters
      App.processedPlayers = App.players.map(processPlayer);
      App.statsCache = null;
      
      // Reapply current filter if any
      if (App.currentFilter) {
        showFilteredPlayers(App.currentFilter, document.getElementById('currentFilterName')?.textContent || 'Filtered');
      } else {
        App.filteredPlayers = [...App.processedPlayers];
      }
      
      // Update all UI
      updateAllStats();
      updateAllCharts();
      renderTable();
      runProactiveAnalysis();
      
      showLoading(false);
    }

    function updateSettingsDisplay() {
      // Update settings tab display
      setText('settingsWR1', App.params.winRate1);
      setText('settingsWR2', App.params.winRate2);
      setText('settingsWR3', App.params.winRate3);
      setText('settingsVip', App.params.vipMin);
      setText('settingsHigh', App.params.highMin);
      setText('settingsMed', App.params.mediumMin);
      setText('settingsChurnL', App.params.churnLowDays);
      setText('settingsChurnM', App.params.churnMedDays);
      setText('settingsChurnH', App.params.churnHighDays);
    }

    // ============================================================
    // UTILITIES
    // ============================================================
    const debounce = (fn, delay) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), delay); }; };
    const formatK = v => 'K' + (v || 0).toLocaleString();
    const formatPct = v => (v || 0).toFixed(1) + '%';
    const setText = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };

    // ============================================================
    // CHURN SCORING (Using configurable weights)
    // ============================================================
    function calculateChurnScore(p) {
      let score = 0;
      const factors = [];
      const days = p.daysSinceActivity || 0;
      
      // Inactivity score (configurable weight)
      const inactivityScore = Math.min(days / 60, 1) * App.params.churnWeightInactivity;
      score += inactivityScore;
      if (days > 7) factors.push(`${days}d inactive`);
      
      // Withdrawal ratio (configurable weight)
      const deposits = parseFloat(p.total_deposit_amount) || 0;
      const withdrawals = parseFloat(p.total_withdraw_amount) || 0;
      const wdRatio = deposits > 0 ? withdrawals / deposits : 0;
      if (wdRatio > 0.8) { 
        score += App.params.churnWeightWithdrawal * Math.min(wdRatio - 0.8, 0.5) * 2; 
        factors.push('High withdrawals'); 
      }
      
      // Value at risk (configurable weight)
      const netRev = p.netRevenue || 0;
      if (netRev > App.params.vipMin) { 
        score += App.params.churnWeightValue; 
        factors.push('VIP at risk'); 
      }
      
      // Winning and withdrawing pattern (configurable weight)
      const wr = p.winRate || 0;
      if (wr > 60 && wdRatio > 0.5) { 
        score += App.params.churnWeightWinRate; 
        factors.push('Winning & withdrawing'); 
      }
      
      score = Math.min(Math.round(score), 100);
      
      // Determine risk level based on configurable thresholds
      let risk = days > App.params.churnHighDays || score >= 70 ? 'critical' :
                 days > App.params.churnMedDays || score >= 50 ? 'high' :
                 days > App.params.churnLowDays || score >= 30 ? 'medium' : 'low';
      
      return { score, risk, factors };
    }

    function calculateLTV(p) {
      const days = Math.max(p.daysSinceRegistration || 1, 1);
      const dailyVal = (p.netRevenue || 0) / days;
      const churnProb = (p.churnScore || 0) / 100;
      return Math.round(dailyVal * 365 * (1 - churnProb * 0.5));
    }

    function calculateOptimalBonus(p) {
      const ltv = p.ltv || 0;
      const churnProb = (p.churnScore || 0) / 100;
      return Math.min(Math.round(ltv * churnProb * 0.15), 500);
    }

    function findSimilarPlayers(target, n = 5) {
      if (!target || App.processedPlayers.length < 2) return [];
      return App.processedPlayers
        .filter(p => p.id !== target.id)
        .map(p => {
          const revDiff = Math.abs((p.netRevenue - target.netRevenue) / (Math.max(Math.abs(target.netRevenue), 1)));
          const wrDiff = Math.abs(p.winRate - target.winRate) / 100;
          const prefMatch = p.preference === target.preference ? 0 : 0.2;
          const dist = Math.sqrt(revDiff**2 + wrDiff**2) + prefMatch;
          return { player: p, similarity: 1 / (1 + dist) };
        })
        .sort((a, b) => b.similarity - a.similarity)
        .slice(0, n);
    }

    // ============================================================
    // STATISTICS (Single-Pass)
    // ============================================================
    function calculateAllStats(players) {
      const s = { total: 0, profitable: 0, profitAmount: 0, negativeGGR: 0, negativeGGRAmount: 0, deposits: 0, withdrawals: 0, netRevenue: 0,
        prefSports: 0, prefCasino: 0, prefMixed: 0, segVip: 0, segHigh: 0, segMedium: 0, segLow: 0,
        churnLow: 0, churnMedium: 0, churnHigh: 0, churnCritical: 0, churnCriticalValue: 0, churnHighValue: 0,
        styleHighroller: 0, styleRegular: 0, styleCasual: 0,
        lifeNew: 0, lifeGrowing: 0, lifeMature: 0, lifeDeclining: 0, lifeDormant: 0, lifeChurned: 0,
        withdrawing: 0, virtual: 0, highWinRate: 0, wr0to25: 0, wr25to40: 0, wr40to50: 0, wr50plus: 0,
        totalLTV: 0, ltvLow: 0, ltvMed: 0, ltvHigh: 0, ltvVip: 0 };
      
      for (const p of players) {
        s.total++;
        s.deposits += parseFloat(p.total_deposit_amount) || 0;
        s.withdrawals += parseFloat(p.total_withdraw_amount) || 0;
        s.netRevenue += p.netRevenue || 0;
        s.totalLTV += p.ltv || 0;
        
        if (p.isProfitable) { s.profitable++; s.profitAmount += p.companyProfit || 0; }
        if (p.isNegativeGGR) { s.negativeGGR++; s.negativeGGRAmount += Math.abs(p.companyProfit || 0); }
        
        if (p.preference === 'sports') s.prefSports++; else if (p.preference === 'casino') s.prefCasino++; else s.prefMixed++;
        if (p.valueSegment === 'vip') s.segVip++; else if (p.valueSegment === 'high') s.segHigh++; else if (p.valueSegment === 'medium') s.segMedium++; else s.segLow++;
        
        if (p.churnRisk === 'low') s.churnLow++; 
        else if (p.churnRisk === 'medium') s.churnMedium++; 
        else if (p.churnRisk === 'high') { s.churnHigh++; s.churnHighValue += p.netRevenue || 0; }
        else { s.churnCritical++; s.churnCriticalValue += p.netRevenue || 0; }
        
        if (p.bettingStyle === 'highroller') s.styleHighroller++; else if (p.bettingStyle === 'regular') s.styleRegular++; else s.styleCasual++;
        if (p.lifecycle === 'new') s.lifeNew++; else if (p.lifecycle === 'growing') s.lifeGrowing++; else if (p.lifecycle === 'mature') s.lifeMature++;
        else if (p.lifecycle === 'declining') s.lifeDeclining++; else if (p.lifecycle === 'dormant') s.lifeDormant++; else s.lifeChurned++;
        
        if ((parseFloat(p.total_withdraw_amount)||0) > (parseFloat(p.total_deposit_amount)||0)) s.withdrawing++;
        if (p.phoneType === 'virtual') s.virtual++;
        if (p.winRate > 60) s.highWinRate++;
        
        if (p.winRate < 25) s.wr0to25++; else if (p.winRate < 40) s.wr25to40++; else if (p.winRate < 50) s.wr40to50++; else s.wr50plus++;
        
        const ltv = p.ltv || 0;
        if (ltv >= 50000) s.ltvVip++; else if (ltv >= 10000) s.ltvHigh++; else if (ltv >= 1000) s.ltvMed++; else s.ltvLow++;
      }
      return s;
    }

    function getStats() {
      const now = Date.now();
      if (App.statsCache && (now - App.statsCacheTime) < 5000) return App.statsCache;
      App.statsCache = calculateAllStats(App.processedPlayers);
      App.statsCacheTime = now;
      return App.statsCache;
    }

    // ============================================================
    // PLAYER PROCESSING
    // ============================================================
    function processPlayer(raw) {
      const p = { ...raw };
      const sportBet = parseFloat(p.sport_bet_amount) || 0, sportWin = parseFloat(p.sport_win_amount) || 0;
      const casinoBet = parseFloat(p.casino_bet_amount) || 0, casinoWin = parseFloat(p.casino_win_amount) || 0;
      const sportBetCount = parseInt(p.sport_bet_count) || 0, sportWinCount = parseInt(p.sport_win_count) || 0;
      const casinoBetCount = parseInt(p.casino_bet_count) || 0, casinoWinCount = parseInt(p.casino_win_count) || 0;
      
      p.totalBet = sportBet + casinoBet;
      p.totalWin = sportWin + casinoWin;
      p.totalBetCount = sportBetCount + casinoBetCount;
      p.totalWinCount = sportWinCount + casinoWinCount;
      p.netRevenue = Math.round(p.totalBet - p.totalWin);
      p.companyProfit = p.netRevenue;
      p.winRate = p.totalBetCount > 0 ? (p.totalWinCount / p.totalBetCount * 100) : 0;
      p.isProfitable = p.netRevenue > 0;
      p.isNegativeGGR = p.netRevenue < 0;
      
      const phone = String(p.phone_number || '').toLowerCase();
      p.phoneType = (phone.includes('virtual') || phone.startsWith('v')) ? 'virtual' : 'real';
      
      const sportPct = p.totalBet > 0 ? sportBet / p.totalBet : 0;
      const casinoPct = p.totalBet > 0 ? casinoBet / p.totalBet : 0;
      p.preference = sportPct > 0.7 ? 'sports' : casinoPct > 0.7 ? 'casino' : 'mixed';
      
      const absRev = Math.abs(p.netRevenue);
      p.valueSegment = absRev >= App.params.vipMin ? 'vip' : absRev >= App.params.highMin ? 'high' : absRev >= App.params.mediumMin ? 'medium' : 'low';
      
      const regDate = p.registration_date ? new Date(p.registration_date) : new Date();
      const now = new Date();
      p.daysSinceRegistration = Math.floor((now - regDate) / 86400000);
      p.daysSinceActivity = p.last_activity ? Math.floor((now - new Date(p.last_activity)) / 86400000) : p.daysSinceRegistration;
      
      const avgBet = p.totalBetCount > 0 ? p.totalBet / p.totalBetCount : 0;
      p.avgBetSize = avgBet;
      p.bettingStyle = avgBet >= App.params.highRollerMin ? 'highroller' : avgBet >= App.params.casualMax ? 'regular' : 'casual';
      
      p.lifecycle = p.daysSinceRegistration < App.params.newPlayerDays ? 'new' :
                    p.daysSinceActivity > 60 ? 'churned' : p.daysSinceActivity > 30 ? 'dormant' :
                    p.daysSinceActivity > 14 ? 'declining' : p.totalBetCount > 50 ? 'mature' : 'growing';
      
      const churn = calculateChurnScore(p);
      p.churnScore = churn.score;
      p.churnRisk = churn.risk;
      p.churnFactors = churn.factors;
      
      p.ltv = calculateLTV(p);
      p.optimalBonus = calculateOptimalBonus(p);
      p.isWithdrawing = (parseFloat(p.total_withdraw_amount) || 0) > (parseFloat(p.total_deposit_amount) || 0);
      
      return p;
    }

    // ============================================================
    // DATA LOADING - FIXED: Using 'customers' table, with persistence
    // ============================================================
    async function loadPlayers(forceReload = false) {
      // Prevent reloading if data already exists (unless forced)
      if (!forceReload && App.dataLoaded && App.processedPlayers.length > 0) {
        console.log('Data already loaded, skipping reload');
        return;
      }
      
      // Prevent concurrent loads
      if (App.isLoading) {
        console.log('Load already in progress');
        return;
      }
      
      App.isLoading = true;
      showLoading(true, App.currentLang === 'ru' ? 'Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²...' : 'Loading players...');
      
      try {
        // FIXED: Changed from 'players' to 'customers'
        const { data, error } = await App.db.from('customers').select('*');
        if (error) throw error;
        
        App.players = data || [];
        App.processedPlayers = App.players.map(processPlayer);
        App.statsCache = null;
        App.filteredPlayers = [...App.processedPlayers];
        App.dataLoaded = true; // Mark data as loaded
        
        updateAllStats();
        updateAllCharts();
        renderTable();
        runProactiveAnalysis();
        
        showNotification(App.currentLang === 'ru' ? `Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ ${App.processedPlayers.length} Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²` : `Loaded ${App.processedPlayers.length} players`, 'success');
      } catch (err) {
        showNotification((App.currentLang === 'ru' ? 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸: ' : 'Load failed: ') + err.message, 'error');
      } finally {
        App.isLoading = false;
        showLoading(false);
      }
    }

    // ============================================================
    // UI UPDATES & CHARTS
    // ============================================================
    function updateAllStats() {
      const s = getStats();
      setText('metric-total', s.total.toLocaleString());
      setText('metric-profitable', s.profitable.toLocaleString());
      setText('metric-negative-ggr', s.negativeGGR.toLocaleString());
      setText('metric-atrisk', (s.churnHigh + s.churnCritical).toLocaleString());
      setText('metric-profit-amount', formatK(s.profitAmount));
      setText('metric-negative-amount', formatK(s.negativeGGRAmount));
      setText('metric-atrisk-value', formatK(s.churnCriticalValue + s.churnHighValue) + ' at risk');
      
      setText('fin-deposits', formatK(s.deposits));
      setText('fin-withdrawals', formatK(s.withdrawals));
      setText('fin-net', formatK(s.netRevenue));
      
      setText('seg-vip', s.segVip); setText('seg-high', s.segHigh); setText('seg-medium', s.segMedium); setText('seg-low', s.segLow);
      setText('pref-sports', s.prefSports); setText('pref-casino', s.prefCasino); setText('pref-mixed', s.prefMixed);
      setText('churn-low', s.churnLow); setText('churn-medium', s.churnMedium); setText('churn-high', s.churnHigh); setText('churn-critical', s.churnCritical);
      setText('churn-d-low', s.churnLow); setText('churn-d-medium', s.churnMedium); setText('churn-d-high', s.churnHigh); setText('churn-d-critical', s.churnCritical);
      setText('churn-critical-value', formatK(s.churnCriticalValue)); setText('churn-high-value', formatK(s.churnHighValue));
      
      setText('profit-count', s.profitable); setText('profit-amount', formatK(s.profitAmount));
      setText('negative-ggr-count', s.negativeGGR); setText('negative-ggr-amount', formatK(s.negativeGGRAmount));
      setText('wr-0-25', s.wr0to25); setText('wr-25-40', s.wr25to40); setText('wr-40-50', s.wr40to50); setText('wr-50-plus', s.wr50plus);
      
      setText('style-highroller', s.styleHighroller); setText('style-regular', s.styleRegular); setText('style-casual', s.styleCasual);
      setText('life-new', s.lifeNew); setText('life-growing', s.lifeGrowing); setText('life-mature', s.lifeMature);
      setText('life-declining', s.lifeDeclining); setText('life-dormant', s.lifeDormant); setText('life-churned', s.lifeChurned);
      setText('alert-withdrawing', s.withdrawing); setText('alert-virtual', s.virtual); setText('alert-highwin', s.highWinRate);
      
      lucide.createIcons();
    }

    function createChart(id, type, labels, data, colors, label = '') {
      const ctx = document.getElementById(id);
      if (!ctx) return;
      if (App.charts[id]) App.charts[id].destroy();
      App.charts[id] = new Chart(ctx, {
        type, data: { labels, datasets: [{ label, data, backgroundColor: colors, borderColor: type === 'line' ? colors[0] : '#fff', borderWidth: type === 'doughnut' ? 2 : 0, borderRadius: type === 'bar' ? 6 : 0 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: type === 'doughnut', position: 'bottom' } }, scales: type === 'bar' ? { y: { beginAtZero: true } } : {} }
      });
    }

    function updateAllCharts() {
      if (!App.processedPlayers.length) return;
      const s = getStats();
      const profitLabel = App.currentLang === 'ru' ? 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ' : 'Profitable';
      const negLabel = App.currentLang === 'ru' ? 'Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ' : 'Negative';
      createChart('dashProfitChart', 'doughnut', [profitLabel, negLabel], [s.profitable, s.negativeGGR], ['#10B981', '#EF4444']);
      createChart('dashChurnChart', 'doughnut', [App.currentLang === 'ru' ? 'ÐÐ¸Ð·ÐºÐ¸Ð¹' : 'Low', App.currentLang === 'ru' ? 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹' : 'Medium', App.currentLang === 'ru' ? 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹' : 'High', App.currentLang === 'ru' ? 'ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹' : 'Critical'], [s.churnLow, s.churnMedium, s.churnHigh, s.churnCritical], ['#10B981', '#F59E0B', '#F97316', '#EF4444']);
      createChart('profitDistChart', 'doughnut', [profitLabel, negLabel], [s.profitable, s.negativeGGR], ['#10B981', '#EF4444']);
      createChart('winRateDistChart', 'bar', ['0-25%', '25-40%', '40-50%', '50%+'], [s.wr0to25, s.wr25to40, s.wr40to50, s.wr50plus], ['#10B981', '#14B8A6', '#F59E0B', '#EF4444']);
      createChart('bettingStyleChart', 'doughnut', [App.currentLang === 'ru' ? 'Ð¥Ð°Ð¹Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹' : 'High Roller', App.currentLang === 'ru' ? 'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ' : 'Regular', App.currentLang === 'ru' ? 'ÐšÐ°Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ' : 'Casual'], [s.styleHighroller, s.styleRegular, s.styleCasual], ['#F59E0B', '#3B82F6', '#64748B']);
      createChart('lifecycleChart', 'bar', [App.currentLang === 'ru' ? 'ÐÐ¾Ð²Ñ‹Ðµ' : 'New', App.currentLang === 'ru' ? 'Ð Ð°ÑÑ‚ÑƒÑ‰Ð¸Ðµ' : 'Growing', App.currentLang === 'ru' ? 'Ð—Ñ€ÐµÐ»Ñ‹Ðµ' : 'Mature', App.currentLang === 'ru' ? 'Ð¡Ð½Ð¸Ð¶Ð°ÑŽÑ‰Ð¸ÐµÑÑ' : 'Declining', App.currentLang === 'ru' ? 'Ð¡Ð¿ÑÑ‰Ð¸Ðµ' : 'Dormant', App.currentLang === 'ru' ? 'Ð£ÑˆÐµÐ´ÑˆÐ¸Ðµ' : 'Churned'], [s.lifeNew, s.lifeGrowing, s.lifeMature, s.lifeDeclining, s.lifeDormant, s.lifeChurned], ['#06B6D4', '#10B981', '#A855F7', '#F59E0B', '#F97316', '#EF4444']);
      createChart('churnDistChart', 'doughnut', [App.currentLang === 'ru' ? 'ÐÐ¸Ð·ÐºÐ¸Ð¹' : 'Low', App.currentLang === 'ru' ? 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹' : 'Medium', App.currentLang === 'ru' ? 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹' : 'High', App.currentLang === 'ru' ? 'ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹' : 'Critical'], [s.churnLow, s.churnMedium, s.churnHigh, s.churnCritical], ['#10B981', '#F59E0B', '#F97316', '#EF4444']);
      
      const buckets = [0,0,0,0,0];
      App.processedPlayers.forEach(p => { const sc = p.churnScore||0; if(sc<20)buckets[0]++;else if(sc<40)buckets[1]++;else if(sc<60)buckets[2]++;else if(sc<80)buckets[3]++;else buckets[4]++; });
      createChart('churnScoreChart', 'bar', ['0-20', '20-40', '40-60', '60-80', '80-100'], buckets, ['#10B981', '#84CC16', '#F59E0B', '#F97316', '#EF4444']);
      
      createChart('ltvDistChart', 'bar', ['<K1k', 'K1k-10k', 'K10k-50k', 'K50k+'], [s.ltvLow, s.ltvMed, s.ltvHigh, s.ltvVip], ['#94A3B8', '#3B82F6', '#8B5CF6', '#F59E0B']);
      
      updateComparison();
      
      // Initialize data comparison with default preset
      setTimeout(() => {
        if (App.processedPlayers.length > 0) {
          runComparison();
        }
      }, 100);
      
      // Update Call Center queue
      CallCenter.renderQueue();
    }

    function updateComparison() {
      const seg1 = document.getElementById('compare1')?.value || 'vip';
      const seg2 = document.getElementById('compare2')?.value || 'high';
      const p1 = App.processedPlayers.filter(p => p.valueSegment === seg1);
      const p2 = App.processedPlayers.filter(p => p.valueSegment === seg2);
      const calc = ps => ({ count: ps.length, avgRev: ps.length ? Math.round(ps.reduce((a,p)=>a+p.netRevenue,0)/ps.length) : 0, avgChurn: ps.length ? Math.round(ps.reduce((a,p)=>a+p.churnScore,0)/ps.length) : 0, avgLTV: ps.length ? Math.round(ps.reduce((a,p)=>a+(p.ltv||0),0)/ps.length) : 0 });
      const m1 = calc(p1), m2 = calc(p2);
      document.getElementById('comparisonResult').innerHTML = `
        <div class="p-3 bg-purple-50 rounded-lg"><h4 class="font-bold text-purple-700">${seg1.toUpperCase()}</h4><p>${App.currentLang === 'ru' ? 'ÐšÐ¾Ð»-Ð²Ð¾' : 'Count'}: ${m1.count}</p><p>${App.currentLang === 'ru' ? 'Ð¡Ñ€. Ð´Ð¾Ñ…Ð¾Ð´' : 'Avg Rev'}: ${formatK(m1.avgRev)}</p><p>${App.currentLang === 'ru' ? 'Ð¡Ñ€. Ð¾Ñ‚Ñ‚Ð¾Ðº' : 'Avg Churn'}: ${m1.avgChurn}</p><p>LTV: ${formatK(m1.avgLTV)}</p></div>
        <div class="p-3 bg-blue-50 rounded-lg"><h4 class="font-bold text-blue-700">${seg2.toUpperCase()}</h4><p>${App.currentLang === 'ru' ? 'ÐšÐ¾Ð»-Ð²Ð¾' : 'Count'}: ${m2.count}</p><p>${App.currentLang === 'ru' ? 'Ð¡Ñ€. Ð´Ð¾Ñ…Ð¾Ð´' : 'Avg Rev'}: ${formatK(m2.avgRev)}</p><p>${App.currentLang === 'ru' ? 'Ð¡Ñ€. Ð¾Ñ‚Ñ‚Ð¾Ðº' : 'Avg Churn'}: ${m2.avgChurn}</p><p>LTV: ${formatK(m2.avgLTV)}</p></div>`;
    }

    // ============================================================
    // DATA COMPARISON FEATURE
    // ============================================================
    function applyComparisonPreset() {
      const preset = document.getElementById('comparisonPreset').value;
      const customRange = document.getElementById('customDateRange');
      
      if (preset === 'custom') {
        customRange.classList.remove('hidden');
        // Set default dates for custom range
        const today = new Date();
        const p1End = today.toISOString().split('T')[0];
        const p1Start = new Date(today - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        const p2End = new Date(today - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        const p2Start = new Date(today - 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        
        document.getElementById('period1Start').value = p1Start;
        document.getElementById('period1End').value = p1End;
        document.getElementById('period2Start').value = p2Start;
        document.getElementById('period2End').value = p2End;
      } else {
        customRange.classList.add('hidden');
      }
    }

    function getComparisonPeriods() {
      const preset = document.getElementById('comparisonPreset').value;
      const today = new Date();
      today.setHours(23, 59, 59, 999);
      
      let period1Start, period1End, period2Start, period2End;
      const isRu = App.currentLang === 'ru';
      
      if (preset === 'custom') {
        period1Start = new Date(document.getElementById('period1Start').value);
        period1End = new Date(document.getElementById('period1End').value);
        period2Start = new Date(document.getElementById('period2Start').value);
        period2End = new Date(document.getElementById('period2End').value);
        period1End.setHours(23, 59, 59, 999);
        period2End.setHours(23, 59, 59, 999);
      } else {
        const days = parseInt(preset);
        period1End = new Date(today);
        period1Start = new Date(today - days * 24 * 60 * 60 * 1000);
        period2End = new Date(period1Start - 1);
        period2Start = new Date(period2End - days * 24 * 60 * 60 * 1000);
      }
      
      // Format labels
      const formatDate = d => d.toLocaleDateString(isRu ? 'ru-RU' : 'en-US', { month: 'short', day: 'numeric' });
      const p1Label = `${formatDate(period1Start)} - ${formatDate(period1End)}`;
      const p2Label = `${formatDate(period2Start)} - ${formatDate(period2End)}`;
      
      return { period1Start, period1End, period2Start, period2End, p1Label, p2Label };
    }

    function calculatePeriodStats(players, startDate, endDate) {
      // Filter players registered within the period
      const periodPlayers = players.filter(p => {
        if (!p.registration_date) return false;
        const regDate = new Date(p.registration_date);
        return regDate >= startDate && regDate <= endDate;
      });
      
      // Calculate stats for players in this period
      const stats = {
        newPlayers: periodPlayers.length,
        deposits: 0,
        withdrawals: 0,
        ggr: 0,
        avgDeposit: 0,
        avgWinRate: 0,
        vipCount: 0,
        highCount: 0,
        mediumCount: 0,
        lowCount: 0,
        atRiskCount: 0,
        profitableCount: 0,
        negativeGgrCount: 0,
        sportsCount: 0,
        casinoCount: 0,
        mixedCount: 0,
        totalBets: 0,
        totalWins: 0
      };
      
      let winRateSum = 0;
      
      periodPlayers.forEach(p => {
        stats.deposits += parseFloat(p.total_deposit_amount) || 0;
        stats.withdrawals += parseFloat(p.total_withdraw_amount) || 0;
        stats.ggr += p.netRevenue || 0;
        stats.totalBets += p.totalBet || 0;
        stats.totalWins += p.totalWin || 0;
        winRateSum += p.winRate || 0;
        
        if (p.valueSegment === 'vip') stats.vipCount++;
        else if (p.valueSegment === 'high') stats.highCount++;
        else if (p.valueSegment === 'medium') stats.mediumCount++;
        else stats.lowCount++;
        
        if (p.churnRisk === 'high' || p.churnRisk === 'critical') stats.atRiskCount++;
        if (p.isProfitable) stats.profitableCount++;
        if (p.isNegativeGGR) stats.negativeGgrCount++;
        
        if (p.preference === 'sports') stats.sportsCount++;
        else if (p.preference === 'casino') stats.casinoCount++;
        else stats.mixedCount++;
      });
      
      stats.avgDeposit = periodPlayers.length > 0 ? Math.round(stats.deposits / periodPlayers.length) : 0;
      stats.avgWinRate = periodPlayers.length > 0 ? (winRateSum / periodPlayers.length).toFixed(1) : 0;
      
      return stats;
    }

    function calculateChange(current, previous) {
      if (previous === 0) return current > 0 ? 100 : 0;
      return ((current - previous) / Math.abs(previous) * 100).toFixed(1);
    }

    function renderChangeIndicator(change, invertColors = false) {
      const num = parseFloat(change);
      let color, icon;
      
      if (num > 0) {
        color = invertColors ? 'text-red-500' : 'text-emerald-500';
        icon = 'â†‘';
      } else if (num < 0) {
        color = invertColors ? 'text-emerald-500' : 'text-red-500';
        icon = 'â†“';
      } else {
        color = 'text-slate-400';
        icon = 'â†’';
      }
      
      return `<span class="${color} flex items-center gap-1">${icon} ${Math.abs(num)}%</span>`;
    }

    function runComparison() {
      if (!App.processedPlayers.length) {
        showNotification(App.currentLang === 'ru' ? 'ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ' : 'No data to compare', 'error');
        return;
      }
      
      const periods = getComparisonPeriods();
      const { period1Start, period1End, period2Start, period2End, p1Label, p2Label } = periods;
      
      // Update period labels
      document.getElementById('period1Label').textContent = p1Label;
      document.getElementById('period2Label').textContent = p2Label;
      document.getElementById('tableP1Header').textContent = p1Label;
      document.getElementById('tableP2Header').textContent = p2Label;
      
      // Calculate stats for both periods
      const stats1 = calculatePeriodStats(App.processedPlayers, period1Start, period1End);
      const stats2 = calculatePeriodStats(App.processedPlayers, period2Start, period2End);
      
      // Update comparison cards
      updateComparisonCard('newPlayers', stats1.newPlayers, stats2.newPlayers);
      updateComparisonCard('deposits', stats1.deposits, stats2.deposits, true);
      updateComparisonCard('withdrawals', stats1.withdrawals, stats2.withdrawals, true, true);
      updateComparisonCard('ggr', stats1.ggr, stats2.ggr, true);
      updateComparisonCard('avgDeposit', stats1.avgDeposit, stats2.avgDeposit, true);
      updateComparisonCard('avgWinRate', stats1.avgWinRate, stats2.avgWinRate, false, true, true);
      updateComparisonCard('vip', stats1.vipCount, stats2.vipCount);
      updateComparisonCard('atRisk', stats1.atRiskCount, stats2.atRiskCount, false, true);
      
      // Update comparison charts
      updateComparisonCharts(stats1, stats2, p1Label, p2Label);
      
      // Update detailed breakdown table
      updateComparisonTable(stats1, stats2);
      
      lucide.createIcons();
      showNotification(App.currentLang === 'ru' ? 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾' : 'Comparison complete', 'success');
    }

    function updateComparisonCard(metric, val1, val2, isK = false, invertColors = false, isPercent = false) {
      const change = calculateChange(val1, val2);
      const format = v => isK ? formatK(v) : (isPercent ? v + '%' : v);
      
      setText(`comp-${metric}-p1`, format(val1));
      setText(`comp-${metric}-p2`, 'vs ' + format(val2));
      document.getElementById(`comp-${metric}-change`).innerHTML = renderChangeIndicator(change, invertColors);
    }

    function updateComparisonCharts(stats1, stats2, label1, label2) {
      const isRu = App.currentLang === 'ru';
      
      // Revenue comparison bar chart
      const revenueCtx = document.getElementById('comparisonRevenueChart');
      if (App.charts['comparisonRevenueChart']) App.charts['comparisonRevenueChart'].destroy();
      App.charts['comparisonRevenueChart'] = new Chart(revenueCtx, {
        type: 'bar',
        data: {
          labels: [isRu ? 'Ð”ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹' : 'Deposits', isRu ? 'Ð’Ñ‹Ð²Ð¾Ð´Ñ‹' : 'Withdrawals', 'GGR'],
          datasets: [
            { label: label1, data: [stats1.deposits, stats1.withdrawals, stats1.ggr], backgroundColor: '#6366F1', borderRadius: 6 },
            { label: label2, data: [stats2.deposits, stats2.withdrawals, stats2.ggr], backgroundColor: '#CBD5E1', borderRadius: 6 }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
      
      // Segment comparison chart
      const segmentCtx = document.getElementById('comparisonSegmentChart');
      if (App.charts['comparisonSegmentChart']) App.charts['comparisonSegmentChart'].destroy();
      App.charts['comparisonSegmentChart'] = new Chart(segmentCtx, {
        type: 'bar',
        data: {
          labels: ['VIP', isRu ? 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹' : 'High', isRu ? 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹' : 'Medium', isRu ? 'ÐÐ¸Ð·ÐºÐ¸Ð¹' : 'Low'],
          datasets: [
            { label: label1, data: [stats1.vipCount, stats1.highCount, stats1.mediumCount, stats1.lowCount], backgroundColor: '#6366F1', borderRadius: 6 },
            { label: label2, data: [stats2.vipCount, stats2.highCount, stats2.mediumCount, stats2.lowCount], backgroundColor: '#CBD5E1', borderRadius: 6 }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
    }

    function updateComparisonTable(stats1, stats2) {
      const isRu = App.currentLang === 'ru';
      const rows = [
        { label: isRu ? 'ÐÐ¾Ð²Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸' : 'New Players', v1: stats1.newPlayers, v2: stats2.newPlayers },
        { label: isRu ? 'Ð’ÑÐµÐ³Ð¾ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ð²' : 'Total Deposits', v1: stats1.deposits, v2: stats2.deposits, isK: true },
        { label: isRu ? 'Ð’ÑÐµÐ³Ð¾ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð²' : 'Total Withdrawals', v1: stats1.withdrawals, v2: stats2.withdrawals, isK: true, invert: true },
        { label: isRu ? 'Ð§Ð¸ÑÑ‚Ñ‹Ð¹ GGR' : 'Net GGR', v1: stats1.ggr, v2: stats2.ggr, isK: true },
        { label: isRu ? 'Ð¡Ñ€. Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚' : 'Avg Deposit', v1: stats1.avgDeposit, v2: stats2.avgDeposit, isK: true },
        { label: isRu ? 'Ð¡Ñ€. Ð²Ð¸Ð½Ñ€ÐµÐ¹Ñ‚' : 'Avg Win Rate', v1: stats1.avgWinRate, v2: stats2.avgWinRate, suffix: '%', invert: true },
        { label: isRu ? 'VIP Ð¸Ð³Ñ€Ð¾ÐºÐ¸' : 'VIP Players', v1: stats1.vipCount, v2: stats2.vipCount },
        { label: isRu ? 'Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ' : 'High Value', v1: stats1.highCount, v2: stats2.highCount },
        { label: isRu ? 'Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ' : 'Medium Value', v1: stats1.mediumCount, v2: stats2.mediumCount },
        { label: isRu ? 'ÐÐ¸Ð·ÐºÐ°Ñ Ñ†ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ' : 'Low Value', v1: stats1.lowCount, v2: stats2.lowCount },
        { label: isRu ? 'Ð’ Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ°' : 'At Risk', v1: stats1.atRiskCount, v2: stats2.atRiskCount, invert: true },
        { label: isRu ? 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ðµ' : 'Profitable', v1: stats1.profitableCount, v2: stats2.profitableCount },
        { label: isRu ? 'Ð£Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ' : 'Negative GGR', v1: stats1.negativeGgrCount, v2: stats2.negativeGgrCount, invert: true },
        { label: isRu ? 'Ð¡Ñ‚Ð°Ð²ÐºÐ¸ Ð½Ð° ÑÐ¿Ð¾Ñ€Ñ‚' : 'Sports', v1: stats1.sportsCount, v2: stats2.sportsCount },
        { label: isRu ? 'ÐšÐ°Ð·Ð¸Ð½Ð¾' : 'Casino', v1: stats1.casinoCount, v2: stats2.casinoCount },
        { label: isRu ? 'Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ðµ' : 'Mixed', v1: stats1.mixedCount, v2: stats2.mixedCount }
      ];
      
      const tbody = document.getElementById('comparisonTableBody');
      tbody.innerHTML = rows.map(row => {
        const change = calculateChange(row.v1, row.v2);
        const format = v => row.isK ? formatK(v) : (v + (row.suffix || ''));
        const changeHtml = renderChangeIndicator(change, row.invert);
        const diff = row.v1 - row.v2;
        const diffStr = diff >= 0 ? '+' + (row.isK ? formatK(diff) : diff + (row.suffix || '')) : (row.isK ? formatK(diff) : diff + (row.suffix || ''));
        
        return `<tr class="border-b border-slate-100 hover:bg-slate-50">
          <td class="px-4 py-3 font-medium text-slate-700">${row.label}</td>
          <td class="px-4 py-3 text-right font-semibold text-indigo-600">${format(row.v1)}</td>
          <td class="px-4 py-3 text-right text-slate-600">${format(row.v2)}</td>
          <td class="px-4 py-3 text-right text-slate-500">${diffStr}</td>
          <td class="px-4 py-3 text-center">${changeHtml}</td>
        </tr>`;
      }).join('');
    }

    // ============================================================
    // TABLE RENDERING & FILTERING
    // ============================================================
    function renderTable() {
      const data = App.filteredPlayers;
      data.sort((a, b) => { let va = a[App.sortField], vb = b[App.sortField]; return App.sortDirection === 'asc' ? (va > vb ? 1 : -1) : (va < vb ? 1 : -1); });
      
      const totalPages = Math.ceil(data.length / App.pageSize);
      const start = (App.currentPage - 1) * App.pageSize;
      const pageData = data.slice(start, start + App.pageSize);
      const tbody = document.getElementById('tableBody');
      const cols = App.visibleColumns;
      
      if (!pageData.length) { 
        tbody.innerHTML = `<tr><td colspan="10" class="px-4 py-12 text-center text-slate-500">${App.currentLang === 'ru' ? 'ÐÐµÑ‚ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²' : 'No players'}</td></tr>`; 
        setText('tableCount', '(0)'); 
        updateBulkToolbar();
        return; 
      }
      
      tbody.innerHTML = pageData.map(p => {
        const churnC = { low: 'emerald', medium: 'yellow', high: 'orange', critical: 'red' }[p.churnRisk];
        const prefC = { sports: 'green', casino: 'purple', mixed: 'blue' }[p.preference];
        const valueC = { vip: 'purple', high: 'blue', medium: 'teal', low: 'slate' }[p.valueSegment];
        const idStr = String(p.id);
        const isSelected = App.selectedPlayers.has(idStr);
        const isWatched = App.watchlist.has(idStr);
        
        return `<tr class="${isWatched ? 'watched' : ''} hover:bg-yellow-50 border-b border-slate-100" data-id="${p.id}">
          <td class="px-3 py-3">
            <input type="checkbox" class="bulk-checkbox row-checkbox" ${isSelected ? 'checked' : ''} onchange="togglePlayerSelection('${p.id}')" onclick="event.stopPropagation()">
          </td>
          ${cols.id ? `<td class="px-3 py-3 col-id cursor-pointer" onclick="viewPlayer('${p.id}')"><p class="font-medium text-sm">${p.id}</p><p class="text-xs text-slate-500">${p.phone_number || '-'}</p></td>` : ''}
          ${cols.type ? `<td class="px-3 py-3 col-type"><span class="text-xs px-2 py-1 rounded-full ${p.phoneType === 'virtual' ? 'bg-red-100 text-red-700' : 'bg-slate-100'}">${p.phoneType}</span></td>` : ''}
          ${cols.pref ? `<td class="px-3 py-3 col-pref"><span class="text-xs px-2 py-1 rounded-full bg-${prefC}-100 text-${prefC}-700">${p.preference}</span></td>` : ''}
          ${cols.revenue ? `<td class="px-3 py-3 col-revenue"><span class="font-medium ${p.netRevenue >= 0 ? 'text-emerald-600' : 'text-red-600'}">${formatK(p.netRevenue)}</span></td>` : ''}
          ${cols.winrate ? `<td class="px-3 py-3 col-winrate">${formatPct(p.winRate)}</td>` : ''}
          ${cols.value ? `<td class="px-3 py-3 col-value"><span class="text-xs px-2 py-1 rounded-full bg-${valueC}-100 text-${valueC}-700">${p.valueSegment.toUpperCase()}</span></td>` : ''}
          ${cols.churn ? `<td class="px-3 py-3 col-churn"><span class="text-xs px-2 py-1 rounded-full bg-${churnC}-100 text-${churnC}-700">${p.churnRisk}</span><span class="text-xs text-slate-400 ml-1">${p.churnScore}</span></td>` : ''}
          ${cols.ltv ? `<td class="px-3 py-3 col-ltv text-sm">${formatK(p.ltv)}</td>` : ''}
          <td class="px-3 py-3">
            <div class="quick-actions">
              <button onclick="event.stopPropagation();viewPlayer('${p.id}')" class="quick-action view" title="View"><i data-lucide="eye" class="h-3 w-3"></i></button>
              <button onclick="event.stopPropagation();toggleWatchlist('${p.id}')" class="quick-action star ${isWatched ? 'active' : ''}" title="Watchlist"><i data-lucide="star" class="h-3 w-3"></i></button>
            </div>
          </td>
        </tr>`;
      }).join('');
      
      setText('tableCount', `(${data.length.toLocaleString()})`);
      setText('tableFooter', `${start+1}-${Math.min(start+App.pageSize,data.length)} of ${data.length}`);
      setText('pageInfo', `Page ${App.currentPage}/${totalPages}`);
      document.getElementById('prevPage').disabled = App.currentPage <= 1;
      document.getElementById('nextPage').disabled = App.currentPage >= totalPages;
      
      // Update select all checkbox state
      const selectAllCheckbox = document.getElementById('selectAllCheckbox');
      if (selectAllCheckbox) {
        const pageIds = pageData.map(p => String(p.id));
        const allPageSelected = pageIds.length > 0 && pageIds.every(id => App.selectedPlayers.has(id));
        selectAllCheckbox.checked = allPageSelected;
      }
      
      updateBulkToolbar();
      lucide.createIcons();
    }

    const filterTable = debounce(() => {
      // Work with existing data, don't reload
      if (!App.processedPlayers.length) return;
      
      const search = (document.getElementById('searchInput')?.value || '').toLowerCase();
      const profit = document.getElementById('profitFilter')?.value || '';
      const pref = document.getElementById('prefFilter')?.value || '';
      const churn = document.getElementById('churnFilter')?.value || '';
      const value = document.getElementById('valueFilter')?.value || '';
      
      App.filteredPlayers = App.processedPlayers.filter(p => {
        if (search && !String(p.id).toLowerCase().includes(search) && !(p.phone_number||'').toLowerCase().includes(search)) return false;
        if (profit === 'profitable' && !p.isProfitable) return false;
        if (profit === 'negative' && !p.isNegativeGGR) return false;
        if (pref && p.preference !== pref) return false;
        if (churn && p.churnRisk !== churn) return false;
        if (value && p.valueSegment !== value) return false;
        return true;
      });
      App.currentPage = 1;
      renderTable();
    }, 300);

    function sortTable(field) { App.sortField === field ? App.sortDirection = App.sortDirection === 'asc' ? 'desc' : 'asc' : (App.sortField = field, App.sortDirection = 'desc'); renderTable(); }
    function changePage(d) { const max = Math.ceil(App.filteredPlayers.length / App.pageSize); App.currentPage = Math.max(1, Math.min(max, App.currentPage + d)); renderTable(); }
    
    function clearAllFilters() {
      ['searchInput', 'profitFilter', 'prefFilter', 'churnFilter', 'valueFilter'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
      App.currentFilter = null; 
      setText('currentFilterName', App.currentLang === 'ru' ? 'Ð’ÑÐµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸' : 'All Players');
      // Reset to all players from cached data (no reload)
      App.filteredPlayers = [...App.processedPlayers]; 
      App.currentPage = 1; 
      renderTable();
    }

    // ============================================================
    // BULK SELECTION FUNCTIONS
    // ============================================================
    function togglePlayerSelection(id) {
      // Ensure consistent type (convert to string for comparison)
      const idStr = String(id);
      if (App.selectedPlayers.has(idStr)) {
        App.selectedPlayers.delete(idStr);
      } else {
        App.selectedPlayers.add(idStr);
      }
      updateBulkToolbar();
      renderTable();
    }

    function toggleSelectAll() {
      const start = (App.currentPage - 1) * App.pageSize;
      const pageData = App.filteredPlayers.slice(start, start + App.pageSize);
      const pageIds = pageData.map(p => String(p.id)); // Convert to strings
      const allSelected = pageIds.every(id => App.selectedPlayers.has(id));
      
      if (allSelected) {
        pageIds.forEach(id => App.selectedPlayers.delete(id));
      } else {
        pageIds.forEach(id => App.selectedPlayers.add(id));
      }
      updateBulkToolbar();
      renderTable();
    }

    function selectAllVisible() {
      App.filteredPlayers.forEach(p => App.selectedPlayers.add(String(p.id)));
      updateBulkToolbar();
      renderTable();
    }

    function clearSelection() {
      App.selectedPlayers.clear();
      updateBulkToolbar();
      renderTable();
    }

    function updateBulkToolbar() {
      const toolbar = document.getElementById('bulkToolbar');
      const count = App.selectedPlayers.size;
      setText('selectedCount', count);
      
      if (count > 0) {
        toolbar.classList.add('active');
      } else {
        toolbar.classList.remove('active');
      }
    }

    function bulkAddToWatchlist() {
      App.selectedPlayers.forEach(id => App.watchlist.add(String(id)));
      saveWatchlist();
      updateWatchlistPanel();
      clearSelection();
      showNotification(App.currentLang === 'ru' ? 'Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ' : 'Added to watchlist', 'success');
    }

    function bulkExport() {
      const selectedData = App.processedPlayers.filter(p => App.selectedPlayers.has(String(p.id)));
      if (!selectedData.length) return;
      exportPlayersToCSV(selectedData, 'selected_players');
      showNotification(App.currentLang === 'ru' ? `Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ ${selectedData.length} Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²` : `Exported ${selectedData.length} players`, 'success');
    }

    // ============================================================
    // WATCHLIST FUNCTIONS
    // ============================================================
    function toggleWatchlist(id) {
      const idStr = String(id);
      if (App.watchlist.has(idStr)) {
        App.watchlist.delete(idStr);
      } else {
        App.watchlist.add(idStr);
      }
      saveWatchlist();
      updateWatchlistPanel();
      renderTable();
    }

    function saveWatchlist() {
      localStorage.setItem('crmWatchlist', JSON.stringify([...App.watchlist]));
    }

    function loadWatchlist() {
      try {
        const saved = localStorage.getItem('crmWatchlist');
        if (saved) App.watchlist = new Set(JSON.parse(saved).map(String)); // Ensure strings
      } catch (e) { console.error('Error loading watchlist:', e); }
    }

    function updateWatchlistPanel() {
      const panel = document.getElementById('watchlistPanel');
      const count = document.getElementById('watchlistCount');
      count.textContent = App.watchlist.size;
      
      if (App.watchlist.size === 0) {
        panel.innerHTML = `<p class="text-xs text-slate-400 italic" data-translate="noWatchedPlayers">${App.currentLang === 'ru' ? 'ÐÐµÑ‚ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²' : 'No watched players'}</p>`;
        return;
      }
      
      const watchedPlayers = App.processedPlayers.filter(p => App.watchlist.has(String(p.id))).slice(0, 10);
      panel.innerHTML = watchedPlayers.map(p => `
        <div class="watch-item" onclick="viewPlayer('${p.id}')">
          <i data-lucide="star" class="h-3 w-3 star"></i>
          <span class="text-sm flex-1 truncate">${p.id}</span>
          <span class="text-xs ${p.netRevenue >= 0 ? 'text-emerald-600' : 'text-red-600'}">${formatK(p.netRevenue)}</span>
          <button onclick="event.stopPropagation();toggleWatchlist('${p.id}')" class="text-slate-400 hover:text-red-500">
            <i data-lucide="x" class="h-3 w-3"></i>
          </button>
        </div>
      `).join('');
      lucide.createIcons();
    }

    // ============================================================
    // RECENTLY VIEWED FUNCTIONS
    // ============================================================
    function addToRecentlyViewed(id) {
      const idStr = String(id);
      App.recentlyViewed = App.recentlyViewed.filter(rid => rid !== idStr);
      App.recentlyViewed.unshift(idStr);
      App.recentlyViewed = App.recentlyViewed.slice(0, 10);
      saveRecentlyViewed();
      updateRecentlyViewedPanel();
    }

    function saveRecentlyViewed() {
      localStorage.setItem('crmRecentlyViewed', JSON.stringify(App.recentlyViewed));
    }

    function loadRecentlyViewed() {
      try {
        const saved = localStorage.getItem('crmRecentlyViewed');
        if (saved) App.recentlyViewed = JSON.parse(saved).map(String); // Ensure strings
      } catch (e) { console.error('Error loading recently viewed:', e); }
    }

    function updateRecentlyViewedPanel() {
      const panel = document.getElementById('recentlyViewedPanel');
      
      if (App.recentlyViewed.length === 0) {
        panel.innerHTML = `<p class="text-xs text-slate-400 italic" data-translate="noRecentPlayers">${App.currentLang === 'ru' ? 'ÐÐµÑ‚ Ð½ÐµÐ´Ð°Ð²Ð½Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²' : 'No recent players'}</p>`;
        return;
      }
      
      const recentPlayers = App.recentlyViewed.map(id => App.processedPlayers.find(p => String(p.id) === id)).filter(Boolean).slice(0, 10);
      panel.innerHTML = recentPlayers.map(p => `
        <div class="recent-item" onclick="viewPlayer('${p.id}')">
          <i data-lucide="clock" class="h-3 w-3 text-slate-400"></i>
          <span class="text-sm flex-1 truncate">${p.id}</span>
          <span class="text-xs px-1.5 py-0.5 rounded bg-${p.churnRisk === 'critical' ? 'red' : p.churnRisk === 'high' ? 'orange' : 'slate'}-100 text-${p.churnRisk === 'critical' ? 'red' : p.churnRisk === 'high' ? 'orange' : 'slate'}-700">${p.churnRisk}</span>
        </div>
      `).join('');
      lucide.createIcons();
    }

    // ============================================================
    // SAVED FILTERS FUNCTIONS
    // ============================================================
    function saveCurrentFilter() {
      const name = prompt(App.currentLang === 'ru' ? 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°:' : 'Enter filter name:');
      if (!name) return;
      
      const filterState = {
        name,
        search: document.getElementById('searchInput')?.value || '',
        profit: document.getElementById('profitFilter')?.value || '',
        pref: document.getElementById('prefFilter')?.value || '',
        churn: document.getElementById('churnFilter')?.value || '',
        value: document.getElementById('valueFilter')?.value || '',
        createdAt: Date.now()
      };
      
      App.savedFilters.push(filterState);
      saveSavedFilters();
      updateSavedFiltersPanel();
      showNotification(App.currentLang === 'ru' ? `Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ "${name}" ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½` : `Filter "${name}" saved`, 'success');
    }

    function applySavedFilter(index) {
      const filter = App.savedFilters[index];
      if (!filter) return;
      
      document.getElementById('searchInput').value = filter.search;
      document.getElementById('profitFilter').value = filter.profit;
      document.getElementById('prefFilter').value = filter.pref;
      document.getElementById('churnFilter').value = filter.churn;
      document.getElementById('valueFilter').value = filter.value;
      
      filterTable();
      showNotification(App.currentLang === 'ru' ? `Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ "${filter.name}" Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½` : `Filter "${filter.name}" applied`, 'success');
    }

    function deleteSavedFilter(index) {
      App.savedFilters.splice(index, 1);
      saveSavedFilters();
      updateSavedFiltersPanel();
    }

    function saveSavedFilters() {
      localStorage.setItem('crmSavedFilters', JSON.stringify(App.savedFilters));
    }

    function loadSavedFilters() {
      try {
        const saved = localStorage.getItem('crmSavedFilters');
        if (saved) App.savedFilters = JSON.parse(saved);
      } catch (e) { console.error('Error loading saved filters:', e); }
    }

    function updateSavedFiltersPanel() {
      const panel = document.getElementById('savedFiltersList');
      
      if (App.savedFilters.length === 0) {
        panel.innerHTML = `<p class="text-xs text-slate-400 italic" data-translate="noSavedFilters">${App.currentLang === 'ru' ? 'ÐÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²' : 'No saved filters'}</p>`;
        return;
      }
      
      panel.innerHTML = App.savedFilters.map((f, i) => `
        <div class="saved-filter" onclick="applySavedFilter(${i})">
          <span class="text-sm truncate flex-1">${f.name}</span>
          <button onclick="event.stopPropagation();deleteSavedFilter(${i})" class="text-slate-400 hover:text-red-500 p-1">
            <i data-lucide="x" class="h-3 w-3"></i>
          </button>
        </div>
      `).join('');
      lucide.createIcons();
    }

    // ============================================================
    // COLUMN TOGGLE FUNCTIONS
    // ============================================================
    function toggleColumnMenu() {
      document.getElementById('columnMenu').classList.toggle('open');
    }

    function toggleColumn(col) {
      App.visibleColumns[col] = !App.visibleColumns[col];
      saveColumnPreferences();
      updateColumnVisibility();
      renderTable();
    }

    function updateColumnVisibility() {
      const cols = App.visibleColumns;
      document.querySelectorAll('.col-id').forEach(el => el.style.display = cols.id ? '' : 'none');
      document.querySelectorAll('.col-type').forEach(el => el.style.display = cols.type ? '' : 'none');
      document.querySelectorAll('.col-pref').forEach(el => el.style.display = cols.pref ? '' : 'none');
      document.querySelectorAll('.col-revenue').forEach(el => el.style.display = cols.revenue ? '' : 'none');
      document.querySelectorAll('.col-winrate').forEach(el => el.style.display = cols.winrate ? '' : 'none');
      document.querySelectorAll('.col-value').forEach(el => el.style.display = cols.value ? '' : 'none');
      document.querySelectorAll('.col-churn').forEach(el => el.style.display = cols.churn ? '' : 'none');
      document.querySelectorAll('.col-ltv').forEach(el => el.style.display = cols.ltv ? '' : 'none');
      
      // Update checkboxes in column menu
      document.querySelectorAll('#columnMenu input[type="checkbox"]').forEach(cb => {
        cb.checked = cols[cb.dataset.column];
      });
    }

    function saveColumnPreferences() {
      localStorage.setItem('crmColumns', JSON.stringify(App.visibleColumns));
    }

    function loadColumnPreferences() {
      try {
        const saved = localStorage.getItem('crmColumns');
        if (saved) App.visibleColumns = { ...App.visibleColumns, ...JSON.parse(saved) };
      } catch (e) { console.error('Error loading column preferences:', e); }
    }

    // Close column menu when clicking outside
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('columnMenu');
      const toggle = e.target.closest('.column-toggle');
      if (menu && !toggle) menu.classList.remove('open');
    });

    // ============================================================
    // AUTO-REFRESH FUNCTIONS
    // ============================================================
    function toggleAutoRefresh() {
      App.autoRefreshEnabled = document.getElementById('autoRefreshToggle').checked;
      
      if (App.autoRefreshEnabled) {
        startAutoRefresh();
        document.getElementById('autoRefreshIndicator').classList.remove('hidden');
        showNotification(App.currentLang === 'ru' ? 'ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ (5 Ð¼Ð¸Ð½)' : 'Auto-refresh enabled (5 min)', 'success');
      } else {
        stopAutoRefresh();
        document.getElementById('autoRefreshIndicator').classList.add('hidden');
        showNotification(App.currentLang === 'ru' ? 'ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾' : 'Auto-refresh disabled', 'info');
      }
      
      localStorage.setItem('crmAutoRefresh', App.autoRefreshEnabled);
    }

    function startAutoRefresh() {
      stopAutoRefresh();
      App.autoRefreshInterval = setInterval(() => {
        if (App.autoRefreshEnabled && !App.isLoading) {
          console.log('Auto-refreshing data...');
          loadPlayers(true);
        }
      }, App.autoRefreshSeconds * 1000);
    }

    function stopAutoRefresh() {
      if (App.autoRefreshInterval) {
        clearInterval(App.autoRefreshInterval);
        App.autoRefreshInterval = null;
      }
    }

    function loadAutoRefreshPreference() {
      try {
        App.autoRefreshEnabled = localStorage.getItem('crmAutoRefresh') === 'true';
        document.getElementById('autoRefreshToggle').checked = App.autoRefreshEnabled;
        if (App.autoRefreshEnabled) {
          startAutoRefresh();
          document.getElementById('autoRefreshIndicator').classList.remove('hidden');
        }
      } catch (e) { console.error('Error loading auto-refresh preference:', e); }
    }

    // ============================================================
    // OPTIMIZED CHART UPDATES
    // ============================================================
    function updateChartData(chartId, newData, newLabels = null) {
      const chart = App.charts[chartId];
      if (!chart) return false;
      
      try {
        if (newLabels) chart.data.labels = newLabels;
        chart.data.datasets[0].data = newData;
        chart.update('none'); // 'none' mode for faster updates without animation
        return true;
      } catch (e) {
        console.error('Error updating chart:', e);
        return false;
      }
    }

    // ============================================================
    // EXPORT HELPER
    // ============================================================
    function exportPlayersToCSV(players, filename) {
      const headers = ['ID','Phone','Type','Preference','Deposits','Withdrawals','Net Revenue','Win Rate','Value Segment','Churn Risk','Churn Score','LTV'];
      const rows = players.map(p => [p.id, p.phone_number, p.phoneType, p.preference, p.totalDeposits, p.totalWithdrawals, p.netRevenue, p.winRate?.toFixed(1), p.valueSegment, p.churnRisk, p.churnScore, p.ltv]);
      const csv = [headers.join(','), ...rows.map(r => r.map(v => `"${v || ''}"`).join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function showFilteredPlayers(type, title) {
      // Ensure data is loaded first
      if (!App.dataLoaded || App.processedPlayers.length === 0) {
        loadPlayers().then(() => showFilteredPlayers(type, title));
        return;
      }
      
      App.currentFilter = type; setText('currentFilterName', title);
      const filters = {
        'profitable': p => p.isProfitable, 'negative_ggr': p => p.isNegativeGGR, 'atrisk': p => p.churnRisk === 'high' || p.churnRisk === 'critical',
        'value_vip': p => p.valueSegment === 'vip', 'value_high': p => p.valueSegment === 'high', 'value_medium': p => p.valueSegment === 'medium', 'value_low': p => p.valueSegment === 'low',
        'pref_sports': p => p.preference === 'sports', 'pref_casino': p => p.preference === 'casino', 'pref_mixed': p => p.preference === 'mixed',
        'churn_low': p => p.churnRisk === 'low', 'churn_medium': p => p.churnRisk === 'medium', 'churn_high': p => p.churnRisk === 'high', 'churn_critical': p => p.churnRisk === 'critical',
        'style_highroller': p => p.bettingStyle === 'highroller', 'style_regular': p => p.bettingStyle === 'regular', 'style_casual': p => p.bettingStyle === 'casual',
        'life_new': p => p.lifecycle === 'new', 'life_growing': p => p.lifecycle === 'growing', 'life_mature': p => p.lifecycle === 'mature',
        'life_declining': p => p.lifecycle === 'declining', 'life_dormant': p => p.lifecycle === 'dormant', 'life_churned': p => p.lifecycle === 'churned',
        'withdrawing': p => p.isWithdrawing, 'virtual': p => p.phoneType === 'virtual', 'highwin': p => p.winRate > 60,
        'wr_0_25': p => p.winRate < 25, 'wr_25_40': p => p.winRate >= 25 && p.winRate < 40, 'wr_40_50': p => p.winRate >= 40 && p.winRate < 50, 'wr_50_plus': p => p.winRate >= 50
      };
      App.filteredPlayers = filters[type] ? App.processedPlayers.filter(filters[type]) : [...App.processedPlayers];
      App.currentPage = 1; 
      switchTab('players'); 
      renderTable();
    }

    // ============================================================
    // PLAYER MODAL
    // ============================================================
    window.viewPlayer = function(id) {
      const p = App.processedPlayers.find(x => String(x.id) === String(id));
      if (!p) return;
      
      // Track recently viewed
      addToRecentlyViewed(id);
      
      document.getElementById('modalPlayerId').textContent = 'ID: ' + p.id;
      const similar = findSimilarPlayers(p, 3);
      const churnC = { low: 'emerald', medium: 'yellow', high: 'orange', critical: 'red' }[p.churnRisk];
      const isRu = App.currentLang === 'ru';
      const isWatched = App.watchlist.has(String(p.id));
      
      document.getElementById('modalContent').innerHTML = `
        <div class="flex items-center gap-2 mb-4">
          <button onclick="toggleWatchlist('${p.id}');document.getElementById('modalContent').querySelector('.watchlist-btn').classList.toggle('active')" class="watchlist-btn flex items-center gap-2 px-3 py-1.5 rounded-lg border ${isWatched ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : 'bg-slate-50 border-slate-200 text-slate-600'} hover:bg-yellow-50">
            <i data-lucide="star" class="h-4 w-4"></i>
            <span>${isWatched ? (isRu ? 'Ð’ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ…' : 'Watching') : (isRu ? 'ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ' : 'Watch')}</span>
          </button>
          <span class="text-xs px-2 py-1 rounded-full bg-${p.phoneType === 'virtual' ? 'red' : 'slate'}-100 text-${p.phoneType === 'virtual' ? 'red' : 'slate'}-700">${p.phoneType}</span>
          <span class="text-xs px-2 py-1 rounded-full bg-${churnC}-100 text-${churnC}-700">${p.churnRisk} risk</span>
          <button class="tutorial-btn" onclick="showTutorial('player_details')">?</button>
        </div>
        <div class="flex items-center gap-2 mb-2">
          <h4 class="text-sm font-semibold text-slate-600">${isRu ? 'ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸' : 'Key Metrics'}</h4>
          <button class="tutorial-btn" onclick="showTutorial('player_financials')">?</button>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
          <div class="p-3 bg-slate-50 rounded-lg text-center"><p class="text-xs text-slate-500">${isRu ? 'Ð§Ð¸ÑÑ‚Ñ‹Ð¹ Ð´Ð¾Ñ…Ð¾Ð´' : 'Net Revenue'}</p><p class="text-lg font-bold ${p.netRevenue>=0?'text-emerald-600':'text-red-600'}">${formatK(p.netRevenue)}</p></div>
          <div class="p-3 bg-slate-50 rounded-lg text-center"><p class="text-xs text-slate-500">${isRu ? 'Ð’Ð¸Ð½Ñ€ÐµÐ¹Ñ‚' : 'Win Rate'}</p><p class="text-lg font-bold">${formatPct(p.winRate)}</p></div>
          <div class="p-3 bg-${churnC}-50 rounded-lg text-center"><p class="text-xs text-${churnC}-600">${isRu ? 'Ð Ð¸ÑÐº Ð¾Ñ‚Ñ‚Ð¾ÐºÐ°' : 'Churn Score'}</p><p class="text-lg font-bold text-${churnC}-700">${p.churnScore}/100</p></div>
          <div class="p-3 bg-purple-50 rounded-lg text-center"><p class="text-xs text-purple-600">LTV</p><p class="text-lg font-bold text-purple-700">${formatK(p.ltv)}</p></div>
        </div>
        <div class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
          <h4 class="font-bold text-amber-800 mb-2 flex items-center gap-2"><i data-lucide="sparkles" class="h-4 w-4 inline"></i> ${isRu ? 'AI ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°' : 'AI Insights'} <button class="tutorial-btn" onclick="showTutorial('player_ai_insights')">?</button></h4>
          <div class="text-sm text-amber-700 space-y-1">
            ${p.churnFactors.length ? `<p>âš ï¸ ${isRu ? 'Ð Ð¸ÑÐº' : 'Risk'}: ${p.churnFactors.join(', ')}</p>` : ''}
            ${p.isProfitable ? `<p>âœ… ${isRu ? 'ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ñ‹Ð¹' : 'Profitable'}: ${formatK(p.companyProfit)}</p>` : ''}
            ${p.isNegativeGGR ? `<p>ðŸ”´ ${isRu ? 'Ð£Ð±Ñ‹Ñ‚Ð¾Ðº' : 'Loss'}: ${formatK(Math.abs(p.companyProfit))}</p>` : ''}
            ${p.valueSegment === 'vip' ? `<p>ðŸ‘‘ VIP - ${isRu ? 'ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ' : 'Priority retention'}</p>` : ''}
            <p>ðŸ’¡ ${isRu ? 'Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ' : 'Recommended bonus'}: ${formatK(p.optimalBonus)}</p>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div class="p-4 border rounded-xl"><h4 class="font-bold mb-3">${isRu ? 'Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ' : 'Info'}</h4>
            <div class="space-y-1 text-sm">
              <p>${isRu ? 'Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½' : 'Phone'}: ${p.phone_number || '-'} (${p.phoneType})</p>
              <p>${isRu ? 'ÐŸÑ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ' : 'Preference'}: ${p.preference}</p>
              <p>${isRu ? 'Ð¡ÐµÐ³Ð¼ÐµÐ½Ñ‚' : 'Segment'}: ${p.valueSegment.toUpperCase()}</p>
              <p>${isRu ? 'Ð¦Ð¸ÐºÐ»' : 'Lifecycle'}: ${p.lifecycle}</p>
            </div>
          </div>
          <div class="p-4 border rounded-xl"><h4 class="font-bold mb-3">${isRu ? 'Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹' : 'Financial'}</h4>
            <div class="space-y-1 text-sm">
              <p>${isRu ? 'Ð”ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹' : 'Deposits'}: <span class="text-emerald-600">${formatK(parseFloat(p.total_deposit_amount)||0)}</span></p>
              <p>${isRu ? 'Ð’Ñ‹Ð²Ð¾Ð´Ñ‹' : 'Withdrawals'}: <span class="text-red-600">${formatK(parseFloat(p.total_withdraw_amount)||0)}</span></p>
              <p>${isRu ? 'Ð’ÑÐµÐ³Ð¾ ÑÑ‚Ð°Ð²Ð¾Ðº' : 'Total Bet'}: ${formatK(p.totalBet)}</p>
              <p>${isRu ? 'Ð’ÑÐµÐ³Ð¾ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð½Ð¾' : 'Total Won'}: ${formatK(p.totalWin)}</p>
            </div>
          </div>
        </div>
        ${similar.length ? `<div class="p-4 bg-slate-50 rounded-xl"><h4 class="font-bold mb-3 flex items-center gap-2">ðŸ” ${isRu ? 'ÐŸÐ¾Ñ…Ð¾Ð¶Ð¸Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¸' : 'Similar Players'} <button class="tutorial-btn" onclick="showTutorial('similar_players')">?</button></h4>
          ${similar.map(s => `<div class="flex justify-between p-2 bg-white rounded mb-2 cursor-pointer hover:bg-slate-100" onclick="viewPlayer('${s.player.id}')"><span>${s.player.id}</span><span>${formatK(s.player.netRevenue)} (${Math.round(s.similarity*100)}%)</span></div>`).join('')}
        </div>` : ''}`;
      
      document.getElementById('playerModal').classList.remove('hidden');
      lucide.createIcons();
    };

    // ============================================================
    // TELEGRAM INTEGRATION
    // ============================================================
    const TELEGRAM_BOT_TOKEN = '8565187554:AAGYGyH8v5jIRxdPEJXqEZ5IJKifA2xIEoQ';
    
    function saveTelegramSettings() {
      const chatId = document.getElementById('telegramChatId').value.trim();
      localStorage.setItem('telegram_chat_id', chatId);
      showTelegramStatus('âœ… Chat ID saved!', 'text-emerald-600');
    }
    
    function loadTelegramSettings() {
      const chatId = localStorage.getItem('telegram_chat_id') || '';
      document.getElementById('telegramChatId').value = chatId;
    }
    
    function showTelegramStatus(msg, colorClass) {
      const el = document.getElementById('telegramStatus');
      el.textContent = msg;
      el.className = `text-sm mt-3 ${colorClass}`;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 5000);
    }
    
    async function sendTelegramMessage(text) {
      const chatId = document.getElementById('telegramChatId').value.trim() || localStorage.getItem('telegram_chat_id');
      
      if (!chatId) {
        showTelegramStatus('âŒ Please enter your Chat ID', 'text-red-600');
        return false;
      }
      
      try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: chatId,
            text: text,
            parse_mode: 'HTML'
          })
        });
        const data = await response.json();
        return data.ok;
      } catch (error) {
        console.error('Telegram error:', error);
        return false;
      }
    }
    
    async function testTelegramConnection() {
      showTelegramStatus('â³ Sending test message...', 'text-blue-600');
      const success = await sendTelegramMessage('âœ… BwanaBet CRM Connected!');
      if (success) {
        showTelegramStatus('âœ… Test message sent! Check your Telegram.', 'text-emerald-600');
      } else {
        showTelegramStatus('âŒ Failed to send. Check token and chat ID.', 'text-red-600');
      }
    }
    
    async function sendTelegramReport() {
      if (App.processedPlayers.length === 0) {
        showTelegramStatus('âŒ No player data loaded', 'text-red-600');
        return;
      }
      
      showTelegramStatus('â³ Sending report...', 'text-blue-600');
      const s = getStats();
      const now = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
      
      // Get top 3 churn critical players
      const criticalPlayers = App.processedPlayers
        .filter(p => p.churnRisk === 'critical')
        .sort((a, b) => b.netRevenue - a.netRevenue)
        .slice(0, 3);
      
      const criticalList = criticalPlayers.length > 0 
        ? criticalPlayers.map(p => `â€¢ ${p.id}: ${formatK(p.netRevenue)}`).join('\n')
        : 'â€¢ None';
      
      // Get top 3 negative GGR players
      const negativeGGR = App.processedPlayers
        .filter(p => p.isNegativeGGR)
        .sort((a, b) => a.netRevenue - b.netRevenue)
        .slice(0, 3);
      
      const negativeList = negativeGGR.length > 0
        ? negativeGGR.map(p => `â€¢ ${p.id}: ${formatK(p.netRevenue)}`).join('\n')
        : 'â€¢ None';
      
      const report = `ðŸ“Š <b>BwanaBet CRM Report</b>
${now}

<b>ðŸ’° Profitability</b>
Profitable: ${s.profitable} (${formatK(s.totalProfit)})
Negative GGR: ${s.negativeGGR} (${formatK(s.totalLoss)})
Net: ${formatK(s.totalProfit + s.totalLoss)}

<b>âš ï¸ Churn Risk</b>
Critical: ${s.churnCritical}
High: ${s.churnHigh}
Medium: ${s.churnMedium}
Low: ${s.churnLow}

<b>ðŸ”´ Top Critical Churn</b>
${criticalList}

<b>ðŸ“‰ Top Negative GGR</b>
${negativeList}

Total Players: ${s.total}`;

      const success = await sendTelegramMessage(report);
      if (success) {
        showTelegramStatus('âœ… Report sent to Telegram!', 'text-emerald-600');
      } else {
        showTelegramStatus('âŒ Failed to send report', 'text-red-600');
      }
    }

    // ============================================================
    // CALL CENTER MODULE
    // ============================================================
    const CallCenter = {
      callLogs: [],           // All call logs
      employees: [],          // List of employees/users
      currentEmployee: null,  // Currently logged in employee
      activeClient: null,     // Currently selected client
      currentSubTab: 'calls', // Current sub-tab
      
      async init() {
        console.log('CallCenter.init() called');
        try {
          // Load users from Supabase
          await this.loadUsersFromSupabase();
          console.log('Users loaded, count:', this.employees.length);
          
          // Load call logs from Supabase
          await this.loadCallLogsFromSupabase();
          console.log('Call logs loaded, count:', this.callLogs.length);
          
          // Try to set current employee based on logged-in user
          if (App.user?.email) {
            const currentUser = this.employees.find(e => e.email === App.user.email);
            if (currentUser) {
              this.currentEmployee = currentUser;
              const select = document.getElementById('ccEmployeeSelect');
              if (select) select.value = currentUser.id;
            }
          }
        } catch(e) { 
          console.error('Error loading call center data from Supabase:', e);
          console.log('Falling back to localStorage...');
          // Fallback to localStorage
          this.loadFromLocalStorage();
        }
        
        this.renderEmployeeSelect();
        this.updateUIState();
        this.applySubTabAccess();
        this.renderUserTable();
      },
      
      loadFromLocalStorage() {
        try {
          const savedLogs = localStorage.getItem('callCenterLogs');
          if (savedLogs) this.callLogs = JSON.parse(savedLogs);
          
          const savedEmployees = localStorage.getItem('callCenterEmployees');
          if (savedEmployees) this.employees = JSON.parse(savedEmployees);
        } catch(e) { console.error('Error loading from localStorage:', e); }
      },
      
      async loadUsersFromSupabase() {
        console.log('Loading users from Supabase...');
        const { data, error } = await App.db
          .from('call_center_users')
          .select('*')
          .eq('is_active', true)
          .order('name');
        
        if (error) {
          console.error('Supabase error loading users:', error);
          throw error;
        }
        console.log('Loaded users:', data);
        this.employees = data || [];
      },
      
      async loadCallLogsFromSupabase() {
        const { data, error } = await App.db
          .from('call_logs')
          .select('*')
          .order('created_at', { ascending: false });
        
        if (error) {
          console.warn('call_logs table not found, using localStorage');
          const savedLogs = localStorage.getItem('callCenterLogs');
          if (savedLogs) this.callLogs = JSON.parse(savedLogs);
          return;
        }
        
        // Convert Supabase format to internal format
        this.callLogs = (data || []).map(log => ({
          id: log.id,
          clientId: log.client_id,
          employeeId: log.employee_id,
          outcome: log.outcome,
          notes: log.notes,
          rating: log.rating,
          callbackDate: log.callback_date,
          date: log.created_at
        }));
      },
      
      save() {
        // Still save to localStorage as backup
        localStorage.setItem('callCenterLogs', JSON.stringify(this.callLogs));
        localStorage.setItem('callCenterEmployees', JSON.stringify(this.employees));
        if (this.currentEmployee) {
          localStorage.setItem('callCenterLastEmployee', this.currentEmployee.id);
        }
      },
      
      // Sub-tab Navigation
      switchSubTab(tab) {
        this.currentSubTab = tab;
        
        // Update tab buttons
        document.querySelectorAll('.cc-subtab').forEach(btn => {
          btn.classList.remove('bg-slate-800', 'text-white');
          btn.classList.add('bg-slate-100', 'text-slate-600');
        });
        const activeBtn = document.getElementById('ccSubTab-' + tab);
        if (activeBtn) {
          activeBtn.classList.remove('bg-slate-100', 'text-slate-600');
          activeBtn.classList.add('bg-slate-800', 'text-white');
        }
        
        // Show/hide content
        document.getElementById('ccContent-calls')?.classList.toggle('hidden', tab !== 'calls');
        document.getElementById('ccContent-admin')?.classList.toggle('hidden', tab !== 'admin');
        
        // Refresh admin content when switching to admin tab
        if (tab === 'admin') {
          this.renderUserTable();
          this.renderAdminStats();
        }
        
        lucide.createIcons();
      },
      
      applySubTabAccess() {
        // Hide admin tab for non-admin users
        const isAdmin = App.role === 'admin' || App.role === 'developer';
        const adminTabBtn = document.getElementById('ccSubTab-admin');
        const subTabsContainer = document.getElementById('ccSubTabs');
        
        if (adminTabBtn) {
          adminTabBtn.classList.toggle('hidden', !isAdmin);
        }
        
        // If call center role, hide the entire sub-tabs bar
        if (App.role === 'callcenter' && subTabsContainer) {
          subTabsContainer.classList.add('hidden');
        }
      },
      
      // Employee/User Management
      renderEmployeeSelect() {
        const select = document.getElementById('ccEmployeeSelect');
        if (!select) return;
        
        // Only show call center employees in dropdown
        const callCenterEmployees = this.employees.filter(e => e.role === 'callcenter' || !e.role);
        
        select.innerHTML = '<option value="">-- Select Employee --</option>' +
          callCenterEmployees.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
        
        if (this.currentEmployee) {
          select.value = this.currentEmployee.id;
        }
      },
      
      switchEmployee() {
        const select = document.getElementById('ccEmployeeSelect');
        const empId = select?.value;
        
        if (!empId) {
          this.currentEmployee = null;
        } else {
          this.currentEmployee = this.employees.find(e => e.id === empId);
        }
        
        this.save();
        this.updateUIState();
        this.updateEmployeeStats();
        this.renderMyCallHistory();
      },
      
      updateUIState() {
        const hasEmployee = !!this.currentEmployee;
        const warning = document.getElementById('ccNoEmployeeWarning');
        const content = document.getElementById('ccMainContent');
        
        if (warning) warning.classList.toggle('hidden', hasEmployee);
        if (content) content.classList.toggle('hidden', !hasEmployee);
        
        if (hasEmployee && App.processedPlayers?.length > 0) {
          this.renderQueue();
        }
      },
      
      // User CRUD Operations with Supabase Auth
      async addUser() {
        const name = document.getElementById('ccNewUserName')?.value.trim();
        const email = document.getElementById('ccNewUserEmail')?.value.trim();
        const password = document.getElementById('ccNewUserPassword')?.value;
        const role = document.getElementById('ccNewUserRole')?.value || 'callcenter';
        
        // Validation
        if (!name) {
          alert('Please enter a name');
          return;
        }
        if (!email) {
          alert('Please enter an email address');
          return;
        }
        if (!password || password.length < 6) {
          alert('Please enter a password (minimum 6 characters)');
          return;
        }
        
        // Check if email already exists locally
        if (this.employees.some(e => e.email?.toLowerCase() === email.toLowerCase())) {
          alert('A user with this email already exists');
          return;
        }
        
        const btn = document.getElementById('ccAddUserBtn');
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Creating...';
        
        try {
          // 1. Try to create Supabase Auth user (may fail without service key)
          let authUserId = null;
          try {
            const { data: signupData, error: signupError } = await App.db.auth.signUp({
              email: email,
              password: password,
              options: {
                data: { name: name, role: role }
              }
            });
            if (!signupError && signupData?.user) {
              authUserId = signupData.user.id;
            }
          } catch (authErr) {
            console.warn('Auth signup skipped:', authErr.message);
          }
          
          // 2. Insert into call_center_users table (this is the important part)
          const { data: userData, error: userError } = await App.db
            .from('call_center_users')
            .insert({
              auth_id: authUserId,
              name: name,
              email: email,
              role: role,
              is_active: true
            })
            .select()
            .single();
          
          if (userError) throw userError;
          
          // Add to local array
          this.employees.push(userData);
          this.save();
          
          // Clear form
          document.getElementById('ccNewUserName').value = '';
          document.getElementById('ccNewUserEmail').value = '';
          document.getElementById('ccNewUserPassword').value = '';
          document.getElementById('ccNewUserRole').value = 'callcenter';
          
          // Refresh displays
          this.renderEmployeeSelect();
          this.renderUserTable();
          
          if (authUserId) {
            alert(`User "${name}" created successfully!\n\nEmail: ${email}\nRole: ${role}\n\nThey can log in with their credentials.`);
          } else {
            alert(`User "${name}" saved to database!\n\nEmail: ${email}\nRole: ${role}\n\nNOTE: You need to manually create their login account in Supabase Dashboard â†’ Authentication â†’ Users â†’ Add User`);
          }
          
        } catch (error) {
          console.error('Error creating user:', error);
          alert('Error creating user: ' + (error.message || 'Unknown error'));
        } finally {
          btn.disabled = false;
          btn.innerHTML = originalText;
          lucide.createIcons();
        }
      },
      
      editUser(userId) {
        const user = this.employees.find(e => e.id === userId);
        if (!user) return;
        
        document.getElementById('ccEditUserId').value = user.id;
        document.getElementById('ccEditUserAuthId').value = user.auth_id || '';
        document.getElementById('ccEditUserName').value = user.name;
        document.getElementById('ccEditUserEmail').value = user.email || '';
        document.getElementById('ccEditUserRole').value = user.role || 'callcenter';
        document.getElementById('ccEditUserNewPassword').value = '';
        
        document.getElementById('ccEditUserModal').classList.remove('hidden');
        lucide.createIcons();
      },
      
      async saveUserEdit() {
        const userId = document.getElementById('ccEditUserId').value;
        const authId = document.getElementById('ccEditUserAuthId').value;
        const newName = document.getElementById('ccEditUserName').value.trim();
        const newRole = document.getElementById('ccEditUserRole').value;
        const newPassword = document.getElementById('ccEditUserNewPassword').value;
        
        if (!newName) {
          alert('Please enter a name');
          return;
        }
        
        try {
          // Update in Supabase
          const { error: updateError } = await App.db
            .from('call_center_users')
            .update({ name: newName, role: newRole })
            .eq('id', userId);
          
          if (updateError) throw updateError;
          
          // Update password if provided
          if (newPassword && newPassword.length >= 6 && authId) {
            try {
              await App.db.auth.admin.updateUserById(authId, { password: newPassword });
            } catch (e) {
              console.warn('Could not update password via admin API:', e);
            }
          }
          
          // Update local array
          const userIndex = this.employees.findIndex(e => e.id === userId);
          if (userIndex !== -1) {
            this.employees[userIndex].name = newName;
            this.employees[userIndex].role = newRole;
          }
          this.save();
          
          document.getElementById('ccEditUserModal').classList.add('hidden');
          
          this.renderEmployeeSelect();
          this.renderUserTable();
          
          alert('User updated successfully!');
          
        } catch (error) {
          console.error('Error updating user:', error);
          alert('Error updating user: ' + (error.message || 'Unknown error'));
        }
      },
      
      async deleteUser(userId) {
        const user = this.employees.find(e => e.id === userId);
        if (!user) return;
        
        if (!confirm(`Are you sure you want to delete "${user.name}"?\n\nThis will deactivate their account.`)) {
          return;
        }
        
        try {
          // Soft delete - set is_active to false
          const { error } = await App.db
            .from('call_center_users')
            .update({ is_active: false })
            .eq('id', userId);
          
          if (error) throw error;
          
          // Remove from local array
          this.employees = this.employees.filter(e => e.id !== userId);
          this.save();
          
          // If deleted user was current employee, clear selection
          if (this.currentEmployee?.id === userId) {
            this.currentEmployee = null;
            const select = document.getElementById('ccEmployeeSelect');
            if (select) select.value = '';
            this.updateUIState();
          }
          
          this.renderEmployeeSelect();
          this.renderUserTable();
          
          alert('User deactivated successfully');
          
        } catch (error) {
          console.error('Error deleting user:', error);
          alert('Error deleting user: ' + (error.message || 'Unknown error'));
        }
      },
      
      renderUserTable() {
        const tbody = document.getElementById('ccUserTableBody');
        if (!tbody) return;
        
        if (this.employees.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-slate-400">No users found. Add your first user above.</td></tr>';
          return;
        }
        
        const roleLabels = {
          admin: 'Administrator',
          developer: 'Developer',
          callcenter: 'Call Center'
        };
        
        const roleColors = {
          admin: 'yellow',
          developer: 'purple',
          callcenter: 'blue'
        };
        
        tbody.innerHTML = this.employees.map(user => {
          const role = user.role || 'callcenter';
          const roleLabel = roleLabels[role] || role;
          const roleColor = roleColors[role] || 'slate';
          
          return `<tr class="border-t hover:bg-slate-50">
            <td class="px-4 py-3 font-medium">${user.name}</td>
            <td class="px-4 py-3 text-slate-500 text-sm">${user.email || '-'}</td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 bg-${roleColor}-100 text-${roleColor}-700 rounded text-xs font-medium">${roleLabel}</span>
            </td>
            <td class="px-4 py-3 text-center">
              <button onclick="CallCenter.editUser('${user.id}')" class="text-blue-600 hover:underline text-sm mr-2">Edit</button>
              <button onclick="CallCenter.deleteUser('${user.id}')" class="text-red-600 hover:underline text-sm">Delete</button>
            </td>
          </tr>`;
        }).join('');
      },
      
      // Call Data
      getClientCallData(clientId) {
        const logs = this.callLogs.filter(l => String(l.clientId) === String(clientId));
        const attempts = logs.filter(l => l.outcome === 'no_answer').length;
        const lastCall = logs.length > 0 ? logs[logs.length - 1] : null;
        const callbacks = logs.filter(l => l.outcome === 'callback' && new Date(l.callbackDate) <= new Date());
        const hasCallback = callbacks.length > 0;
        const status = attempts >= 5 ? 'no_contact' : 
                       hasCallback ? 'callback' :
                       logs.some(l => ['interested', 'not_interested', 'wrong_number'].includes(l.outcome)) ? 'contacted' :
                       logs.length === 0 ? 'new' : 'pending';
        return { logs, attempts, lastCall, status, hasCallback };
      },
      
      getEmployeeStats(employeeId, dateFilter = 'all') {
        // Debug: show what we're filtering
        console.log(`getEmployeeStats for employeeId: ${employeeId}`);
        console.log('All logs employeeIds:', this.callLogs.map(l => l.employeeId));
        
        let logs = this.callLogs.filter(l => String(l.employeeId) === String(employeeId));
        console.log(`Filtered logs count: ${logs.length}`);
        
        const now = new Date();
        if (dateFilter === 'today') {
          const today = now.toDateString();
          logs = logs.filter(l => new Date(l.date).toDateString() === today);
        } else if (dateFilter === 'week') {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          logs = logs.filter(l => new Date(l.date) >= weekAgo);
        } else if (dateFilter === 'month') {
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          logs = logs.filter(l => new Date(l.date) >= monthAgo);
        }
        
        const total = logs.length;
        const successful = logs.filter(l => ['interested', 'callback'].includes(l.outcome)).length;
        const failed = logs.filter(l => ['no_answer', 'wrong_number', 'not_interested'].includes(l.outcome)).length;
        const callbacks = logs.filter(l => l.outcome === 'callback').length;
        const rate = total > 0 ? Math.round((successful / total) * 100) : 0;
        
        const ratedLogs = logs.filter(l => l.rating && l.rating > 0);
        const avgRating = ratedLogs.length > 0 ? (ratedLogs.reduce((a, l) => a + l.rating, 0) / ratedLogs.length).toFixed(1) : '-';
        
        return { total, successful, failed, callbacks, rate, avgRating, logs };
      },
      
      updateEmployeeStats() {
        if (!this.currentEmployee) return;
        
        const stats = this.getEmployeeStats(this.currentEmployee.id, 'all');
        
        const el = (id, val) => { const e = document.getElementById(id); if (e) e.textContent = val; };
        el('cc-emp-total', stats.total);
        el('cc-emp-success', stats.successful);
        el('cc-emp-failed', stats.failed);
        el('cc-emp-callbacks', stats.callbacks);
        el('cc-emp-rate', stats.rate + '%');
      },
      
      // Admin Stats
      renderAdminStats() {
        const dateFilter = document.getElementById('ccAdminDateFilter')?.value || 'all';
        
        console.log('renderAdminStats called, dateFilter:', dateFilter);
        console.log('Total employees:', this.employees.length);
        console.log('Total call logs:', this.callLogs.length);
        
        let totalCalls = 0, totalSuccess = 0, totalFailed = 0;
        const employeeRows = [];
        
        // Show ALL employees (not just call center)
        this.employees.forEach(emp => {
          const stats = this.getEmployeeStats(emp.id, dateFilter);
          console.log(`Stats for ${emp.name} (${emp.id}):`, stats);
          
          totalCalls += stats.total;
          totalSuccess += stats.successful;
          totalFailed += stats.failed;
          
          employeeRows.push({ employee: emp, stats });
        });
        
        employeeRows.sort((a, b) => b.stats.total - a.stats.total);
        
        const avgRate = totalCalls > 0 ? Math.round((totalSuccess / totalCalls) * 100) : 0;
        
        // Update summary
        const el = (id, val) => { const e = document.getElementById(id); if (e) e.textContent = val; };
        el('admin-total-calls', totalCalls);
        el('admin-total-success', totalSuccess);
        el('admin-total-failed', totalFailed);
        el('admin-avg-rate', avgRate + '%');
        
        // Render table
        const tbody = document.getElementById('ccAdminTableBody');
        if (!tbody) return;
        
        if (employeeRows.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-slate-400">No employees found</td></tr>';
          return;
        }
        
        tbody.innerHTML = employeeRows.map(row => {
          const e = row.employee;
          const s = row.stats;
          const rateColor = s.rate >= 50 ? 'emerald' : s.rate >= 30 ? 'yellow' : 'red';
          
          return `<tr class="border-t hover:bg-slate-50">
            <td class="px-3 py-2">
              <div class="font-medium text-sm">${e.name}</div>
              <div class="text-xs text-slate-400">${e.email || ''}</div>
            </td>
            <td class="px-3 py-2 text-center text-sm">${s.total}</td>
            <td class="px-3 py-2 text-center text-sm text-emerald-600">${s.successful}</td>
            <td class="px-3 py-2 text-center">
              <span class="px-2 py-0.5 bg-${rateColor}-100 text-${rateColor}-700 rounded text-xs">${s.rate}%</span>
            </td>
            <td class="px-3 py-2 text-center text-sm">${s.avgRating !== '-' ? s.avgRating : '-'}</td>
          </tr>`;
        }).join('');
      },
      
      // Queue Management
      buildQueue() {
        if (!App.processedPlayers || App.processedPlayers.length === 0) return [];
        
        const queue = [];
        App.processedPlayers.forEach(player => {
          const callData = this.getClientCallData(player.id);
          
          if (callData.status === 'no_contact') return;
          if (callData.status === 'contacted') return;
          
          let priority = 0;
          if (player.churnRisk === 'critical') priority += 100;
          else if (player.churnRisk === 'high') priority += 50;
          else if (player.churnRisk === 'medium') priority += 20;
          
          if (callData.hasCallback) priority += 200;
          if (callData.status === 'new') priority += 10;
          
          queue.push({ player, callData, priority });
        });
        
        return queue.sort((a, b) => b.priority - a.priority);
      },
      
      filterQueue() {
        const filter = document.getElementById('ccQueueFilter')?.value || 'all';
        this.renderQueue(filter);
      },
      
      renderQueue(filter = 'all') {
        if (!this.currentEmployee) return;
        
        const queue = this.buildQueue();
        const container = document.getElementById('ccQueueList');
        if (!container) return;
        
        let filtered = queue;
        if (filter === 'critical') filtered = queue.filter(q => q.player.churnRisk === 'critical');
        else if (filter === 'high') filtered = queue.filter(q => q.player.churnRisk === 'high');
        else if (filter === 'callback') filtered = queue.filter(q => q.callData.hasCallback);
        else if (filter === 'new') filtered = queue.filter(q => q.callData.status === 'new');
        
        if (filtered.length === 0) {
          container.innerHTML = `<div class="p-8 text-center text-slate-400">
            <i data-lucide="check-circle" class="h-8 w-8 mx-auto mb-2 opacity-50"></i>
            <p>No clients in this queue</p>
          </div>`;
          lucide.createIcons();
          return;
        }
        
        container.innerHTML = filtered.map(q => {
          const p = q.player;
          const cd = q.callData;
          const riskColor = { critical: 'red', high: 'orange', medium: 'yellow', low: 'emerald' }[p.churnRisk];
          const statusBadge = cd.hasCallback ? '<span class="text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded">Callback</span>' :
                             cd.status === 'new' ? '<span class="text-xs px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded">New</span>' :
                             `<span class="text-xs text-slate-400">${cd.attempts} attempts</span>`;
          
          return `<div class="p-3 border-b hover:bg-slate-50 cursor-pointer ${this.activeClient?.id === p.id ? 'bg-emerald-50 border-l-4 border-l-emerald-500' : ''}" onclick="CallCenter.selectClient('${p.id}')">
            <div class="flex items-center justify-between">
              <div>
                <span class="font-medium text-slate-800">${p.id}</span>
                <span class="ml-2 text-xs px-1.5 py-0.5 bg-${riskColor}-100 text-${riskColor}-700 rounded">${p.churnRisk}</span>
              </div>
              ${statusBadge}
            </div>
            <p class="text-xs text-slate-500 mt-1">${p.phone_number || 'No phone'}</p>
          </div>`;
        }).join('');
        
        // Update counts
        const allQueue = this.buildQueue();
        const noContact = App.processedPlayers?.filter(p => this.getClientCallData(p.id).status === 'no_contact').length || 0;
        
        const el = (id, val) => { const e = document.getElementById(id); if (e) e.textContent = val; };
        el('cc-queue-total', allQueue.length);
        el('cc-no-contact', noContact);
        el('cc-critical-count', allQueue.filter(q => q.player.churnRisk === 'critical').length);
        el('cc-high-count', allQueue.filter(q => q.player.churnRisk === 'high').length);
        el('cc-callback-count', allQueue.filter(q => q.callData.hasCallback).length);
        
        lucide.createIcons();
      },
      
      selectClient(clientId) {
        const player = App.processedPlayers.find(p => String(p.id) === String(clientId));
        if (!player) return;
        
        this.activeClient = player;
        const callData = this.getClientCallData(clientId);
        const riskColor = { critical: 'red', high: 'orange', medium: 'yellow', low: 'emerald' }[player.churnRisk];
        
        const regDate = player.registration_date ? new Date(player.registration_date).toLocaleDateString() : 'Unknown';
        const lastDeposit = player.last_deposit_date ? new Date(player.last_deposit_date).toLocaleDateString() : 'No deposits';
        
        document.getElementById('ccActiveCall').innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <div class="flex items-center gap-3 mb-4">
                <div class="h-14 w-14 rounded-full bg-slate-200 flex items-center justify-center">
                  <i data-lucide="user" class="h-7 w-7 text-slate-500"></i>
                </div>
                <div>
                  <p class="font-bold text-lg text-slate-800">${player.id}</p>
                  <span class="text-xs px-2 py-1 bg-${riskColor}-100 text-${riskColor}-700 rounded-full">${player.churnRisk} risk</span>
                </div>
              </div>
              
              <div class="space-y-3 bg-slate-50 rounded-xl p-4">
                <div class="flex items-center gap-3">
                  <i data-lucide="phone" class="h-4 w-4 text-slate-400"></i>
                  <span class="font-medium">${player.phone_number || 'No phone number'}</span>
                  ${player.phone_number ? `<button onclick="navigator.clipboard.writeText('${player.phone_number}')" class="text-xs text-blue-500 hover:underline">Copy</button>` : ''}
                </div>
                <div class="flex items-center gap-3">
                  <i data-lucide="calendar" class="h-4 w-4 text-slate-400"></i>
                  <span class="text-sm">Registered: <strong>${regDate}</strong></span>
                </div>
                <div class="flex items-center gap-3">
                  <i data-lucide="wallet" class="h-4 w-4 text-slate-400"></i>
                  <span class="text-sm">Last Deposit: <strong>${lastDeposit}</strong></span>
                </div>
                <div class="flex items-center gap-3">
                  <i data-lucide="phone-missed" class="h-4 w-4 text-slate-400"></i>
                  <span class="text-sm">Call Attempts: <strong>${callData.attempts}/5</strong></span>
                </div>
              </div>
            </div>
            
            <div>
              <h4 class="font-bold text-slate-800 mb-3">Log Call Outcome</h4>
              <div class="grid grid-cols-2 gap-2 mb-4">
                <button onclick="CallCenter.logCall('interested')" class="p-3 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 text-sm font-medium flex items-center justify-center gap-2">
                  <i data-lucide="check-circle" class="h-4 w-4"></i> Interested
                </button>
                <button onclick="CallCenter.logCall('not_interested')" class="p-3 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 text-sm font-medium flex items-center justify-center gap-2">
                  <i data-lucide="x-circle" class="h-4 w-4"></i> Not Interested
                </button>
                <button onclick="CallCenter.logCall('no_answer')" class="p-3 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 text-sm font-medium flex items-center justify-center gap-2">
                  <i data-lucide="phone-off" class="h-4 w-4"></i> No Answer
                </button>
                <button onclick="CallCenter.showCallbackModal()" class="p-3 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-sm font-medium flex items-center justify-center gap-2">
                  <i data-lucide="calendar-plus" class="h-4 w-4"></i> Callback
                </button>
                <button onclick="CallCenter.logCall('wrong_number')" class="p-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium flex items-center justify-center gap-2 col-span-2">
                  <i data-lucide="phone-off" class="h-4 w-4"></i> Wrong Number
                </button>
              </div>
              
              <h4 class="font-bold text-slate-800 mb-2">Call Rating</h4>
              <div class="flex gap-1 mb-3" id="ccCallRating">
                ${[1,2,3,4,5].map(i => `<button onclick="CallCenter.setRating(${i})" class="rating-star p-2 text-slate-300 hover:text-yellow-400" data-rating="${i}"><i data-lucide="star" class="h-6 w-6"></i></button>`).join('')}
              </div>
              
              <h4 class="font-bold text-slate-800 mb-2">Notes</h4>
              <textarea id="ccCallNotes" class="w-full px-3 py-2 border rounded-lg text-sm" rows="3" placeholder="Add notes about this call..."></textarea>
            </div>
          </div>
        `;
        
        this.currentRating = 0;
        this.renderClientCallHistory(clientId);
        this.filterQueue();
        lucide.createIcons();
      },
      
      currentRating: 0,
      
      setRating(rating) {
        this.currentRating = rating;
        document.querySelectorAll('#ccCallRating .rating-star').forEach((btn, idx) => {
          if (idx < rating) {
            btn.classList.remove('text-slate-300');
            btn.classList.add('text-yellow-400');
          } else {
            btn.classList.remove('text-yellow-400');
            btn.classList.add('text-slate-300');
          }
        });
      },
      
      renderClientCallHistory(clientId) {
        const logs = this.callLogs.filter(l => String(l.clientId) === String(clientId)).reverse().slice(0, 5);
        const container = document.getElementById('ccCallHistory');
        if (!container) return;
        
        if (logs.length === 0) {
          container.innerHTML = `<div class="p-6 text-center text-slate-400"><p class="text-sm">No call history for this client</p></div>`;
          return;
        }
        
        const outcomeLabels = {
          interested: { label: 'Interested', color: 'emerald' },
          not_interested: { label: 'Not Interested', color: 'slate' },
          no_answer: { label: 'No Answer', color: 'orange' },
          callback: { label: 'Callback', color: 'blue' },
          wrong_number: { label: 'Wrong Number', color: 'red' }
        };
        
        container.innerHTML = logs.map(log => {
          const o = outcomeLabels[log.outcome] || { label: log.outcome, color: 'slate' };
          const date = new Date(log.date).toLocaleString();
          const emp = this.employees.find(e => e.id === log.employeeId);
          const stars = log.rating ? 'â˜…'.repeat(log.rating) : '';
          
          return `<div class="p-3 border-b">
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium text-sm text-${o.color}-700">${o.label}</span>
              <span class="text-xs text-slate-400">${date}</span>
            </div>
            <div class="flex items-center justify-between text-xs">
              <span class="text-slate-500">By: ${emp?.name || 'Unknown'}</span>
              <span class="text-yellow-500">${stars}</span>
            </div>
            ${log.notes ? `<p class="text-sm text-slate-600 mt-1 bg-slate-50 p-2 rounded">${log.notes}</p>` : ''}
          </div>`;
        }).join('');
      },
      
      renderMyCallHistory() {
        if (!this.currentEmployee) return;
        
        const logs = this.callLogs
          .filter(l => l.employeeId === this.currentEmployee.id)
          .reverse()
          .slice(0, 10);
        
        const container = document.getElementById('ccCallHistory');
        if (!container) return;
        
        if (logs.length === 0) {
          container.innerHTML = `<div class="p-6 text-center text-slate-400"><p class="text-sm">You haven't made any calls yet</p></div>`;
          return;
        }
        
        const outcomeLabels = {
          interested: { label: 'Interested', color: 'emerald' },
          not_interested: { label: 'Not Interested', color: 'slate' },
          no_answer: { label: 'No Answer', color: 'orange' },
          callback: { label: 'Callback', color: 'blue' },
          wrong_number: { label: 'Wrong Number', color: 'red' }
        };
        
        container.innerHTML = logs.map(log => {
          const o = outcomeLabels[log.outcome] || { label: log.outcome, color: 'slate' };
          const date = new Date(log.date).toLocaleString();
          const stars = log.rating ? 'â˜…'.repeat(log.rating) : '';
          
          return `<div class="p-3 border-b hover:bg-slate-50 cursor-pointer" onclick="CallCenter.selectClient('${log.clientId}')">
            <div class="flex items-center justify-between">
              <span class="font-medium text-sm">${log.clientId}</span>
              <span class="text-xs px-2 py-0.5 bg-${o.color}-100 text-${o.color}-700 rounded">${o.label}</span>
            </div>
            <div class="flex items-center justify-between text-xs text-slate-500 mt-1">
              <span>${date}</span>
              <span class="text-yellow-500">${stars}</span>
            </div>
          </div>`;
        }).join('');
      },
      
      async logCall(outcome, callbackDate = null) {
        if (!this.activeClient || !this.currentEmployee) {
          alert('Please select an employee and a client first');
          return;
        }
        
        const notes = document.getElementById('ccCallNotes')?.value || '';
        
        try {
          // Save to Supabase
          const { data: logData, error } = await App.db
            .from('call_logs')
            .insert({
              client_id: String(this.activeClient.id),
              employee_id: this.currentEmployee.id,
              outcome: outcome,
              notes: notes || null,
              rating: this.currentRating || null,
              callback_date: callbackDate || null
            })
            .select()
            .single();
          
          if (error) {
            console.error('Supabase error saving call log:', error);
            throw error;
          }
          
          // Add to local array (convert to internal format)
          const log = {
            id: logData.id,
            clientId: logData.client_id,
            employeeId: logData.employee_id,
            date: logData.created_at,
            outcome: logData.outcome,
            notes: logData.notes,
            rating: logData.rating,
            callbackDate: logData.callback_date
          };
          
          this.callLogs.push(log);
          this.save(); // Backup to localStorage
          
          const callData = this.getClientCallData(this.activeClient.id);
          if (callData.attempts >= 5) {
            alert('This client has been marked as NO CONTACT after 5 failed attempts.');
          }
          
          if (document.getElementById('ccCallNotes')) {
            document.getElementById('ccCallNotes').value = '';
          }
          this.currentRating = 0;
          
          this.updateEmployeeStats();
          this.renderQueue();
          this.renderMyCallHistory();
          
          const msg = outcome === 'no_answer' ? `No Answer (${callData.attempts}/5 attempts)` : 
                      outcome === 'callback' ? 'Callback scheduled' : 
                      'Call logged successfully';
          alert(msg);
          
        } catch (error) {
          console.error('Error saving call log:', error);
          alert('Error saving call: ' + (error.message || 'Unknown error'));
        }
      },
      
      showCallbackModal() {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const defaultDate = tomorrow.toISOString().split('T')[0];
        
        const date = prompt('Set callback date (YYYY-MM-DD):', defaultDate);
        if (date) {
          this.logCall('callback', date);
        }
      },
      
      showEmployeeHistory(employeeId) {
        const emp = this.employees.find(e => e.id === employeeId);
        if (!emp) return;
        
        document.getElementById('ccHistoryModalTitle').textContent = `Call History - ${emp.name}`;
        
        const logs = this.callLogs.filter(l => l.employeeId === employeeId).reverse();
        
        const outcomeLabels = {
          interested: { label: 'Interested', color: 'emerald' },
          not_interested: { label: 'Not Interested', color: 'slate' },
          no_answer: { label: 'No Answer', color: 'orange' },
          callback: { label: 'Callback', color: 'blue' },
          wrong_number: { label: 'Wrong Number', color: 'red' }
        };
        
        if (logs.length === 0) {
          document.getElementById('ccHistoryModalContent').innerHTML = '<p class="text-center text-slate-400 py-8">No call history</p>';
        } else {
          document.getElementById('ccHistoryModalContent').innerHTML = `
            <div class="space-y-2">
              ${logs.map(log => {
                const o = outcomeLabels[log.outcome] || { label: log.outcome, color: 'slate' };
                const date = new Date(log.date).toLocaleString();
                const stars = log.rating ? 'â˜…'.repeat(log.rating) : '';
                
                return `<div class="p-3 border rounded-lg">
                  <div class="flex items-center justify-between mb-1">
                    <span class="font-medium">Client: ${log.clientId}</span>
                    <span class="text-xs px-2 py-0.5 bg-${o.color}-100 text-${o.color}-700 rounded">${o.label}</span>
                  </div>
                  <div class="flex items-center justify-between text-xs text-slate-500">
                    <span>${date}</span>
                    <span class="text-yellow-500">${stars}</span>
                  </div>
                  ${log.notes ? `<p class="text-sm text-slate-600 mt-2 bg-slate-50 p-2 rounded">${log.notes}</p>` : ''}
                </div>`;
              }).join('')}
            </div>
          `;
        }
        
        document.getElementById('ccHistoryModal').classList.remove('hidden');
      },
      
      showMyFullHistory() {
        if (!this.currentEmployee) return;
        this.showEmployeeHistory(this.currentEmployee.id);
      },
      
      exportAdminReport() {
        const dateFilter = document.getElementById('ccAdminDateFilter')?.value || 'all';
        
        let csv = 'Employee Name,Employee ID,Role,Total Calls,Successful,Failed,Callbacks,Success Rate,Avg Rating\n';
        
        this.employees.forEach(emp => {
          const s = this.getEmployeeStats(emp.id, dateFilter);
          csv += `"${emp.name}","${emp.id}","${emp.role || 'callcenter'}",${s.total},${s.successful},${s.failed},${s.callbacks},${s.rate}%,${s.avgRating}\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `call-center-report-${dateFilter}-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      }
    };


    // ============================================================
    // PROACTIVE AI ANALYSIS
    // ============================================================
    function runProactiveAnalysis() {
      const alerts = [];
      const s = getStats();
      const isRu = App.currentLang === 'ru';
      
      const vipChurning = App.processedPlayers.filter(p => p.valueSegment === 'vip' && (p.churnRisk === 'high' || p.churnRisk === 'critical'));
      if (vipChurning.length > 0) alerts.push({ icon: 'ðŸ‘‘', message: isRu ? `${vipChurning.length} VIP Ð² Ð·Ð¾Ð½Ðµ Ñ€Ð¸ÑÐºÐ° (${formatK(vipChurning.reduce((a,p)=>a+p.netRevenue,0))})` : `${vipChurning.length} VIP at risk (${formatK(vipChurning.reduce((a,p)=>a+p.netRevenue,0))})` });
      if (s.churnCritical > s.total * 0.1) alerts.push({ icon: 'ðŸš¨', message: isRu ? `${s.churnCritical} ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ñ‚Ñ‚Ð¾Ðº (${Math.round(s.churnCritical/s.total*100)}%)` : `${s.churnCritical} critical churn (${Math.round(s.churnCritical/s.total*100)}%)` });
      if (s.virtual > s.total * 0.05) alerts.push({ icon: 'ðŸ“±', message: isRu ? `${s.virtual} Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¾Ð²` : `${s.virtual} virtual phones detected` });
      
      const banner = document.getElementById('aiAlertsBanner');
      const content = document.getElementById('aiAlertsContent');
      if (alerts.length > 0) {
        content.innerHTML = alerts.map(a => `<p>${a.icon} ${a.message}</p>`).join('');
        banner.classList.remove('hidden');
        document.getElementById('aiNotificationDot').style.display = 'block';
      } else { banner.classList.add('hidden'); }
      return alerts;
    }

    // ============================================================
    // EXPORT
    // ============================================================
    function exportFiltered(type, name) {
      const data = type === 'current' ? App.filteredPlayers : type === 'all' ? App.processedPlayers : (showFilteredPlayers(type, name), App.filteredPlayers);
      if (!data.length) return showNotification(App.currentLang === 'ru' ? 'ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…' : 'No data', 'error');
      
      const headers = ['id','phone_number','phoneType','preference','valueSegment','netRevenue','winRate','churnRisk','churnScore','ltv','optimalBonus'];
      let csv = headers.join(',') + '\n';
      data.forEach(p => csv += headers.map(h => p[h] ?? '').join(',') + '\n');
      
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'}));
      a.download = `${name}_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      showNotification(App.currentLang === 'ru' ? `Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ ${data.length} Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²` : `Exported ${data.length} players`, 'success');
    }

    // ============================================================
    // UI HELPERS
    // ============================================================
    function showLoading(show, text = 'Loading...') { document.getElementById('loadingOverlay').classList.toggle('hidden', !show); document.getElementById('loadingText').textContent = text; }
    function showNotification(msg, type = 'success') {
      const el = document.createElement('div');
      el.className = `px-4 py-3 rounded-lg shadow-xl flex items-center gap-3 text-sm text-white notification ${type === 'success' ? 'bg-emerald-500' : 'bg-red-500'}`;
      el.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'x-circle'}" class="h-5 w-5"></i>${msg}`;
      document.getElementById('notificationStack').appendChild(el);
      lucide.createIcons();
      setTimeout(() => el.remove(), 4000);
    }
    function switchTab(t) { 
      document.querySelectorAll('.tab-content').forEach(e => e.classList.add('hidden')); 
      document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active')); 
      document.getElementById('content-'+t)?.classList.remove('hidden'); 
      document.getElementById('tab-'+t)?.classList.add('active'); 
      
      // Only refresh icons, don't reload data
      lucide.createIcons();
      
      // Update UI from existing data if available (no reload)
      if (App.dataLoaded && App.processedPlayers.length > 0) {
        // Just ensure stats and table are up to date from memory
        if (t === 'players') renderTable();
      }
    }
    function toggleDarkMode() { App.darkMode = !App.darkMode; document.body.classList.toggle('dark', App.darkMode); localStorage.setItem('darkMode', App.darkMode); }
    function toggleCommandPalette(show) { document.getElementById('commandPalette').classList.toggle('open', show); document.getElementById('commandOverlay').classList.toggle('hidden', !show); if (show) document.getElementById('commandInput').focus(); }

    // ============================================================
    // KEYBOARD SHORTCUTS
    // ============================================================
    document.addEventListener('keydown', e => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') { if (e.key === 'Escape') { e.target.blur(); toggleCommandPalette(false); } return; }
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); toggleCommandPalette(true); }
      if ((e.ctrlKey || e.metaKey) && e.key === '/') { e.preventDefault(); AIAgent.toggle(); }
      if ((e.ctrlKey || e.metaKey) && e.key === 'e') { e.preventDefault(); exportFiltered('current', 'export'); }
      if ((e.ctrlKey || e.metaKey) && e.key === 'd') { e.preventDefault(); toggleDarkMode(); }
      const tabs = { '1': 'dashboard', '2': 'profitability', '3': 'behavior', '4': 'churn', '5': 'analytics', '6': 'players', '7': 'callcenter', '8': 'settings' };
      if (tabs[e.key] && !e.ctrlKey && !e.metaKey) switchTab(tabs[e.key]);
      if (e.key === 'Escape') { document.getElementById('playerModal').classList.add('hidden'); document.getElementById('paramsModal').classList.add('hidden'); toggleCommandPalette(false); closeTutorial(); }
    });

    // ============================================================
    // AI AGENT
    // ============================================================
    const AIAgent = {
      isOpen: false, isLoading: false, conversationHistory: [],
      
      init() { this.loadConversation(); this.showWelcome(); },
      showWelcome() {
        const isRu = App.currentLang === 'ru';
        const alerts = runProactiveAnalysis();
        document.getElementById('aiChatMessages').innerHTML = `<div class="chat-message assistant">ðŸ‘‹ <strong>${isRu ? 'CRM AI ÐÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚' : 'CRM AI Assistant'}</strong><br><br>${isRu ? 'Ð¯ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ñ:' : 'I can help with:'}<br>â€¢ ${isRu ? 'ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ' : 'Navigate'} - "Go to churn"<br>â€¢ ${isRu ? 'ÐŸÐ¾Ð¸ÑÐº' : 'Find'} - "Show VIP at risk"<br>â€¢ ${isRu ? 'Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ' : 'Compare'} - "Compare VIP vs High"<br>â€¢ ${isRu ? 'Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚' : 'Export'} - "Export critical churn"</div>` +
          (alerts.length ? `<div class="chat-message system">ðŸ”” ${alerts.map(a => a.icon + ' ' + a.message).join('<br>')}</div>` : '');
      },
      
      loadConversation() { try { const d = JSON.parse(localStorage.getItem('ai_chat')||'{}'); if (Date.now() - d.t < 3600000) this.conversationHistory = d.h || []; } catch(e){} },
      saveConversation() { try { localStorage.setItem('ai_chat', JSON.stringify({ h: this.conversationHistory.slice(-20), t: Date.now() })); } catch(e){} },
      clearConversation() { this.conversationHistory = []; localStorage.removeItem('ai_chat'); this.showWelcome(); this.addMessage('ðŸ—‘ï¸ ' + (App.currentLang === 'ru' ? 'ÐžÑ‡Ð¸Ñ‰ÐµÐ½Ð¾' : 'Cleared'), 'system'); },
      
      toggle() { this.isOpen = !this.isOpen; document.getElementById('aiChatPanel').classList.toggle('open', this.isOpen); if (this.isOpen) { document.getElementById('aiNotificationDot').style.display = 'none'; document.getElementById('aiChatInput').focus(); } },
      handleKeydown(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.send(); } },
      quickAction(msg) { document.getElementById('aiChatInput').value = msg; this.send(); },
      addMessage(content, role) { const d = document.createElement('div'); d.className = 'chat-message ' + role; d.innerHTML = role === 'assistant' ? content.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>') : content; const c = document.getElementById('aiChatMessages'); c.appendChild(d); c.scrollTop = c.scrollHeight; },
      showTyping(show) { const ex = document.getElementById('typing'); if (show && !ex) { const d = document.createElement('div'); d.id='typing'; d.className='typing-indicator'; d.innerHTML='<span></span><span></span><span></span>'; document.getElementById('aiChatMessages').appendChild(d); } else if (!show && ex) ex.remove(); },
      
      buildContext() {
        const s = getStats();
        return `BwanaBet CRM AI. Data: ${s.total} players, ${s.profitable} profitable (${formatK(s.profitAmount)}), ${s.negativeGGR} negative GGR (${formatK(s.negativeGGRAmount)}). Churn: ${s.churnCritical} critical, ${s.churnHigh} high. VIP: ${s.segVip}. Use [ACTION:navigate:TAB], [ACTION:segment:TYPE], [ACTION:lookup:TERM], [ACTION:viewplayer:ID], [ACTION:similar:ID], [ACTION:compare:seg1,seg2], [ACTION:export:TYPE], [ACTION:predict:ID] to execute actions.`;
      },
      
      parseActions(text) {
        const regex = /\[ACTION:(\w+):([^\]]+)\]/g;
        let m, results = [];
        while ((m = regex.exec(text)) !== null) {
          const [, type, params] = m;
          const args = params.split(',').map(s => s.trim());
          let r = { success: true };
          
          if (type === 'navigate') switchTab(args[0]);
          else if (type === 'segment') { const names = { vip:'VIP', profitable:'Profitable', negative_ggr:'Negative GGR', churn_critical:'Critical Churn', churn_high:'High Churn', sports:'Sports', casino:'Casino', at_risk:'At Risk' }; showFilteredPlayers(args[0], names[args[0]]||args[0]); }
          else if (type === 'lookup') { r.players = App.processedPlayers.filter(p => String(p.id).includes(args[0]) || (p.phone_number||'').includes(args[0])).slice(0,5).map(p => ({ id: p.id, rev: formatK(p.netRevenue), churn: p.churnRisk, score: p.churnScore, ltv: formatK(p.ltv) })); }
          else if (type === 'viewplayer') viewPlayer(args[0]);
          else if (type === 'similar') { const t = App.processedPlayers.find(p => String(p.id) === args[0]); if (t) r.similar = findSimilarPlayers(t, 5).map(s => ({ id: s.player.id, sim: Math.round(s.similarity*100)+'%', rev: formatK(s.player.netRevenue) })); }
          else if (type === 'compare') { const [s1,s2] = args; const p1 = App.processedPlayers.filter(p => p.valueSegment === s1), p2 = App.processedPlayers.filter(p => p.valueSegment === s2); const avg = (a,k) => a.length ? Math.round(a.reduce((x,p)=>x+(p[k]||0),0)/a.length) : 0; r.comparison = { [s1]: { n: p1.length, rev: avg(p1,'netRevenue'), churn: avg(p1,'churnScore') }, [s2]: { n: p2.length, rev: avg(p2,'netRevenue'), churn: avg(p2,'churnScore') } }; }
          else if (type === 'export') exportFiltered(args[0], args[0]);
          else if (type === 'predict') { const p = App.processedPlayers.find(x => String(x.id) === args[0]); if (p) r.prediction = { id: p.id, score: p.churnScore, risk: p.churnRisk, factors: p.churnFactors, ltv: formatK(p.ltv), bonus: formatK(p.optimalBonus) }; }
          
          results.push(r);
        }
        return { clean: text.replace(regex, '').trim(), results };
      },
      
      async send() {
        const input = document.getElementById('aiChatInput');
        const msg = input.value.trim();
        if (!msg || this.isLoading) return;
        
        this.addMessage(msg, 'user');
        this.conversationHistory.push({ role: 'user', content: msg });
        input.value = '';
        this.isLoading = true;
        this.showTyping(true);
        
        try {
          const res = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-api-key': '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', 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
            body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 1500, system: this.buildContext(), messages: this.conversationHistory.slice(-10) })
          });
          if (!res.ok) throw new Error('API failed');
          const data = await res.json();
          const reply = data.content[0].text;
          const { clean, results } = this.parseActions(reply);
          
          this.conversationHistory.push({ role: 'assistant', content: clean });
          this.saveConversation();
          this.showTyping(false);
          this.addMessage(clean, 'assistant');
          
          results.forEach(r => {
            if (r.players?.length) { let h = '<div style="background:#f1f5f9;padding:10px;border-radius:8px;font-size:12px;margin-top:6px;"><strong>Players:</strong><br>'; r.players.forEach(p => h += `<div style="padding:6px;background:white;border-radius:4px;margin:4px 0;cursor:pointer" onclick="viewPlayer('${p.id}')">${p.id} | ${p.rev} | ${p.churn}(${p.score}) | LTV:${p.ltv}</div>`); h += '</div>'; this.addMessage(h, 'assistant'); }
            if (r.similar?.length) { let h = '<div style="background:#f1f5f9;padding:10px;border-radius:8px;font-size:12px;margin-top:6px;"><strong>Similar:</strong><br>'; r.similar.forEach(s => h += `<div style="padding:4px;background:white;border-radius:4px;margin:2px 0;cursor:pointer" onclick="viewPlayer('${s.id}')">${s.id} | ${s.sim} | ${s.rev}</div>`); h += '</div>'; this.addMessage(h, 'assistant'); }
            if (r.comparison) { let h = '<div style="background:#f1f5f9;padding:10px;border-radius:8px;font-size:12px;margin-top:6px;"><strong>Comparison:</strong><br>'; Object.entries(r.comparison).forEach(([k,v]) => h += `<div style="padding:4px;background:white;border-radius:4px;margin:2px 0"><b>${k.toUpperCase()}</b>: ${v.n} players, Avg Rev: ${formatK(v.rev)}, Avg Churn: ${v.churn}</div>`); h += '</div>'; this.addMessage(h, 'assistant'); }
            if (r.prediction) { this.addMessage(`<div style="background:#fef3c7;padding:10px;border-radius:8px;font-size:12px;margin-top:6px;border-left:3px solid #F59E0B"><strong>ðŸ”® Prediction ${r.prediction.id}:</strong><br>Score: ${r.prediction.score}/100 (${r.prediction.risk})<br>LTV: ${r.prediction.ltv}<br>Rec Bonus: ${r.prediction.bonus}<br>${r.prediction.factors.length ? 'Factors: '+r.prediction.factors.join(', ') : ''}</div>`, 'assistant'); }
          });
        } catch (e) { this.showTyping(false); this.addMessage('âŒ ' + e.message, 'system'); }
        finally { this.isLoading = false; input.focus(); }
      }
    };

    // ============================================================
    // CSV IMPORT - FIXED: Using 'customers' table
    // ============================================================
    async function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      showLoading(true, App.currentLang === 'ru' ? 'Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚...' : 'Importing...');
      try {
        const text = await file.text();
        const lines = text.split('\n').filter(l => l.trim());
        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
        const records = [];
        for (let i = 1; i < lines.length; i++) {
          const vals = lines[i].split(',');
          const rec = {};
          headers.forEach((h, j) => { rec[FIELD_MAP[h] || h] = vals[j]?.trim() || ''; });
          if (rec.id) records.push(rec);
        }
        // FIXED: Changed from 'players' to 'customers'
        for (let i = 0; i < records.length; i += 100) {
          await App.db.from('customers').upsert(records.slice(i, i+100), { onConflict: 'id' });
        }
        showNotification(App.currentLang === 'ru' ? `Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ ${records.length} Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²` : `Imported ${records.length} players`, 'success');
        await loadPlayers(true); // Force reload after import
      } catch (err) { showNotification((App.currentLang === 'ru' ? 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°: ' : 'Import failed: ') + err.message, 'error'); }
      finally { showLoading(false); e.target.value = ''; }
    }

    // ============================================================
    // INITIALIZATION
    // ============================================================
    document.addEventListener('DOMContentLoaded', async () => {
      lucide.createIcons();
      
      // Load saved settings
      try { 
        const savedParams = localStorage.getItem('crmParams'); 
        if (savedParams) {
          const parsed = JSON.parse(savedParams);
          App.params = { ...DEFAULT_PARAMS, ...parsed }; // Merge with defaults for any missing keys
        }
        App.darkMode = localStorage.getItem('darkMode') === 'true'; if (App.darkMode) document.body.classList.add('dark');
        App.currentLang = localStorage.getItem('crmLang') || 'en';
        document.getElementById('languageSelect').value = App.currentLang;
      } catch(e){ console.error('Error loading settings:', e); }
      
      // Load Telegram settings
      loadTelegramSettings();
      
      applyTranslations();
      
      // Language selector
      document.getElementById('languageSelect').addEventListener('change', (e) => {
        setLanguage(e.target.value);
        updateAllCharts();
        AIAgent.showWelcome();
      });
      
      // Initialize Supabase
      App.db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('loginPassword').addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); });
      
      // Restore role from localStorage
      const savedRole = localStorage.getItem('userRole');
      if (savedRole) App.role = savedRole;
      
      const { data: { session } } = await App.db.auth.getSession();
      if (session) { App.user = session.user; showMainApp(); }
      App.db.auth.onAuthStateChange((ev, sess) => { 
        if (ev === 'SIGNED_IN' && sess) { 
          App.user = sess.user; 
          showMainApp(); 
        } else if (ev === 'SIGNED_OUT') { 
          document.getElementById('loginScreen').classList.remove('hidden'); 
          document.getElementById('mainApp').classList.add('hidden');
          // Reset role on logout
          App.role = 'admin';
          localStorage.removeItem('userRole');
        } 
      });
    });

    async function handleLogin() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const role = document.getElementById('loginRole').value;
      
      if (!email || !password) { document.getElementById('loginError').textContent = App.currentLang === 'ru' ? 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑƒÑ‡ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ' : 'Enter credentials'; document.getElementById('loginError').classList.remove('hidden'); return; }
      
      const btn = document.getElementById('loginBtn');
      btn.disabled = true; btn.innerHTML = '<svg class="spinner h-5 w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>';
      
      // Store selected role
      App.role = role;
      localStorage.setItem('userRole', role);
      
      try { const { error } = await App.db.auth.signInWithPassword({ email, password }); if (error) throw error; }
      catch (e) { document.getElementById('loginError').textContent = e.message; document.getElementById('loginError').classList.remove('hidden'); btn.disabled = false; btn.innerHTML = '<i data-lucide="log-in" class="h-5 w-5"></i> ' + (App.currentLang === 'ru' ? 'Ð’Ð¾Ð¹Ñ‚Ð¸' : 'Sign In'); lucide.createIcons(); }
    }

    function showMainApp() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      if (App.user) { setText('userEmail', App.user.email); setText('settingsUserEmail', App.user.email); }
      
      // Apply role-based access
      applyRoleAccess();
      
      // Initialize Call Center (AFTER App.db is ready)
      CallCenter.init();
      
      document.getElementById('logoutBtn').addEventListener('click', () => App.db.auth.signOut());
      ['dashboard','profitability','behavior','churn','analytics','players','callcenter','settings'].forEach(t => document.getElementById('tab-'+t)?.addEventListener('click', () => switchTab(t)));
      ['searchInput','profitFilter','prefFilter','churnFilter','valueFilter'].forEach(id => document.getElementById(id)?.addEventListener('input', filterTable));
      document.getElementById('csvFileInput')?.addEventListener('change', handleFileUpload);
      
      applyTranslations();
      updateSettingsDisplay(); // Show current parameter values in settings
      
      // Load efficiency feature preferences
      loadWatchlist();
      loadRecentlyViewed();
      loadSavedFilters();
      loadColumnPreferences();
      loadAutoRefreshPreference();
      
      // Initialize UI panels
      updateWatchlistPanel();
      updateRecentlyViewedPanel();
      updateSavedFiltersPanel();
      updateColumnVisibility();
      
      lucide.createIcons();
      
      // Load data only once on initial app show
      if (!App.dataLoaded) {
        loadPlayers();
      }
      setTimeout(() => AIAgent.init(), 500);
    }
    
    function applyRoleAccess() {
      const role = App.role;
      const allTabs = ['dashboard', 'profitability', 'behavior', 'churn', 'analytics', 'players', 'callcenter', 'settings'];
      
      // Apply Call Center sub-tab access
      CallCenter.applySubTabAccess();
      
      if (role === 'callcenter') {
        // Hide ALL tabs - Call Center users see only the call center content directly
        allTabs.forEach(tab => {
          const tabBtn = document.getElementById('tab-' + tab);
          const tabContent = document.getElementById('content-' + tab);
          
          if (tab === 'callcenter') {
            tabContent?.classList.remove('hidden');
          } else {
            tabContent?.classList.add('hidden');
          }
          // Hide all tab buttons - Call Center users don't need navigation
          tabBtn?.classList.add('hidden');
        });
        
        // Hide the entire navigation bar
        document.getElementById('mainNav')?.classList.add('hidden');
        
        // Hide header elements not needed for call center
        document.getElementById('headerSearchBtn')?.classList.add('hidden');
        document.getElementById('headerParamsBtn')?.classList.add('hidden');
        document.getElementById('headerVersion')?.classList.add('hidden');
        
        // Hide AI assistant
        document.getElementById('aiWidgetBtn')?.classList.add('hidden');
        document.getElementById('aiChatPanel')?.classList.add('hidden');
        
        // Update header to show Call Center mode
        const headerTitle = document.getElementById('headerTitle');
        if (headerTitle) headerTitle.innerHTML = '<span class="text-yellow-400">BWANABET</span> <span class="text-sm font-normal text-slate-400 ml-2">Call Center</span>';
        
        // Show role badge
        const roleBadge = document.getElementById('headerRoleBadge');
        if (roleBadge) {
          roleBadge.textContent = 'Call Center';
          roleBadge.classList.remove('hidden');
          roleBadge.classList.add('bg-blue-500', 'text-white');
        }
        
      } else {
        // Full access for admin and developer
        allTabs.forEach(tab => {
          const tabBtn = document.getElementById('tab-' + tab);
          const tabContent = document.getElementById('content-' + tab);
          tabBtn?.classList.remove('hidden');
        });
        
        // Show navigation
        document.getElementById('mainNav')?.classList.remove('hidden');
        
        // Show header elements
        document.getElementById('headerSearchBtn')?.classList.remove('hidden');
        document.getElementById('headerParamsBtn')?.classList.remove('hidden');
        document.getElementById('headerVersion')?.classList.remove('hidden');
        
        // Show AI assistant
        document.getElementById('aiWidgetBtn')?.classList.remove('hidden');
        
        // Update header title
        const headerTitle = document.getElementById('headerTitle');
        if (headerTitle) headerTitle.innerHTML = 'BWANABET';
        
        // Show role badge for admin/developer
        const roleBadge = document.getElementById('headerRoleBadge');
        if (roleBadge) {
          if (role === 'admin') {
            roleBadge.textContent = 'Admin';
            roleBadge.classList.remove('hidden', 'bg-blue-500');
            roleBadge.classList.add('bg-yellow-400', 'text-black');
          } else if (role === 'developer') {
            roleBadge.textContent = 'Developer';
            roleBadge.classList.remove('hidden', 'bg-blue-500');
            roleBadge.classList.add('bg-purple-500', 'text-white');
          }
        }
        
        // Show dashboard by default
        switchTab('dashboard');
      }
    }
  </script>
</body>
</html>
